<!DOCTYPE html>
<html lang="en" class=""><head><script>window.livecodes = window.livecodes || {};</script><title>DeepAI Code Snippet</title><meta name="title" content="DeepAI Code Snippet"><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="stylesheet" href="./style.css"><script src="https://cdn.jsdelivr.net/npm/es-module-shims@1.10.0/dist/es-module-shims.js" async=""></script><script type="importmap">{
  "imports": {}
}</script></head><body>


   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
   <title>GN-Stream</title>
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
       
       * {
           box-sizing: border-box;
           margin: 0;
           padding: 0;
           -webkit-tap-highlight-color: transparent;
       }

       :root {
           --primary: #e50914;
           --primary-dark: #b20710;
           --primary-glow: rgba(229, 9, 20, 0.4);
           --bg: #000000;
           --surface: #141414;
           --surface-light: #1f1f1f;
           --surface-lighter: #2a2a2a;
           --text: #ffffff;
           --text-secondary: #a3a3a3;
           --text-muted: #6b6b6b;
           --border: rgba(255,255,255,0.1);
           --badge-new: #e50914;
           --badge-popular: #ff6b00;
           --badge-fan: #ffd600;
           --badge-trending: #e50914;
           --badge-scifi: #00a8ff;
           --badge-horror: #9b59b6;
           --badge-action: #ff3b30;
           --glass: rgba(20, 20, 20, 0.95);
           --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.9);
           --shadow-glow: 0 0 40px rgba(229, 9, 20, 0.3);
       }

       html {
           overflow-x: hidden;
           scroll-behavior: smooth;
       }

       body {
           font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
           background: var(--bg);
           color: var(--text);
           min-height: 100vh;
           overflow-x: hidden;
           line-height: 1.6;
           -webkit-font-smoothing: antialiased;
       }

       body.modal-open {
           overflow: hidden;
       }

       /* FIXED: Loading Screen with Anime Background */
       #loadingScreen {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: #000;
           z-index: 99999;
           display: flex;
           flex-direction: column;
           align-items: center;
           justify-content: center;
           overflow: hidden;
       }

       /* Anime Cyberpunk City Background Layers */
       .anime-bg-container {
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           overflow: hidden;
           z-index: 0;
       }

       /* Layer 1: Static City Image with Parallax */
       .anime-bg-layer {
           position: absolute;
           top: -10%;
           left: -10%;
           width: 120%;
           height: 120%;
           background: url('https://kimi-web-img.moonshot.cn/img/thumbs.dreamstime.com/510da3e618e0888e5afca2d75483c2f378bed91c.jpg') center/cover;
           filter: blur(2px) brightness(0.4) contrast(1.2);
           animation: bgPulse 20s ease-in-out infinite, bgDrift 30s linear infinite;
           transform-origin: center;
       }

       @keyframes bgPulse {
           0%, 100% { transform: scale(1) rotate(0deg); filter: blur(2px) brightness(0.4) contrast(1.2); }
           50% { transform: scale(1.1) rotate(2deg); filter: blur(3px) brightness(0.5) contrast(1.3); }
       }

       @keyframes bgDrift {
           0% { transform: translateX(0) scale(1.1); }
           50% { transform: translateX(-5%) scale(1.15); }
           100% { transform: translateX(0) scale(1.1); }
       }

       /* Layer 2: Animated Gradient Overlay */
       .anime-gradient-overlay {
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: 
               radial-gradient(ellipse at 20% 80%, rgba(229, 9, 20, 0.3) 0%, transparent 50%),
               radial-gradient(ellipse at 80% 20%, rgba(138, 43, 226, 0.2) 0%, transparent 50%),
               radial-gradient(ellipse at 50% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 70%);
           animation: gradientShift 15s ease infinite;
           mix-blend-mode: screen;
       }

       @keyframes gradientShift {
           0%, 100% { opacity: 0.5; transform: scale(1); }
           50% { opacity: 0.8; transform: scale(1.2); }
       }

       /* Layer 3: Scanlines */
       .scanlines {
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: linear-gradient(
               to bottom,
               rgba(255,255,255,0),
               rgba(255,255,255,0) 50%,
               rgba(0,0,0,0.1) 50%,
               rgba(0,0,0,0.1)
           );
           background-size: 100% 4px;
           animation: scanlineMove 10s linear infinite;
           pointer-events: none;
           opacity: 0.3;
       }

       @keyframes scanlineMove {
           0% { transform: translateY(0); }
           100% { transform: translateY(4px); }
       }

       /* Layer 4: Floating Particles */
       .particles-container {
           position: absolute;
           width: 100%;
           height: 100%;
           overflow: hidden;
           pointer-events: none;
       }

       .particle {
           position: absolute;
           width: 2px;
           height: 2px;
           background: #fff;
           border-radius: 50%;
           box-shadow: 0 0 10px #fff, 0 0 20px var(--primary);
           animation: floatUp 15s infinite linear;
           opacity: 0;
       }

       .particle:nth-child(3n) {
           background: #00ffff;
           box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff;
       }

       .particle:nth-child(5n) {
           background: #ff00ff;
           box-shadow: 0 0 10px #ff00ff, 0 0 20px #ff00ff;
       }

       @keyframes floatUp {
           0% {
               transform: translateY(100vh) translateX(0) scale(0);
               opacity: 0;
           }
           10% {
               opacity: 1;
               transform: translateY(90vh) translateX(10px) scale(1);
           }
           90% {
               opacity: 1;
               transform: translateY(-10vh) translateX(-10px) scale(1);
           }
           100% {
               transform: translateY(-20vh) translateX(0) scale(0);
               opacity: 0;
           }
       }

       /* Layer 5: Neon Grid Floor */
       .neon-grid {
           position: absolute;
           bottom: -50%;
           left: -50%;
           width: 200%;
           height: 100%;
           background-image: 
               linear-gradient(rgba(229, 9, 20, 0.3) 1px, transparent 1px),
               linear-gradient(90deg, rgba(229, 9, 20, 0.3) 1px, transparent 1px);
           background-size: 50px 50px;
           transform: perspective(500px) rotateX(60deg);
           animation: gridMove 20s linear infinite;
           opacity: 0.3;
       }

       @keyframes gridMove {
           0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
           100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
       }

       /* Layer 6: Vignette */
       .vignette {
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: radial-gradient(circle, transparent 40%, rgba(0,0,0,0.8) 100%);
           pointer-events: none;
       }

       /* Loading Content - Fixed Z-Index */
       .loading-content {
           position: relative;
           z-index: 10;
           text-align: center;
           max-width: 900px;
           padding: 40px;
           background: rgba(0, 0, 0, 0.6);
           backdrop-filter: blur(10px);
           border-radius: 20px;
           border: 1px solid rgba(255, 255, 255, 0.1);
       }

       .loading-logo {
           font-size: 64px;
           font-weight: 900;
           background: linear-gradient(135deg, var(--primary) 0%, #ff0a16 50%, var(--primary) 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
           letter-spacing: -2px;
           text-transform: uppercase;
           margin-bottom: 30px;
           animation: logoPulse 2s ease-in-out infinite;
           filter: drop-shadow(0 0 30px rgba(229, 9, 20, 0.8));
       }

       @keyframes logoPulse {
           0%, 100% { transform: scale(1); filter: drop-shadow(0 0 30px rgba(229, 9, 20, 0.8)); }
           50% { transform: scale(1.05); filter: drop-shadow(0 0 50px rgba(229, 9, 20, 1)); }
       }

       /* Featured Section */
       .featured-section {
           margin: 30px 0;
           opacity: 0;
           animation: fadeInUp 0.8s ease 0.5s forwards;
       }

       .featured-label {
           font-size: 12px;
           text-transform: uppercase;
           letter-spacing: 3px;
           color: var(--primary);
           margin-bottom: 20px;
           font-weight: 700;
           display: flex;
           align-items: center;
           justify-content: center;
           gap: 10px;
           text-shadow: 0 0 20px rgba(229, 9, 20, 0.5);
       }

       .featured-label::before,
       .featured-label::after {
           content: '';
           width: 30px;
           height: 1px;
           background: linear-gradient(90deg, transparent, var(--primary), transparent);
       }

       .featured-grid {
           display: flex;
           gap: 20px;
           justify-content: center;
           flex-wrap: wrap;
           perspective: 1000px;
       }

       .featured-card {
           width: 160px;
           height: 240px;
           border-radius: 12px;
           overflow: hidden;
           position: relative;
           cursor: pointer;
           transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
           box-shadow: 0 10px 30px rgba(0,0,0,0.8), 0 0 0 1px rgba(255,255,255,0.1);
           transform-style: preserve-3d;
           background: var(--surface);
       }

       .featured-card:hover {
           transform: translateY(-10px) rotateX(5deg) scale(1.05);
           box-shadow: 0 20px 40px rgba(229, 9, 20, 0.4), 0 0 30px rgba(229, 9, 20, 0.2);
           z-index: 10;
       }

       .featured-card img {
           width: 100%;
           height: 100%;
           object-fit: cover;
           transition: transform 0.4s;
       }

       .featured-card:hover img {
           transform: scale(1.1);
       }

       .featured-card::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           right: 0;
           bottom: 0;
           background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, transparent 60%);
           z-index: 1;
           opacity: 0.7;
           transition: opacity 0.3s;
       }

       .featured-card:hover::before {
           opacity: 0.9;
       }

       .featured-info {
           position: absolute;
           bottom: 0;
           left: 0;
           right: 0;
           padding: 15px;
           z-index: 2;
           transform: translateY(10px);
           opacity: 0;
           transition: all 0.3s ease;
       }

       .featured-card:hover .featured-info {
           transform: translateY(0);
           opacity: 1;
       }

       .featured-title {
           font-size: 14px;
           font-weight: 700;
           margin-bottom: 4px;
           white-space: nowrap;
           overflow: hidden;
           text-overflow: ellipsis;
           color: #fff;
       }

       .featured-meta {
           font-size: 11px;
           color: var(--text-secondary);
           display: flex;
           align-items: center;
           gap: 6px;
       }

       .featured-badge {
           position: absolute;
           top: 10px;
           right: 10px;
           background: var(--primary);
           color: white;
           padding: 4px 8px;
           border-radius: 4px;
           font-size: 10px;
           font-weight: 800;
           text-transform: uppercase;
           z-index: 3;
           box-shadow: 0 4px 15px rgba(229, 9, 20, 0.6);
           animation: badgePulse 2s ease-in-out infinite;
       }

       @keyframes badgePulse {
           0%, 100% { box-shadow: 0 4px 15px rgba(229, 9, 20, 0.6); }
           50% { box-shadow: 0 4px 25px rgba(229, 9, 20, 1); }
       }

       @keyframes fadeInUp {
           from { opacity: 0; transform: translateY(30px); }
           to { opacity: 1; transform: translateY(0); }
       }

       .loading-spinner {
           width: 60px;
           height: 60px;
           border: 4px solid rgba(229, 9, 20, 0.2);
           border-top-color: var(--primary);
           border-radius: 50%;
           animation: spin 1s linear infinite;
           margin: 30px auto;
           position: relative;
           box-shadow: 0 0 20px rgba(229, 9, 20, 0.3);
       }

       .loading-spinner::before {
           content: '';
           position: absolute;
           top: -10px;
           left: -10px;
           right: -10px;
           bottom: -10px;
           border: 2px solid transparent;
           border-top-color: rgba(229, 9, 20, 0.5);
           border-radius: 50%;
           animation: spin 2s linear infinite reverse;
       }

       @keyframes spin {
           to { transform: rotate(360deg); }
       }

       .loading-bar {
           width: 300px;
           height: 4px;
           background: rgba(255,255,255,0.1);
           border-radius: 2px;
           overflow: hidden;
           margin: 0 auto 30px;
           position: relative;
           box-shadow: 0 0 10px rgba(229, 9, 20, 0.2);
       }

       .loading-progress {
           height: 100%;
           background: linear-gradient(90deg, var(--primary), #ff0a16, var(--primary));
           background-size: 200% 100%;
           width: 0%;
           animation: loadProgress 3s ease-out forwards, shimmer 2s infinite;
           box-shadow: 0 0 20px var(--primary);
       }

       @keyframes loadProgress {
           0% { width: 0%; }
           100% { width: 100%; }
       }

       @keyframes shimmer {
           0% { background-position: -200% 0; }
           100% { background-position: 200% 0; }
       }

       .tips-container {
           min-height: 60px;
           display: flex;
           flex-direction: column;
           align-items: center;
           justify-content: center;
           margin-top: 20px;
       }

       .tips-label {
           font-size: 12px;
           text-transform: uppercase;
           letter-spacing: 2px;
           color: var(--text-muted);
           margin-bottom: 8px;
           font-weight: 600;
       }

       .tips-text {
           font-size: 16px;
           color: var(--text-secondary);
           font-weight: 500;
           opacity: 0;
           animation: tipFade 4s ease-in-out infinite;
           max-width: 500px;
           line-height: 1.5;
       }

       @keyframes tipFade {
           0%, 20% { opacity: 0; transform: translateY(10px); }
           25%, 75% { opacity: 1; transform: translateY(0); }
           80%, 100% { opacity: 0; transform: translateY(-10px); }
       }

       .loading-stats {
           margin-top: 20px;
           font-size: 13px;
           color: var(--text-muted);
           font-family: monospace;
       }

       .loading-stats span {
           color: var(--primary);
           font-weight: 600;
       }

       /* Hide Loading Screen */
       #loadingScreen.hidden {
           opacity: 0;
           visibility: hidden;
           pointer-events: none;
           transition: opacity 0.8s ease, visibility 0.8s;
       }

       /* Main Content Background */
       .bg-animation {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           z-index: -1;
           overflow: hidden;
           background: radial-gradient(ellipse at top, #141414 0%, var(--bg) 50%);
       }

       .bg-animation::before {
           content: '';
           position: absolute;
           top: -50%;
           left: -50%;
           width: 200%;
           height: 200%;
           background: radial-gradient(circle at 20% 80%, rgba(229, 9, 20, 0.05) 0%, transparent 50%),
                       radial-gradient(circle at 80% 20%, rgba(255, 10, 22, 0.03) 0%, transparent 50%);
           animation: bgPulse 20s ease-in-out infinite;
       }

       @keyframes bgPulse {
           0%, 100% { transform: scale(1) rotate(0deg); }
           50% { transform: scale(1.1) rotate(5deg); }
       }

       .noise {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           pointer-events: none;
           z-index: 9999;
           opacity: 0.02;
           background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
       }

       /* Header */
       header {
           position: fixed;
           top: 0;
           left: 0;
           right: 0;
           height: 70px;
           background: linear-gradient(to bottom, rgba(0, 0, 0, 0.95) 0%, rgba(0, 0, 0, 0.8) 50%, transparent 100%);
           backdrop-filter: blur(20px) saturate(180%);
           z-index: 1000;
           display: flex;
           align-items: center;
           justify-content: space-between;
           padding: 0 4%;
           transition: all 0.3s ease;
       }

       header.scrolled {
           background: rgba(0, 0, 0, 0.98);
           box-shadow: 0 4px 30px rgba(0,0,0,0.8);
       }

       .logo {
           font-size: 28px;
           font-weight: 900;
           background: linear-gradient(135deg, var(--primary) 0%, #ff0a16 100%);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
           letter-spacing: -1px;
           text-transform: uppercase;
           cursor: pointer;
       }

       .nav-links {
           display: flex;
           gap: 32px;
           align-items: center;
       }

       .nav-links a {
           color: var(--text-secondary);
           text-decoration: none;
           font-size: 14px;
           font-weight: 600;
           transition: all 0.3s ease;
           cursor: pointer;
           position: relative;
           padding: 8px 0;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .nav-links a::before {
           content: '';
           position: absolute;
           bottom: 0;
           left: 0;
           width: 100%;
           height: 2px;
           background: var(--primary);
           transform: scaleX(0);
           transform-origin: right;
           transition: transform 0.3s ease;
       }

       .nav-links a:hover, .nav-links a.active {
           color: var(--text);
       }

       .nav-links a:hover::before, .nav-links a.active::before {
           transform: scaleX(1);
           transform-origin: left;
       }

       .my-list-badge {
           background: var(--primary);
           color: #fff;
           padding: 2px 8px;
           border-radius: 12px;
           font-size: 11px;
           margin-left: 6px;
           font-weight: 800;
       }

       .mobile-menu-btn {
           display: none;
           background: none;
           border: none;
           color: var(--text);
           font-size: 24px;
           cursor: pointer;
           padding: 8px;
           border-radius: 8px;
       }

       .mobile-nav {
           display: none;
           position: fixed;
           top: 70px;
           left: 0;
           right: 0;
           background: var(--glass);
           backdrop-filter: blur(20px);
           padding: 20px;
           z-index: 999;
           border-bottom: 1px solid var(--border);
       }

       .mobile-nav.active {
           display: block;
           animation: slideDown 0.3s ease;
       }

       @keyframes slideDown {
           from { opacity: 0; transform: translateY(-10px); }
           to { opacity: 1; transform: translateY(0); }
       }

       .mobile-nav a {
           display: block;
           color: var(--text);
           text-decoration: none;
           padding: 16px;
           font-size: 16px;
           font-weight: 500;
           border-radius: 12px;
           margin-bottom: 4px;
       }

       .server-selector {
           display: flex;
           align-items: center;
           gap: 8px;
           margin-left: 20px;
           padding-left: 20px;
           border-left: 1px solid var(--border);
       }

       .server-label {
           color: var(--text-muted);
           font-size: 12px;
           font-weight: 600;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .server-select {
           background: var(--surface);
           color: var(--text);
           border: 1px solid var(--border);
           border-radius: 6px;
           padding: 6px 28px 6px 12px;
           font-size: 13px;
           font-weight: 500;
           cursor: pointer;
           appearance: none;
           background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b6b6b' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
           background-repeat: no-repeat;
           background-position: right 10px center;
           transition: all 0.2s;
           min-width: 140px;
       }

       .server-select:hover, .server-select:focus {
           border-color: var(--primary);
           outline: none;
       }

       .hero-section {
           margin-top: 0;
           min-height: 85vh;
           display: flex;
           align-items: flex-end;
           padding: 80px 4%;
           padding-bottom: 120px;
           background: linear-gradient(to top, var(--bg) 0%, transparent 50%), 
                       url('https://images.unsplash.com/photo-1536440136628-849c177e76a1?w=1920&q=80') center/cover;
           position: relative;
       }

       .hero-section::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           right: 0;
           bottom: 0;
           background: linear-gradient(to right, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.4) 50%, transparent 100%);
       }

       .hero-content {
           max-width: 800px;
           position: relative;
           z-index: 2;
           animation: fadeInUp 0.8s ease;
       }

       .hero-title {
           font-size: 72px;
           font-weight: 900;
           margin-bottom: 24px;
           line-height: 1.1;
           letter-spacing: -3px;
           color: #fff;
           text-shadow: 0 2px 20px rgba(0,0,0,0.5);
       }

       .hero-subtitle {
           font-size: 20px;
           color: var(--text-secondary);
           margin-bottom: 40px;
           line-height: 1.7;
           max-width: 600px;
       }

       .search-container {
           display: flex;
           gap: 12px;
           max-width: 800px;
           align-items: stretch;
       }

       .search-wrapper {
           flex: 1;
           position: relative;
       }

       .search-box {
           width: 100%;
           display: flex;
           align-items: center;
           background: rgba(255,255,255,0.1);
           border: 2px solid transparent;
           border-radius: 8px;
           padding: 4px 4px 4px 48px;
           transition: all 0.2s ease;
           backdrop-filter: blur(10px);
       }

       .search-box:focus-within {
           background: rgba(255,255,255,0.15);
           border-color: var(--primary);
           box-shadow: 0 0 0 3px rgba(229, 9, 20, 0.2);
       }

       .search-icon {
           position: absolute;
           left: 16px;
           top: 50%;
           transform: translateY(-50%);
           color: var(--text-muted);
           font-size: 18px;
           pointer-events: none;
           transition: color 0.2s;
       }

       .search-box:focus-within .search-icon {
           color: var(--primary);
       }

       #searchInput {
           flex: 1;
           background: transparent;
           border: none;
           color: var(--text);
           font-size: 16px;
           font-weight: 500;
           padding: 12px 8px;
           outline: none;
       }

       #searchInput::placeholder {
           color: var(--text-muted);
       }

       .search-clear {
           width: 28px;
           height: 28px;
           border-radius: 50%;
           background: rgba(255,255,255,0.1);
           border: none;
           color: var(--text-muted);
           cursor: pointer;
           display: flex;
           align-items: center;
           justify-content: center;
           font-size: 14px;
           opacity: 0;
           transition: all 0.2s;
           margin-right: 4px;
       }

       .search-clear.visible {
           opacity: 1;
       }

       .search-clear:hover {
           background: rgba(229, 9, 20, 0.2);
           color: var(--primary);
       }

       .search-btn {
           background: var(--primary);
           color: #fff;
           border: none;
           padding: 0 24px;
           border-radius: 8px;
           font-size: 15px;
           font-weight: 700;
           cursor: pointer;
           display: flex;
           align-items: center;
           gap: 8px;
           transition: all 0.2s ease;
           white-space: nowrap;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .search-btn:hover {
           background: var(--primary-dark);
           transform: translateY(-1px);
       }

       .search-btn:active {
           transform: scale(0.98);
       }

       .filter-wrapper {
           position: relative;
           min-width: 140px;
       }

       #ratingSelect {
           width: 100%;
           padding: 14px 36px 14px 16px;
           border-radius: 8px;
           font-size: 14px;
           font-weight: 600;
           background: rgba(255,255,255,0.1);
           color: var(--text);
           border: 2px solid transparent;
           cursor: pointer;
           appearance: none;
           transition: all 0.2s;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       #ratingSelect:hover, #ratingSelect:focus {
           background: rgba(255,255,255,0.15);
           border-color: rgba(255,255,255,0.2);
           outline: none;
       }

       .filter-arrow {
           position: absolute;
           right: 12px;
           top: 50%;
           transform: translateY(-50%);
           color: var(--text-muted);
           pointer-events: none;
           font-size: 10px;
       }

       .category-section {
           margin: 60px 0;
           padding: 0 4%;
       }

       .category-header {
           display: flex;
           align-items: center;
           justify-content: space-between;
           margin-bottom: 20px;
       }

       .category-title {
           font-size: 18px;
           font-weight: 800;
           display: flex;
           align-items: center;
           gap: 12px;
           text-transform: uppercase;
           letter-spacing: 1px;
           color: var(--text);
       }

       .category-title::before {
           content: '';
           width: 4px;
           height: 24px;
           background: var(--primary);
           border-radius: 2px;
       }

       .view-all {
           color: var(--text-secondary);
           font-size: 13px;
           font-weight: 600;
           cursor: pointer;
           transition: color 0.2s;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .view-all:hover {
           color: var(--primary);
       }

       .row-container {
           position: relative;
           margin: 0 -4%;
           padding: 0 4%;
       }

       .movie-row {
           display: flex;
           gap: 16px;
           overflow-x: auto;
           scroll-behavior: smooth;
           padding: 20px 0;
           scrollbar-width: thin;
           scrollbar-color: var(--primary) transparent;
           scroll-snap-type: x mandatory;
       }

       .movie-row::-webkit-scrollbar {
           height: 4px;
       }

       .movie-row::-webkit-scrollbar-thumb {
           background: var(--primary);
           border-radius: 2px;
       }

       .card {
           flex: 0 0 auto;
           border-radius: 4px;
           overflow: hidden;
           cursor: pointer;
           position: relative;
           transition: transform 0.3s ease, box-shadow 0.3s ease;
           background: var(--surface);
           scroll-snap-align: start;
           width: 160px;
           height: 240px;
       }

       .card-medium {
           width: 200px;
           height: 300px;
       }

       .card-large {
           width: 280px;
           height: 420px;
       }

       .card-xl {
           width: 340px;
           height: 510px;
       }

       .card-wide {
           width: 160px;
           height: 240px;
       }

       @media (min-width: 1200px) {
           .card { width: 180px; height: 270px; }
           .card-medium { width: 240px; height: 360px; }
           .card-large { width: 320px; height: 480px; }
           .card-xl { width: 400px; height: 600px; }
           .card-wide { width: 180px; height: 270px; }
       }

       @media (min-width: 1600px) {
           .card { width: 200px; height: 300px; }
           .card-medium { width: 280px; height: 420px; }
           .card-large { width: 380px; height: 570px; }
           .card-xl { width: 480px; height: 720px; }
           .card-wide { width: 200px; height: 300px; }
       }

       .card:hover {
           transform: scale(1.05);
           z-index: 10;
           box-shadow: 0 20px 40px rgba(0,0,0,0.8);
       }

       .card img {
           width: 100%;
           height: 100%;
           object-fit: cover;
           display: block;
       }

       .card-overlay {
           position: absolute;
           bottom: 0;
           left: 0;
           right: 0;
           padding: 60px 12px 12px;
           background: linear-gradient(to top, rgba(0,0,0,0.95) 0%, rgba(0,0,0,0.6) 50%, transparent 100%);
           opacity: 0;
           transition: opacity 0.3s;
       }

       .card:hover .card-overlay {
           opacity: 1;
       }

       .card-title {
           font-size: 14px;
           font-weight: 700;
           white-space: nowrap;
           overflow: hidden;
           text-overflow: ellipsis;
           margin-bottom: 4px;
       }

       .card-rating {
           font-size: 12px;
           color: var(--primary);
           font-weight: 600;
       }

       .add-to-list-btn {
           position: absolute;
           top: 8px;
           right: 8px;
           width: 32px;
           height: 32px;
           background: rgba(0,0,0,0.6);
           border: 2px solid rgba(255,255,255,0.3);
           border-radius: 50%;
           color: var(--text);
           cursor: pointer;
           opacity: 0;
           transition: all 0.2s;
           display: flex;
           align-items: center;
           justify-content: center;
           font-size: 18px;
           z-index: 20;
       }

       .card:hover .add-to-list-btn {
           opacity: 1;
       }

       .add-to-list-btn:hover {
           background: var(--primary);
           border-color: var(--primary);
           color: #fff;
       }

       .add-to-list-btn.in-list {
           background: var(--primary);
           border-color: var(--primary);
           color: #fff;
           opacity: 1;
       }

       .bookmark-badge {
           position: absolute;
           top: 0;
           left: 12px;
           padding: 6px 10px;
           font-size: 10px;
           font-weight: 800;
           text-transform: uppercase;
           border-radius: 0 0 4px 4px;
           z-index: 5;
           box-shadow: 0 2px 8px rgba(0,0,0,0.3);
       }

       .badge-new-release { background: var(--badge-new); color: #fff; }
       .badge-fan-favorite { background: var(--badge-fan); color: #000; }
       .badge-trending { background: var(--badge-trending); color: #fff; }
       .badge-binge { background: linear-gradient(135deg, #10b981, #059669); color: #fff; }
       .badge-scifi { background: var(--badge-scifi); color: #fff; }
       .badge-horror { background: var(--badge-horror); color: #fff; }
       .badge-action { background: var(--badge-action); color: #fff; }
       .badge-romance { background: #ff006e; color: #fff; }
       .badge-drama { background: #3a86ff; color: #fff; }
       .badge-thriller { background: #8338ec; color: #fff; }
       .badge-animation { background: #ffbe0b; color: #000; }
       .badge-documentary { background: #8b5cf6; color: #fff; }
       .badge-crime { background: #dc2626; color: #fff; }
       .badge-mystery { background: #0891b2; color: #fff; }
       .badge-fantasy { background: #7c3aed; color: #fff; }
       .badge-family { background: #10b981; color: #fff; }
       .badge-adventure { background: #f59e0b; color: #000; }

       .progress-bar {
           position: absolute;
           bottom: 0;
           left: 0;
           right: 0;
           height: 3px;
           background: rgba(255,255,255,0.2);
       }

       .progress-fill {
           height: 100%;
           background: var(--primary);
       }

       #continueWatchingSection, #nowPlayingSection, #myListSection, #newEpisodesSection {
           display: none;
           padding: 30px 4%;
           margin: 20px 0;
       }

       #continueWatchingSection.active, #nowPlayingSection.active, #myListSection.active, #newEpisodesSection.active {
           display: block;
           animation: fadeIn 0.4s ease;
       }

       @keyframes fadeIn {
           from { opacity: 0; }
           to { opacity: 1; }
       }

       #detailsModal {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.95);
           display: none;
           align-items: flex-start;
           justify-content: center;
           z-index: 10000;
           padding: 40px 20px;
           overflow-y: auto;
           opacity: 0;
           transition: opacity 0.3s ease;
       }

       #detailsModal.active {
           display: flex;
           opacity: 1;
       }

       #detailsContent {
           width: 100%;
           max-width: 900px;
           background: var(--surface);
           border-radius: 12px;
           overflow: hidden;
           border: 1px solid var(--border);
           transform: scale(0.95);
           opacity: 0;
           transition: all 0.3s ease;
       }

       #detailsModal.active #detailsContent {
           transform: scale(1);
           opacity: 1;
       }

       #posterContainer {
           position: relative;
           width: 100%;
           padding-bottom: 56.25%;
           background: #000;
       }

       #posterImage {
           position: absolute;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           object-fit: cover;
       }

       .modal-close-btn {
           position: fixed;
           top: 20px;
           right: 20px;
           width: 44px;
           height: 44px;
           background: rgba(0,0,0,0.8);
           border: 1px solid rgba(255,255,255,0.2);
           color: var(--text);
           border-radius: 50%;
           font-size: 20px;
           cursor: pointer;
           z-index: 10001;
           display: flex;
           align-items: center;
           justify-content: center;
           transition: all 0.2s;
       }

       .modal-close-btn:hover {
           background: var(--primary);
           color: #fff;
           transform: rotate(90deg);
       }

       .details-info {
           padding: 30px;
           margin-top: -60px;
           position: relative;
           z-index: 2;
       }

       .details-title {
           font-size: 32px;
           font-weight: 800;
           margin-bottom: 12px;
       }

       .details-meta {
           display: flex;
           gap: 12px;
           align-items: center;
           margin-bottom: 20px;
           flex-wrap: wrap;
           color: var(--text-secondary);
           font-size: 14px;
       }

       .details-rating {
           background: var(--primary);
           color: #fff;
           padding: 4px 10px;
           border-radius: 4px;
           font-weight: 800;
           font-size: 12px;
       }

       .match-score {
           color: var(--primary);
           font-weight: 700;
       }

       .details-actions {
           display: flex;
           gap: 10px;
           margin-bottom: 20px;
           flex-wrap: wrap;
       }

       .btn-primary, .btn-secondary, .btn-download {
           padding: 12px 24px;
           border-radius: 8px;
           font-size: 14px;
           font-weight: 700;
           cursor: pointer;
           border: none;
           display: flex;
           align-items: center;
           gap: 8px;
           transition: all 0.2s;
           text-transform: uppercase;
           letter-spacing: 0.5px;
       }

       .btn-primary {
           background: var(--text);
           color: #000;
       }

       .btn-primary:hover {
           background: rgba(255,255,255,0.9);
           transform: translateY(-1px);
       }

       .btn-secondary {
           background: rgba(255,255,255,0.1);
           color: var(--text);
       }

       .btn-secondary:hover {
           background: rgba(255,255,255,0.2);
       }

       .btn-download {
           background: var(--primary);
           color: #fff;
       }

       .btn-red {
           background: var(--primary) !important;
           color: #fff !important;
       }

       #detailsBody {
           padding: 0 30px 30px;
       }

       .details-section {
           margin-bottom: 24px;
       }

       .details-section h3 {
           font-size: 12px;
           text-transform: uppercase;
           color: var(--text-muted);
           margin-bottom: 12px;
           letter-spacing: 1px;
           font-weight: 700;
       }

       .details-section p {
           color: var(--text-secondary);
           line-height: 1.7;
           font-size: 15px;
       }

       .cast-list {
           display: flex;
           gap: 8px;
           flex-wrap: wrap;
       }

       .cast-member {
           background: var(--surface-light);
           padding: 8px 16px;
           border-radius: 20px;
           font-size: 13px;
           border: 1px solid var(--border);
           font-weight: 500;
       }

       .episode-selector {
           background: var(--surface-light);
           border-radius: 12px;
           padding: 20px;
           margin-top: 20px;
           border: 1px solid var(--border);
       }

       .selector-row {
           display: flex;
           gap: 12px;
           margin-bottom: 16px;
           align-items: center;
       }

       .selector-label {
           font-size: 12px;
           color: var(--text-muted);
           min-width: 70px;
           text-transform: uppercase;
           font-weight: 700;
           letter-spacing: 0.5px;
       }

       .selector-select {
           flex: 1;
           padding: 12px 16px;
           background: var(--surface);
           border: 1px solid var(--border);
           border-radius: 8px;
           color: var(--text);
           font-size: 14px;
           cursor: pointer;
           font-weight: 500;
       }

       #playerModal {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           background: rgba(0,0,0,0.98);
           display: none;
           align-items: center;
           justify-content: center;
           z-index: 20000;
           padding: 20px;
           opacity: 0;
           transition: opacity 0.3s;
       }

       #playerModal.active {
           display: flex;
           opacity: 1;
       }

       #playerContent {
           width: 100%;
           max-width: 1200px;
           aspect-ratio: 16/9;
           background: #000;
           border-radius: 12px;
           overflow: hidden;
           position: relative;
           transform: scale(0.95);
           transition: transform 0.3s;
       }

       #playerModal.active #playerContent {
           transform: scale(1);
       }

       #playerIframe {
           width: 100%;
           height: 100%;
           border: none;
       }

       .player-close-btn {
           position: absolute;
           top: -50px;
           right: 0;
           background: rgba(255,255,255,0.1);
           border: 1px solid rgba(255,255,255,0.2);
           color: var(--text);
           padding: 10px 20px;
           border-radius: 20px;
           cursor: pointer;
           font-size: 14px;
           font-weight: 600;
           transition: all 0.2s;
       }

       .player-close-btn:hover {
           background: var(--primary);
           color: #fff;
       }

       #searchResults {
           display: none;
           padding: 90px 4% 40px;
           min-height: 50vh;
           animation: fadeIn 0.4s ease;
       }

       #searchResults.active {
           display: block;
       }

       .search-grid {
           display: grid;
           grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
           gap: 20px;
       }

       @media (min-width: 1200px) {
           .search-grid {
               grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
           }
       }

       #discoverMoreSection {
           padding: 80px 4%;
           margin-top: 60px;
           border-top: 1px solid var(--border);
           background: linear-gradient(to bottom, var(--bg), var(--surface));
       }

       .discover-header {
           text-align: center;
           margin-bottom: 50px;
       }

       .discover-title {
           font-size: 42px;
           font-weight: 900;
           margin-bottom: 16px;
           color: #fff;
           text-transform: uppercase;
           letter-spacing: -1px;
       }

       .discover-subtitle {
           color: var(--text-secondary);
           font-size: 18px;
           max-width: 600px;
           margin: 0 auto;
           line-height: 1.6;
       }

       .discover-stats {
           display: flex;
           justify-content: center;
           gap: 60px;
           margin-top: 32px;
           flex-wrap: wrap;
       }

       .stat-item {
           text-align: center;
       }

       .stat-number {
           font-size: 36px;
           font-weight: 900;
           color: var(--primary);
           display: block;
           margin-bottom: 4px;
       }

       .stat-label {
           font-size: 12px;
           color: var(--text-muted);
           text-transform: uppercase;
           letter-spacing: 2px;
           font-weight: 700;
       }

       .discover-grid {
           display: grid;
           grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
           gap: 20px;
           margin-bottom: 50px;
       }

       @media (min-width: 768px) {
           .discover-grid {
               grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
           }
       }

       @media (min-width: 1200px) {
           .discover-grid {
               grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
           }
       }

       @media (min-width: 1600px) {
           .discover-grid {
               grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
           }
       }

       .load-more-container {
           text-align: center;
           padding: 40px 0;
       }

       .load-more-btn {
           background: transparent;
           color: var(--text);
           border: 2px solid var(--text-secondary);
           padding: 16px 48px;
           border-radius: 30px;
           font-size: 14px;
           font-weight: 700;
           cursor: pointer;
           transition: all 0.3s ease;
           display: inline-flex;
           align-items: center;
           gap: 12px;
           text-transform: uppercase;
           letter-spacing: 1px;
       }

       .load-more-btn:hover {
           background: var(--primary);
           border-color: var(--primary);
           color: #fff;
           transform: translateY(-2px);
           box-shadow: 0 10px 30px rgba(229, 9, 20, 0.3);
       }

       .load-more-btn:disabled {
           opacity: 0.5;
           cursor: not-allowed;
           transform: none;
           background: transparent;
           color: var(--text-muted);
           border-color: var(--text-muted);
       }

       .load-more-btn.loading {
           pointer-events: none;
       }

       .load-more-btn.loading::after {
           content: '';
           width: 20px;
           height: 20px;
           border: 2px solid rgba(255,255,255,0.3);
           border-top-color: #fff;
           border-radius: 50%;
           animation: spin 0.8s linear infinite;
       }

       .toast {
           position: fixed;
           bottom: 30px;
           left: 50%;
           transform: translateX(-50%) translateY(100px);
           background: var(--surface-light);
           color: var(--text);
           padding: 16px 28px;
           border-radius: 8px;
           border: 1px solid var(--border);
           z-index: 30000;
           opacity: 0;
           transition: all 0.3s;
           font-weight: 600;
           box-shadow: 0 10px 40px rgba(0,0,0,0.5);
       }

       .toast.show {
           opacity: 1;
           transform: translateX(-50%) translateY(0);
       }

       .loading-container {
           display: flex;
           justify-content: center;
           padding: 60px;
       }

       .spinner {
           width: 40px;
           height: 40px;
           border: 3px solid rgba(255,255,255,0.1);
           border-top-color: var(--primary);
           border-radius: 50%;
           animation: spin 0.8s linear infinite;
       }

       .empty-state {
           color: var(--text-muted);
           padding: 60px 40px;
           text-align: center;
           font-size: 16px;
           width: 100%;
       }

       @media (max-width: 768px) {
           .search-container {
               flex-direction: column;
           }
           
           .search-btn {
               width: 100%;
               justify-content: center;
               padding: 14px;
           }
           
           .hero-title { font-size: 40px; }
           .hero-section { min-height: 70vh; padding-top: 100px; }
           .mobile-menu-btn { display: flex; }
           .nav-links { display: none; }
           
           .card { width: 120px; height: 180px; }
           .card-medium { width: 140px; height: 210px; }
           .card-large { width: 200px; height: 300px; }
           .card-xl { width: 260px; height: 390px; }
           .card-wide { width: 120px; height: 180px; }
           
           #detailsModal {
               padding: 0;
               align-items: flex-end;
           }
           
           #detailsContent {
               border-radius: 20px 20px 0 0;
               max-height: 90vh;
               overflow-y: auto;
           }
           
           .modal-close-btn {
               top: 10px;
               right: 10px;
           }
           
           .details-actions {
               flex-direction: column;
           }
           
           .btn-primary, .btn-secondary, .btn-download {
               width: 100%;
               justify-content: center;
           }

           .server-selector {
               margin-left: 10px;
               padding-left: 10px;
           }
           
           .server-label {
               display: none;
           }
           
           .server-select {
               min-width: 100px;
               font-size: 12px;
           }

           .loading-logo {
               font-size: 40px;
           }

           .tips-text {
               font-size: 14px;
               padding: 0 20px;
           }

           .discover-title {
               font-size: 32px;
           }

           .discover-stats {
               gap: 30px;
           }

           .stat-number {
               font-size: 28px;
           }

           .featured-card {
               width: 100px;
               height: 150px;
           }

           .featured-grid {
               gap: 12px;
           }

           .featured-info {
               display: none;
           }

           .loading-content {
               margin: 20px;
               padding: 30px 20px;
           }
       }
   </style>


   <!-- FIXED: Loading Screen with Anime Background -->
   <div id="loadingScreen">
       <!-- Anime Cyberpunk Background Layers -->
       <div class="anime-bg-container">
           <div class="anime-bg-layer"></div>
           <div class="anime-gradient-overlay"></div>
           <div class="neon-grid"></div>
           <div class="scanlines"></div>
           <div class="particles-container" id="particlesContainer"></div>
           <div class="vignette"></div>
       </div>

       <div class="loading-content">
           <div class="loading-logo">GN-STREAM</div>
           
           <!-- Featured Top Picks Section -->
           <div class="featured-section">
               <div class="featured-label"> Top Picks For You</div>
               <div class="featured-grid">
                   <!-- Featured Card 1: Squid Game -->
                   <div class="featured-card" onclick="event.stopPropagation(); showToast('Squid Game S2 coming soon!', 'info')">
                       <div class="featured-badge">Trending #1</div>
                       <img src="https://kimi-web-img.moonshot.cn/img/static1.srcdn.com/a5ff13ae8e2b9d9ca2d9c27ce48a92593d836a80.jpg" alt="Squid Game">
                       <div class="featured-info">
                           <div class="featured-title">Squid Game</div>
                           <div class="featured-meta"> 4.9  Thriller  2024</div>
                       </div>
                   </div>

                   <!-- Featured Card 2: Dune Part Two -->
                   <div class="featured-card" onclick="event.stopPropagation(); showToast('Dune: Part Two available now!', 'success')">
                       <div class="featured-badge">New Release</div>
                       <img src="https://kimi-web-img.moonshot.cn/img/upload.wikimedia.org/c051930bc69f134c981b7f47701a56d786faa4da.jpeg" alt="Dune Part Two">
                       <div class="featured-info">
                           <div class="featured-title">Dune: Part Two</div>
                           <div class="featured-meta"> 4.8  Sci-Fi  2024</div>
                       </div>
                   </div>

                   <!-- Featured Card 3: The Witcher -->
                   <div class="featured-card" onclick="event.stopPropagation(); showToast('The Witcher S4 in production', 'info')">
                       <div class="featured-badge">Fan Favorite</div>
                       <img src="https://kimi-web-img.moonshot.cn/img/i.ebayimg.com/266685e89b8e1baf9ad7c655b1ec127dd738628e.JPG" alt="The Witcher">
                       <div class="featured-info">
                           <div class="featured-title">The Witcher</div>
                           <div class="featured-meta"> 4.7  Fantasy  Series</div>
                       </div>
                   </div>
               </div>
           </div>

           <div class="loading-spinner"></div>
           <div class="loading-bar">
               <div class="loading-progress"></div>
           </div>
           <div class="tips-container">
               <div class="tips-label"> Pro Tip</div>
               <div class="tips-text" id="tipsText">Loading amazing content...</div>
           </div>
           <div class="loading-stats">
               Initializing <span id="serverCount">28</span> streaming servers
           </div>
       </div>
   </div>

   <div class="bg-animation"></div>
   <div class="noise"></div>

   <div class="toast" id="toast"></div>

   <header id="mainHeader">
       <div class="logo" onclick="showHome()">GN-STREAM</div>
       <nav class="nav-links">
           <a onclick="showHome()" class="active" id="nav-home">Home</a>
           <a onclick="showNowPlaying()" id="nav-nowplaying">Now Playing</a>
           <a onclick="showContinueWatching()" id="nav-continue">Continue</a>
           <a onclick="showMyList()" id="nav-mylist">My List <span id="myListCount" class="my-list-badge" style="display:none">0</span></a>
           <a onclick="scrollToSection('movies')" id="nav-movies">Movies</a>
           <a onclick="scrollToSection('tv')" id="nav-tv">TV Shows</a>
           
           <div class="server-selector">
               <span class="server-label">Server</span>
               <select id="serverSelect" class="server-select" onchange="changeServer(this.value)">
                   <option value="1">AutoEmbed Test</option>
                   <option value="2">AutoEmbed Player</option>
                   <option value="3">VidSrc.cc</option>
                   <option value="4">VidSrc.to</option>
                   <option value="5">2Embed</option>
                   <option value="6">MultiEmbed</option>
                   <option value="7">Embed.su</option>
                   <option value="8">VidSrc.xyz</option>
                   <option value="9">VidSrc.me</option>
                   <option value="10">VidSrc.in</option>
                   <option value="11">SuperEmbed</option>
                   <option value="12">MovieEmbed</option>
                   <option value="13">StreamEmbed</option>
                   <option value="14">PrimeWire</option>
                   <option value="15">123Embed</option>
                   <option value="16">GoMovies</option>
                   <option value="17">Fmovies</option>
                   <option value="18">YesMovies</option>
                   <option value="19">SolarMovie</option>
                   <option value="20">PutLocker</option>
                   <option value="21">WatchSeries</option>
                   <option value="22">CouchTuner</option>
                   <option value="23">ProjectFreeTV</option>
                   <option value="24">StreamLord</option>
                   <option value="25">Time4TV</option>
                   <option value="26">USTVGO</option>
                   <option value="27">TVPlayer</option>
                   <option value="28">FreeInterTV</option>
               </select>
           </div>
       </nav>
       <button class="mobile-menu-btn" onclick="toggleMobileMenu()"></button>
   </header>

   <div class="mobile-nav" id="mobileNav">
       <a onclick="showHome(); toggleMobileMenu();"> Home</a>
       <a onclick="showNowPlaying(); toggleMobileMenu();"> Now Playing</a>
       <a onclick="showContinueWatching(); toggleMobileMenu();"> Continue</a>
       <a onclick="showMyList(); toggleMobileMenu();"> My List</a>
       <a onclick="scrollToSection('movies'); toggleMobileMenu();"> Movies</a>
       <a onclick="scrollToSection('tv'); toggleMobileMenu();"> TV Shows</a>
       <div style="padding: 16px; border-top: 1px solid var(--border); margin-top: 8px;">
           <span style="color: var(--text-muted); font-size: 12px; text-transform: uppercase; font-weight: 600; margin-right: 10px;">Server</span>
           <select id="mobileServerSelect" class="server-select" onchange="changeServer(this.value)" style="width: calc(100% - 60px);">
               <option value="1">AutoEmbed Test</option>
               <option value="2">AutoEmbed Player</option>
               <option value="3">VidSrc.cc</option>
               <option value="4">VidSrc.to</option>
               <option value="5">2Embed</option>
               <option value="6">MultiEmbed</option>
               <option value="7">Embed.su</option>
               <option value="8">VidSrc.xyz</option>
               <option value="9">VidSrc.me</option>
               <option value="10">VidSrc.in</option>
               <option value="11">SuperEmbed</option>
               <option value="12">MovieEmbed</option>
               <option value="13">StreamEmbed</option>
               <option value="14">PrimeWire</option>
               <option value="15">123Embed</option>
               <option value="16">GoMovies</option>
               <option value="17">Fmovies</option>
               <option value="18">YesMovies</option>
               <option value="19">SolarMovie</option>
               <option value="20">PutLocker</option>
               <option value="21">WatchSeries</option>
           </select>
       </div>
   </div>

   <div class="hero-section" id="homeHero">
       <div class="hero-content">
           <div class="hero-title">Unlimited Entertainment</div>
           <div class="hero-subtitle">Discover thousands of movies and TV shows in stunning quality. Stream anytime, anywhere.</div>
           
           <div class="search-container">
               <div class="search-wrapper">
                   <div class="search-box">
                       <span class="search-icon"></span>
                       <input id="searchInput" placeholder="Search movies, shows..." autocomplete="off">
                       <button class="search-clear" id="searchClear" onclick="clearSearchInput()"></button>
                   </div>
               </div>
               
               <button class="search-btn" onclick="executeSearch()">
                   Search
               </button>
               
               <div class="filter-wrapper">
                   <select id="ratingSelect">
                       <option value="all">All Ratings</option>
                       <option value="gpg">G / PG</option>
                       <option value="pg13">PG-13</option>
                       <option value="r">R</option>
                       <option value="nc17">NC-17</option>
                   </select>
                   <span class="filter-arrow"></span>
               </div>
           </div>
       </div>
   </div>

   <div id="nowPlayingSection">
       <div class="category-header">
           <div class="category-title"> Now Playing</div>
       </div>
       <div class="movie-row" id="nowPlayingRow"></div>
   </div>

   <div id="continueWatchingSection">
       <div class="category-header">
           <div class="category-title"> Continue Watching</div>
           <div class="view-all" onclick="clearContinueWatching()">Clear</div>
       </div>
       <div class="movie-row" id="continueWatchingRow"></div>
   </div>

   <div id="myListSection">
       <div class="category-header">
           <div class="category-title"> My List</div>
       </div>
       <div class="movie-row" id="myListRow"></div>
   </div>

   <div id="categoriesContainer">
       <div class="category-section" id="section-trending">
           <div class="category-header">
               <div class="category-title"> Trending Now</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="trendingRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-action">
           <div class="category-header">
               <div class="category-title"> Action</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="actionRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-comedy">
           <div class="category-header">
               <div class="category-title"> Comedy</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="comedyRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-horror">
           <div class="category-header">
               <div class="category-title"> Horror</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="horrorRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-scifi">
           <div class="category-header">
               <div class="category-title"> Sci-Fi</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="scifiRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-romance">
           <div class="category-header">
               <div class="category-title"> Romance</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="romanceRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-thriller">
           <div class="category-header">
               <div class="category-title"> Thriller</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="thrillerRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-drama">
           <div class="category-header">
               <div class="category-title"> Drama</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="dramaRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-animation">
           <div class="category-header">
               <div class="category-title"> Animation</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="animationRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-documentary">
           <div class="category-header">
               <div class="category-title"> Documentary</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="documentaryRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-crime">
           <div class="category-header">
               <div class="category-title"> Crime</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="crimeRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-mystery">
           <div class="category-header">
               <div class="category-title"> Mystery</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="mysteryRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-fantasy">
           <div class="category-header">
               <div class="category-title"> Fantasy</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="fantasyRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-family">
           <div class="category-header">
               <div class="category-title"> Family</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="familyRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-adventure">
           <div class="category-header">
               <div class="category-title"> Adventure</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="adventureRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-movies">
           <div class="category-header">
               <div class="category-title"> Popular Movies</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="popularMoviesRow"></div>
           </div>
       </div>

       <div class="category-section" id="section-tv">
           <div class="category-header">
               <div class="category-title"> TV Shows</div>
           </div>
           <div class="row-container">
               <div class="movie-row" id="popularTvRow"></div>
           </div>
       </div>
   </div>

   <div id="discoverMoreSection">
       <div class="discover-header">
           <div class="discover-title">Discover More</div>
           <div class="discover-subtitle">Explore our vast collection of over 2,200,000 movies and 800,000 shows that people are watching right now</div>
           <div class="discover-stats">
               <div class="stat-item">
                   <span class="stat-number" id="totalMovies">2,200,000+</span>
                   <span class="stat-label">Titles</span>
               </div>
               <div class="stat-item">
                   <span class="stat-number" id="totalGenres">25+</span>
                   <span class="stat-label">Genres</span>
               </div>
               <div class="stat-item">
                   <span class="stat-number" id="updatedDaily">Daily</span>
                   <span class="stat-label">Updated</span>
               </div>
           </div>
       </div>
       <div class="discover-grid" id="discoverGrid"></div>
       <div class="load-more-container">
           <button class="load-more-btn" id="loadMoreBtn" onclick="loadDiscoverMore()">
               Load More Titles
           </button>
       </div>
   </div>

   <div id="searchResults">
       <div class="category-header">
           <div class="category-title"> Search Results</div>
           <button class="btn-secondary" onclick="clearSearch()" style="padding: 8px 16px; font-size: 12px;">Back</button>
       </div>
       <div class="search-grid" id="searchResultsGrid"></div>
   </div>

   <div id="detailsModal" onclick="closeDetailsOnBackdrop(event)">
       <button class="modal-close-btn" onclick="closeDetails()"></button>
       
       <div id="detailsContent" onclick="event.stopPropagation()">
           <div id="posterContainer">
               <img id="posterImage" src="" alt="Poster">
           </div>

           <div class="details-info">
               <div class="details-title" id="detailsTitle"></div>
               <div class="details-meta">
                   <span class="match-score" id="matchScore">98% Match</span>
                   <span id="detailsYear"></span>
                   <span id="detailsRuntime"></span>
                   <span class="details-rating" id="detailsRating">NR</span>
                   <span id="detailsGenre"></span>
               </div>
               <div class="details-actions">
                   <button class="btn-primary" onclick="playContent()"> Play</button>
                   <button class="btn-secondary" id="detailsAddToList" onclick="toggleListFromDetails()">+ My List</button>
                   <button class="btn-download" onclick="downloadContent()"> Download</button>
               </div>
               
               <div id="episodeSelector" class="episode-selector" style="display: none;">
                   <div class="selector-row">
                       <span class="selector-label">Season</span>
                       <select id="seasonSelect" class="selector-select" onchange="onSeasonChange()"></select>
                   </div>
                   <div class="selector-row">
                       <span class="selector-label">Episode</span>
                       <select id="episodeSelect" class="selector-select" onchange="onEpisodeChange()"></select>
                   </div>
                   <div id="episodeInfo" class="episode-info"></div>
               </div>
           </div>

           <div id="detailsBody">
               <div class="details-section">
                   <h3>About</h3>
                   <p id="detailsOverview"></p>
               </div>
               <div class="details-section">
                   <h3>Cast</h3>
                   <div class="cast-list" id="detailsCast"></div>
               </div>
           </div>
       </div>
   </div>

   <div id="playerModal" onclick="closePlayerOnBackdrop(event)">
       <div id="playerContent" onclick="event.stopPropagation()">
           <button class="player-close-btn" onclick="closePlayer()"> Close</button>
           <iframe id="playerIframe" allowfullscreen=""></iframe>
       </div>
   </div>

   <script>
       const API_KEY = '3a73619bbb8fc6d47742d1b5b2b707b5';
       const baseURL = 'https://api.themoviedb.org/3';
       const FALLBACK_POSTER = 'https://via.placeholder.com/300x450/141414/6b6b6b?text=No+Poster';
       const FALLBACK_BACKDROP = 'https://via.placeholder.com/1280x720/141414/6b6b6b?text=No+Backdrop';

       let myList = JSON.parse(localStorage.getItem('gnStreamMyList')) || [];
       let continueWatching = JSON.parse(localStorage.getItem('gnStreamContinue')) || [];
       let currentDetailsItem = null;
       let tvSeasonsData = [];
       let scrollPosition = 0;
       let currentServer = localStorage.getItem('gnStreamServer') || '1';
       let discoverPage = 1;
       let discoverTotalLoaded = 0;
       const DISCOVER_TOTAL_TARGET = 600;
       let isLoadingDiscover = false;

       const apiCache = new Map();
       const CACHE_DURATION = 5 * 60 * 1000;

       const tips = [
           "Press ESC to close the video player quickly",
           "Add movies to My List to watch them later",
           "Use the server selector if a stream isn't loading",
           "Continue Watching shows your progress automatically",
           "Click on any poster to see details and cast info",
           "Use the rating filter to find age-appropriate content",
           "Search works for both movies and TV shows",
           "Your watch history is saved locally in your browser",
           "Try different servers for better streaming quality",
           "Click the + button on any card to add to your list",
           "TV shows display season and episode selectors",
           "Download button opens the video in a new tab",
           "Use arrow keys to navigate through movie rows",
           "The match score shows how much you might like it",
           "Click the logo to return to the home page anytime"
       ];

       const GENRES = {
           ACTION: 28,
           COMEDY: 35,
           HORROR: 27,
           SCIFI: 878,
           ROMANCE: 10749,
           THRILLER: 53,
           DRAMA: 18,
           ANIMATION: 16,
           DOCUMENTARY: 99,
           CRIME: 80,
           MYSTERY: 9648,
           FANTASY: 14,
           FAMILY: 10751,
           ADVENTURE: 12
       };

       const GENRE_BADGES = {
           [GENRES.ACTION]: 'badge-action',
           [GENRES.COMEDY]: 'badge-fan-favorite',
           [GENRES.HORROR]: 'badge-horror',
           [GENRES.SCIFI]: 'badge-scifi',
           [GENRES.ROMANCE]: 'badge-romance',
           [GENRES.THRILLER]: 'badge-thriller',
           [GENRES.DRAMA]: 'badge-drama',
           [GENRES.ANIMATION]: 'badge-animation',
           [GENRES.DOCUMENTARY]: 'badge-documentary',
           [GENRES.CRIME]: 'badge-crime',
           [GENRES.MYSTERY]: 'badge-mystery',
           [GENRES.FANTASY]: 'badge-fantasy',
           [GENRES.FAMILY]: 'badge-family',
           [GENRES.ADVENTURE]: 'badge-adventure'
       };

       const CARD_SIZES = {
           TRENDING: 'card-large',
           ACTION: 'card',
           COMEDY: 'card',
           HORROR: 'card',
           SCIFI: 'card',
           ROMANCE: 'card',
           THRILLER: 'card',
           DRAMA: 'card',
           ANIMATION: 'card',
           DOCUMENTARY: 'card',
           CRIME: 'card',
           MYSTERY: 'card',
           FANTASY: 'card',
           FAMILY: 'card',
           ADVENTURE: 'card',
           MOVIES: 'card',
           TV: 'card',
           DEFAULT: 'card'
       };

       const SERVERS = {
           '1': {
               name: 'AutoEmbed Test',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://test.autoembed.cc/embed/tv/${id}/${season}/${episode}?autoplay=true`;
                   }
                   return `https://test.autoembed.cc/embed/movie/${id}?autoplay=true`;
               }
           },
           '2': {
               name: 'AutoEmbed Player',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://player.autoembed.cc/embed/tv/${id}/${season}/${episode}`;
                   }
                   return `https://player.autoembed.cc/embed/movie/${id}`;
               }
           },
           '3': {
               name: 'VidSrc.cc',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://vidsrc.cc/v2/embed/tv/${id}/${season}/${episode}?poster=true&autoPlay=true`;
                   }
                   return `https://vidsrc.cc/v2/embed/movie/${id}?poster=true&autoPlay=true`;
               }
           },
           '4': {
               name: 'VidSrc.to',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://vidsrc.to/embed/tv/${id}/${season}/${episode}`;
                   }
                   return `https://vidsrc.to/embed/movie/${id}`;
               }
           },
           '5': {
               name: '2Embed',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://www.2embed.cc/embedtv/${id}&s=${season}&e=${episode}`;
                   }
                   return `https://www.2embed.cc/embed/${id}`;
               }
           },
           '6': {
               name: 'MultiEmbed',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://multiembed.mov/?video_id=${id}&tmdb=1&s=${season}&e=${episode}`;
                   }
                   return `https://multiembed.mov/?video_id=${id}&tmdb=1`;
               }
           },
           '7': {
               name: 'Embed.su',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://embed.su/embed/tv/${id}/${season}/${episode}`;
                   }
                   return `https://embed.su/embed/movie/${id}`;
               }
           },
           '8': {
               name: 'VidSrc.xyz',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://vidsrc.xyz/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://vidsrc.xyz/embed/movie?tmdb=${id}`;
               }
           },
           '9': {
               name: 'VidSrc.me',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://vidsrc.me/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://vidsrc.me/embed/movie?tmdb=${id}`;
               }
           },
           '10': {
               name: 'VidSrc.in',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://vidsrc.in/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://vidsrc.in/embed/movie?tmdb=${id}`;
               }
           },
           '11': {
               name: 'SuperEmbed',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://multiembed.mov/directstream.php?video_id=${id}&tmdb=1&s=${season}&e=${episode}`;
                   }
                   return `https://multiembed.mov/directstream.php?video_id=${id}&tmdb=1`;
               }
           },
           '12': {
               name: 'MovieEmbed',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://www.2embed.ru/embed/tv/tmdb/${id}?s=${season}&e=${episode}`;
                   }
                   return `https://www.2embed.ru/embed/movie/tmdb/${id}`;
               }
           },
           '13': {
               name: 'StreamEmbed',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://2embed.org/embed/tv/tmdb/${id}?s=${season}&e=${episode}`;
                   }
                   return `https://2embed.org/embed/movie/tmdb/${id}`;
               }
           },
           '14': {
               name: 'PrimeWire',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://www.primewire.tf/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://www.primewire.tf/embed/movie?tmdb=${id}`;
               }
           },
           '15': {
               name: '123Embed',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://www.123embed.net/embed/tv/${id}/${season}/${episode}`;
                   }
                   return `https://www.123embed.net/embed/movie/${id}`;
               }
           },
           '16': {
               name: 'GoMovies',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://gostream.site/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://gostream.site/embed/movie?tmdb=${id}`;
               }
           },
           '17': {
               name: 'Fmovies',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://fmovies.to/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://fmovies.to/embed/movie?tmdb=${id}`;
               }
           },
           '18': {
               name: 'YesMovies',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://yesmovies.ag/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://yesmovies.ag/embed/movie?tmdb=${id}`;
               }
           },
           '19': {
               name: 'SolarMovie',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://solarmovie.pe/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://solarmovie.pe/embed/movie?tmdb=${id}`;
               }
           },
           '20': {
               name: 'PutLocker',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://putlocker.vip/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://putlocker.vip/embed/movie?tmdb=${id}`;
               }
           },
           '21': {
               name: 'WatchSeries',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://watchserieshd.tv/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://watchserieshd.tv/embed/movie?tmdb=${id}`;
               }
           },
           '22': {
               name: 'CouchTuner',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://couchtuner.show/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://couchtuner.show/embed/movie?tmdb=${id}`;
               }
           },
           '23': {
               name: 'ProjectFreeTV',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://projectfreetv.one/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://projectfreetv.one/embed/movie?tmdb=${id}`;
               }
           },
           '24': {
               name: 'StreamLord',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://streamlord.com/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://streamlord.com/embed/movie?tmdb=${id}`;
               }
           },
           '25': {
               name: 'Time4TV',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://time4tv.stream/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://time4tv.stream/embed/movie?tmdb=${id}`;
               }
           },
           '26': {
               name: 'USTVGO',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://ustvgo.tv/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://ustvgo.tv/embed/movie?tmdb=${id}`;
               }
           },
           '27': {
               name: 'TVPlayer',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://tvplayer.io/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://tvplayer.io/embed/movie?tmdb=${id}`;
               }
           },
           '28': {
               name: 'FreeInterTV',
               buildUrl: (id, isTv, season, episode) => {
                   if (isTv) {
                       return `https://freeintertv.com/embed/tv?tmdb=${id}&season=${season}&episode=${episode}`;
                   }
                   return `https://freeintertv.com/embed/movie?tmdb=${id}`;
               }
           }
       };

       const searchInput = document.getElementById('searchInput');
       const searchClear = document.getElementById('searchClear');
       const ratingSelect = document.getElementById('ratingSelect');
       const toast = document.getElementById('toast');
       const detailsModal = document.getElementById('detailsModal');
       const playerModal = document.getElementById('playerModal');
       const serverSelect = document.getElementById('serverSelect');
       const mobileServerSelect = document.getElementById('mobileServerSelect');
       const loadingScreen = document.getElementById('loadingScreen');
       const tipsText = document.getElementById('tipsText');

       serverSelect.value = currentServer;
       mobileServerSelect.value = currentServer;

       // Create floating particles
       function createParticles() {
           const container = document.getElementById('particlesContainer');
           for (let i = 0; i < 50; i++) {
               const particle = document.createElement('div');
               particle.className = 'particle';
               particle.style.left = Math.random() * 100 + '%';
               particle.style.animationDelay = Math.random() * 15 + 's';
               particle.style.animationDuration = (Math.random() * 10 + 10) + 's';
               container.appendChild(particle);
           }
       }

       // Initialize particles
       createParticles();

       let currentTipIndex = 0;
       function rotateTips() {
           tipsText.style.opacity = '0';
           setTimeout(() => {
               currentTipIndex = (currentTipIndex + 1) % tips.length;
               tipsText.textContent = tips[currentTipIndex];
               tipsText.style.opacity = '1';
           }, 500);
       }

       setInterval(rotateTips, 4000);

       // FIXED: Proper loading screen hide after 4 seconds
       setTimeout(() => {
           loadingScreen.classList.add('hidden');
           // Remove from DOM after transition
           setTimeout(() => {
               loadingScreen.style.display = 'none';
           }, 800);
       }, 4000);

       function changeServer(serverValue) {
           currentServer = serverValue;
           localStorage.setItem('gnStreamServer', currentServer);
           
           serverSelect.value = currentServer;
           mobileServerSelect.value = currentServer;
           
           const serverName = SERVERS[currentServer]?.name || `Server ${currentServer}`;
           showToast(`Switched to ${serverName}`, 'success');
       }

       function showToast(message, type = 'info') {
           toast.textContent = message;
           toast.className = `toast ${type}`;
           toast.classList.add('show');
           setTimeout(() => toast.classList.remove('show'), 3000);
       }

       function toggleMobileMenu() {
           document.getElementById('mobileNav').classList.toggle('active');
       }

       window.addEventListener('scroll', () => {
           const header = document.getElementById('mainHeader');
           header.classList.toggle('scrolled', window.scrollY > 50);
       });

       searchInput.addEventListener('input', () => {
           searchClear.classList.toggle('visible', searchInput.value.length > 0);
       });

       searchInput.addEventListener('keydown', (e) => {
           if (e.key === 'Enter') {
               executeSearch();
           }
       });

       function clearSearchInput() {
           searchInput.value = '';
           searchInput.focus();
           searchClear.classList.remove('visible');
       }

       function executeSearch() {
           const query = searchInput.value.trim();
           if (!query) return;
           performSearch(query);
       }

       async function fetchWithCache(url) {
           const cached = apiCache.get(url);
           if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {
               return cached.data;
           }
           try {
               const res = await fetch(url);
               const data = await res.json();
               apiCache.set(url, { data, timestamp: Date.now() });
               return data;
           } catch (e) {
               console.error('Fetch error:', e);
               return null;
           }
       }

       function setActiveNav(id) {
           document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
           document.getElementById(id)?.classList.add('active');
       }

       function hideAllSections() {
           ['nowPlayingSection', 'continueWatchingSection', 'myListSection', 'categoriesContainer', 'searchResults', 'discoverMoreSection'].forEach(id => {
               const el = document.getElementById(id);
               if (el) el.style.display = 'none';
           });
       }

       function showHome() {
           hideAllSections();
           document.getElementById('categoriesContainer').style.display = 'block';
           document.getElementById('discoverMoreSection').style.display = 'block';
           document.getElementById('homeHero').style.display = 'flex';
           setActiveNav('nav-home');
           searchInput.value = '';
           searchClear.classList.remove('visible');
           
           if (continueWatching.length > 0) {
               document.getElementById('continueWatchingSection').style.display = 'block';
               renderContinueWatching();
           }
       }

       function showNowPlaying() {
           hideAllSections();
           document.getElementById('nowPlayingSection').style.display = 'block';
           setActiveNav('nav-nowplaying');
           renderNowPlaying();
       }

       function showContinueWatching() {
           hideAllSections();
           document.getElementById('continueWatchingSection').style.display = 'block';
           setActiveNav('nav-continue');
           renderContinueWatching();
       }

       function showMyList() {
           hideAllSections();
           document.getElementById('myListSection').style.display = 'block';
           setActiveNav('nav-mylist');
           renderMyList();
       }

       function scrollToSection(section) {
           showHome();
           setTimeout(() => {
               document.getElementById(`section-${section}`)?.scrollIntoView({ behavior: 'smooth' });
           }, 100);
       }

       function clearSearch() {
           showHome();
       }

       async function getCertification(item) {
           try {
               const endpoint = item.media_type === 'tv' || item.first_air_date ? 'tv' : 'movie';
               const url = endpoint === 'tv' 
                   ? `${baseURL}/tv/${item.id}/content_ratings?api_key=${API_KEY}`
                   : `${baseURL}/movie/${item.id}/release_dates?api_key=${API_KEY}`;
               const data = await fetchWithCache(url);
               if (endpoint === 'tv') {
                   return data?.results?.find(r => r.iso_3166_1 === 'US')?.rating || 'NR';
               }
               return data?.results?.find(r => r.iso_3166_1 === 'US')?.release_dates?.[0]?.certification || 'NR';
           } catch (e) {
               return 'NR';
           }
       }

       function certMatchesGroup(cert, group) {
           if (group === 'all') return true;
           cert = (cert || '').toUpperCase();
           if (group === 'gpg') return ['G','PG','TV-Y','TV-G','TV-Y7'].includes(cert);
           if (group === 'pg13') return cert === 'PG-13' || cert === 'TV-14';
           if (group === 'r') return cert === 'R' || cert === 'TV-MA';
           if (group === 'nc17') return cert === 'NC-17';
           return false;
       }

       function getGenreBadge(genreIds) {
           if (!genreIds || genreIds.length === 0) return '';
           
           for (const genreId of genreIds) {
               if (GENRE_BADGES[genreId]) {
                   const genreName = Object.keys(GENRES).find(key => GENRES[key] === genreId) || 'Genre';
                   return `<div class="bookmark-badge ${GENRE_BADGES[genreId]}">${genreName}</div>`;
               }
           }
           return '';
       }

       function createCard(item, container, index = 0, cardSizeClass = 'card') {
           const cert = item._cert || 'NR';
           const card = document.createElement('div');
           card.className = `card ${cardSizeClass}`;
           card.dataset.id = item.id;
           
           const inList = myList.some(i => i.id === item.id);
           
           const imageUrl = item.poster_path 
               ? `https://image.tmdb.org/t/p/w342${item.poster_path}`
               : FALLBACK_POSTER;
           
           const badge = getGenreBadge(item.genre_ids);
           
           card.innerHTML = `
               ${badge}
               <img src="${imageUrl}" alt="${item.title || item.name}" loading="lazy" onerror="this.src='${FALLBACK_POSTER}'">
               <div class="card-overlay">
                   <div class="card-title">${item.title || item.name}</div>
                   <div class="card-rating"> ${(item.vote_average || 0).toFixed(1)}  ${cert}</div>
               </div>
               <button class="add-to-list-btn ${inList ? 'in-list' : ''}" data-item-id="${item.id}">
                   ${inList ? '' : '+'}
               </button>
           `;
           
           card.addEventListener('click', (e) => {
               if (e.target.closest('.add-to-list-btn')) {
                   e.stopPropagation();
                   toggleMyList(item);
               } else {
                   openDetails(item);
               }
           });
           
           container.appendChild(card);
       }

       function toggleMyList(item) {
           const index = myList.findIndex(i => i.id === item.id);
           const isAdding = index === -1;
           
           if (isAdding) {
               myList.push(item);
               showToast('Added to My List', 'success');
           } else {
               myList.splice(index, 1);
               showToast('Removed from My List', 'info');
           }
           
           localStorage.setItem('gnStreamMyList', JSON.stringify(myList));
           updateMyListCount();
           
           updateAllListButtonStates(item.id, isAdding);
           
           if (document.getElementById('myListSection').style.display === 'block') {
               renderMyList();
           }
           
           if (currentDetailsItem && currentDetailsItem.id === item.id) {
               updateDetailsListButton();
           }
       }

       function updateAllListButtonStates(itemId, isInList) {
           document.querySelectorAll(`.add-to-list-btn[data-item-id="${itemId}"]`).forEach(btn => {
               btn.classList.toggle('in-list', isInList);
               btn.innerHTML = isInList ? '' : '+';
           });
       }

       function updateDetailsListButton() {
           const listBtn = document.getElementById('detailsAddToList');
           if (!listBtn || !currentDetailsItem) return;
           
           const inList = myList.some(i => i.id === currentDetailsItem.id);
           listBtn.innerHTML = inList ? ' In My List' : '+ My List';
           listBtn.classList.toggle('btn-red', inList);
       }

       function toggleListFromDetails() {
           if (!currentDetailsItem) return;
           toggleMyList(currentDetailsItem);
       }

       function updateMyListCount() {
           const count = myList.length;
           const badge = document.getElementById('myListCount');
           if (count > 0) {
               badge.textContent = count > 99 ? '99+' : count;
               badge.style.display = 'inline';
           } else {
               badge.style.display = 'none';
           }
       }

       function renderContinueWatching() {
           const container = document.getElementById('continueWatchingRow');
           container.innerHTML = '';
           if (continueWatching.length === 0) {
               container.innerHTML = '<div class="empty-state">No movies in progress</div>';
               return;
           }
           continueWatching.forEach(item => {
               const card = document.createElement('div');
               card.className = 'card card-medium';
               const progress = Math.min(100, Math.round((item.progress / item.duration) * 100));
               
               const imageUrl = item.poster_path 
                   ? `https://image.tmdb.org/t/p/w342${item.poster_path}`
                   : FALLBACK_POSTER;
               
               card.innerHTML = `
                   <div class="bookmark-badge badge-binge">Resume</div>
                   <img src="${imageUrl}" alt="${item.title || item.name}" onerror="this.src='${FALLBACK_POSTER}'">
                   <div class="progress-bar"><div class="progress-fill" style="width: ${progress}%"></div></div>
                   <div class="card-overlay">
                       <div class="card-title">${item.title || item.name}</div>
                   </div>
               `;
               card.onclick = () => openDetails(item);
               container.appendChild(card);
           });
       }

       async function renderNowPlaying() {
           const container = document.getElementById('nowPlayingRow');
           container.innerHTML = '<div class="loading-container"><div class="spinner"></div></div>';
           
           const data = await fetchWithCache(`${baseURL}/movie/now_playing?api_key=${API_KEY}&language=en-US&page=1`);
           container.innerHTML = '';
           
           if (!data?.results) {
               container.innerHTML = '<div class="empty-state">Failed to load movies</div>';
               return;
           }
           
           for (const item of data.results.slice(0, 20)) {
               item.media_type = 'movie';
               item._cert = await getCertification(item);
               createCard(item, container, 0, 'card-large');
           }
       }

       function renderMyList() {
           const container = document.getElementById('myListRow');
           container.innerHTML = '';
           if (myList.length === 0) {
               container.innerHTML = '<div class="empty-state">Your list is empty. Add movies by clicking the + button on any poster.</div>';
               return;
           }
           myList.forEach(item => createCard(item, container, 0, 'card'));
       }

       function clearContinueWatching() {
           if (confirm('Clear history?')) {
               continueWatching = [];
               localStorage.setItem('gnStreamContinue', '[]');
               renderContinueWatching();
               showToast('History cleared', 'success');
           }
       }

       async function performSearch(query) {
           hideAllSections();
           document.getElementById('searchResults').style.display = 'block';
           document.getElementById('homeHero').style.display = 'none';
           
           const grid = document.getElementById('searchResultsGrid');
           grid.innerHTML = '<div class="loading-container"><div class="spinner"></div></div>';
           
           try {
               const data = await fetchWithCache(`${baseURL}/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&language=en-US`);
               grid.innerHTML = '';
               
               if (!data?.results) {
                   grid.innerHTML = '<div class="empty-state">Search failed</div>';
                   return;
               }
               
               const filtered = data.results.filter(item => item.media_type === 'movie' || item.media_type === 'tv');
               
               if (filtered.length === 0) {
                   grid.innerHTML = '<div class="empty-state">No results found</div>';
                   return;
               }
               
               for (const item of filtered.slice(0, 24)) {
                   item._cert = await getCertification(item);
                   if (certMatchesGroup(item._cert, ratingSelect.value)) {
                       createCard(item, grid, 0, 'card');
                   }
               }
           } catch (e) {
               grid.innerHTML = '<div class="empty-state">Error loading results</div>';
           }
       }

       async function openDetails(item) {
           currentDetailsItem = item;
           scrollPosition = window.pageYOffset;
           
           const posterUrl = item.backdrop_path 
               ? `https://image.tmdb.org/t/p/original${item.backdrop_path}` 
               : (item.poster_path ? `https://image.tmdb.org/t/p/w780${item.poster_path}` : FALLBACK_BACKDROP);
           
           document.getElementById('posterImage').src = posterUrl;
           document.getElementById('posterImage').onerror = function() {
               this.src = FALLBACK_BACKDROP;
           };
           
           document.getElementById('detailsTitle').textContent = item.title || item.name;
           document.getElementById('detailsYear').textContent = (item.release_date || item.first_air_date || '').substring(0, 4);
           document.getElementById('detailsOverview').textContent = item.overview || 'No overview available.';
           document.getElementById('detailsRating').textContent = item._cert || 'NR';
           document.getElementById('matchScore').textContent = `${Math.floor(Math.random() * 15 + 85)}% Match`;
           
           const isTvShow = item.media_type === 'tv' || item.first_air_date;
           
           if (isTvShow) {
               document.getElementById('detailsRuntime').textContent = `${item.number_of_seasons || '?'} Seasons`;
               document.getElementById('episodeSelector').style.display = 'block';
               await loadTvSeasons(item.id);
           } else {
               document.getElementById('detailsRuntime').textContent = `${item.runtime || '?'} min`;
               document.getElementById('episodeSelector').style.display = 'none';
           }
           
           const genres = await getGenreNames(item.genre_ids);
           document.getElementById('detailsGenre').textContent = genres;
           
           updateDetailsListButton();
           await loadCast(item);
           
           document.body.classList.add('modal-open');
           detailsModal.classList.add('active');
       }

       function closeDetails() {
           detailsModal.classList.remove('active');
           document.body.classList.remove('modal-open');
           document.getElementById('posterImage').src = '';
           currentDetailsItem = null;
           setTimeout(() => window.scrollTo(0, scrollPosition), 10);
       }

       function closeDetailsOnBackdrop(e) {
           if (e.target === detailsModal) closeDetails();
       }

       async function loadTvSeasons(tvId) {
           const data = await fetchWithCache(`${baseURL}/tv/${tvId}?api_key=${API_KEY}&language=en-US`);
           tvSeasonsData = data?.seasons?.filter(s => s.season_number > 0) || [];
           
           const seasonSelect = document.getElementById('seasonSelect');
           seasonSelect.innerHTML = '<option value="">Select</option>';
           tvSeasonsData.forEach(s => {
               const opt = document.createElement('option');
               opt.value = s.season_number;
               opt.textContent = `S${s.season_number} (${s.episode_count} eps)`;
               seasonSelect.appendChild(opt);
           });
           
           if (tvSeasonsData.length > 0) {
               seasonSelect.value = tvSeasonsData[0].season_number;
               await onSeasonChange();
           }
       }

       async function onSeasonChange() {
           const seasonNum = document.getElementById('seasonSelect').value;
           if (!seasonNum) return;
           
           const data = await fetchWithCache(`${baseURL}/tv/${currentDetailsItem.id}/season/${seasonNum}?api_key=${API_KEY}&language=en-US`);
           const episodeSelect = document.getElementById('episodeSelect');
           episodeSelect.innerHTML = '<option value="">Select</option>';
           
           data?.episodes?.forEach(ep => {
               const opt = document.createElement('option');
               opt.value = ep.episode_number;
               opt.textContent = `E${ep.episode_number}: ${ep.name}`;
               episodeSelect.appendChild(opt);
           });
           
           if (data?.episodes?.length > 0) {
               episodeSelect.value = 1;
               updateEpisodeInfo(data.episodes[0]);
           }
       }

       function onEpisodeChange() {
           const season = document.getElementById('seasonSelect').value;
           const episode = document.getElementById('episodeSelect').value;
           if (season && episode) {
               document.getElementById('episodeInfo').textContent = `Season ${season}, Episode ${episode}`;
           }
       }

       function updateEpisodeInfo(episode) {
           document.getElementById('episodeInfo').textContent = episode?.overview 
               ? episode.overview.substring(0, 100) + '...' 
               : `Episode ${episode.episode_number}`;
       }

       async function getGenreNames(ids) {
           if (!ids?.length) return 'Various';
           const data = await fetchWithCache(`${baseURL}/genre/movie/list?api_key=${API_KEY}`);
           const names = ids.map(id => data?.genres?.find(g => g.id === id)?.name).filter(Boolean);
           return names.slice(0, 3).join(', ') || 'Various';
       }

       async function loadCast(item) {
           const container = document.getElementById('detailsCast');
           container.innerHTML = '';
           
           const endpoint = item.media_type === 'tv' || item.first_air_date ? 'tv' : 'movie';
           const data = await fetchWithCache(`${baseURL}/${endpoint}/${item.id}/credits?api_key=${API_KEY}`);
           
           const cast = data?.cast?.slice(0, 6) || [];
           if (cast.length === 0) {
               container.innerHTML = '<div class="cast-member">Cast unavailable</div>';
               return;
           }
           
           cast.forEach(actor => {
               const div = document.createElement('div');
               div.className = 'cast-member';
               div.textContent = actor.name;
               container.appendChild(div);
           });
       }

       function playContent() {
           if (!currentDetailsItem) return;
           
           addToContinueWatching(currentDetailsItem, 0, currentDetailsItem.runtime ? currentDetailsItem.runtime * 60 : 7200);
           
           const isTvShow = currentDetailsItem.media_type === 'tv' || currentDetailsItem.first_air_date;
           const season = isTvShow ? (document.getElementById('seasonSelect').value || 1) : null;
           const episode = isTvShow ? (document.getElementById('episodeSelect').value || 1) : null;
           
           const server = SERVERS[currentServer] || SERVERS['1'];
           const src = server.buildUrl(currentDetailsItem.id, isTvShow, season, episode);
           
           console.log('Loading stream from:', src);
           
           detailsModal.classList.remove('active');
           setTimeout(() => {
               document.getElementById('playerIframe').src = src;
               playerModal.classList.add('active');
           }, 300);
       }

       function closePlayer() {
           playerModal.classList.remove('active');
           document.getElementById('playerIframe').src = '';
           if (currentDetailsItem) {
               setTimeout(() => detailsModal.classList.add('active'), 300);
           } else {
               document.body.classList.remove('modal-open');
           }
       }

       function closePlayerOnBackdrop(e) {
           if (e.target === playerModal) closePlayer();
       }

       function downloadContent() {
           if (!currentDetailsItem) return;
           const isTvShow = currentDetailsItem.media_type === 'tv' || currentDetailsItem.first_air_date;
           let url;
           if (isTvShow) {
               const season = document.getElementById('seasonSelect').value || 1;
               const episode = document.getElementById('episodeSelect').value || 1;
               url = `https://dl.vidsrc.vip/tv/${currentDetailsItem.id}/${season}/${episode}`;
           } else {
               url = `https://dl.vidsrc.vip/movie/${currentDetailsItem.id}`;
           }
           window.open(url, '_blank');
           showToast('Download started', 'success');
       }

       function addToContinueWatching(item, progress, duration) {
           const idx = continueWatching.findIndex(i => i.id === item.id);
           const data = { ...item, progress, duration, lastWatched: new Date().toISOString() };
           if (idx !== -1) continueWatching.splice(idx, 1);
           continueWatching.unshift(data);
           if (continueWatching.length > 15) continueWatching = continueWatching.slice(0, 15);
           localStorage.setItem('gnStreamContinue', JSON.stringify(continueWatching));
       }

       async function loadCategory(endpoint, containerId, type, genreId = null, cardSize = 'card') {
           const container = document.getElementById(containerId);
           container.innerHTML = '<div class="loading-container"><div class="spinner"></div></div>';
           
           let url = `${baseURL}${endpoint}?api_key=${API_KEY}&language=en-US`;
           if (genreId) url += `&with_genres=${genreId}`;
           
           const data = await fetchWithCache(url);
           container.innerHTML = '';
           
           if (!data?.results) {
               container.innerHTML = '<div class="empty-state">Failed to load</div>';
               return;
           }
           
           const items = data.results.slice(0, 16);
           
           for (const item of items) {
               item.media_type = type;
               item._cert = await getCertification(item);
               createCard(item, container, 0, cardSize);
           }
       }

       async function loadDiscoverMore() {
           if (isLoadingDiscover || discoverTotalLoaded >= DISCOVER_TOTAL_TARGET) return;
           
           isLoadingDiscover = true;
           const btn = document.getElementById('loadMoreBtn');
           const container = document.getElementById('discoverGrid');
           
           btn.classList.add('loading');
           btn.disabled = true;
           
           try {
               const endpoints = [
                   `/movie/popular?api_key=${API_KEY}&language=en-US&page=${discoverPage}`,
                   `/tv/popular?api_key=${API_KEY}&language=en-US&page=${discoverPage}`,
                   `/movie/top_rated?api_key=${API_KEY}&language=en-US&page=${discoverPage}`,
                   `/tv/top_rated?api_key=${API_KEY}&language=en-US&page=${discoverPage}`
               ];
               
               const shuffled = endpoints.sort(() => 0.5 - Math.random()).slice(0, 2);
               const results = await Promise.all(shuffled.map(url => fetchWithCache(`${baseURL}${url}`)));
               
               let newItems = [];
               results.forEach(data => {
                   if (data?.results) {
                       newItems = newItems.concat(data.results);
                   }
               });
               
               const seen = new Set();
               newItems = newItems.filter(item => {
                   if (seen.has(item.id)) return false;
                   seen.add(item.id);
                   return true;
               });
               
               for (const item of newItems.slice(0, 20)) {
                   if (discoverTotalLoaded >= DISCOVER_TOTAL_TARGET) break;
                   
                   item.media_type = item.first_air_date ? 'tv' : 'movie';
                   item._cert = await getCertification(item);
                   
                   if (!document.querySelector(`.discover-grid .card[data-id="${item.id}"]`)) {
                       createCard(item, container, 0, 'card');
                       discoverTotalLoaded++;
                   }
               }
               
               discoverPage++;
               document.getElementById('totalMovies').textContent = `${discoverTotalLoaded}+`;
               
               if (discoverTotalLoaded >= DISCOVER_TOTAL_TARGET) {
                   btn.textContent = 'All Titles Loaded';
                   btn.disabled = true;
                   showToast(`Loaded ${discoverTotalLoaded} movies and shows!`, 'success');
               } else {
                   btn.textContent = `Load More (${discoverTotalLoaded}/${DISCOVER_TOTAL_TARGET})`;
               }
               
           } catch (error) {
               console.error('Error loading discover more:', error);
               showToast('Failed to load more titles', 'error');
           } finally {
               btn.classList.remove('loading');
               btn.disabled = false;
               isLoadingDiscover = false;
           }
       }

       document.addEventListener('keydown', (e) => {
           if (e.key === 'Escape') {
               if (playerModal.classList.contains('active')) closePlayer();
               else if (detailsModal.classList.contains('active')) closeDetails();
           }
       });

       const observerOptions = {
           root: null,
           rootMargin: '100px',
           threshold: 0.1
       };

       const discoverObserver = new IntersectionObserver((entries) => {
           entries.forEach(entry => {
               if (entry.isIntersecting && !isLoadingDiscover && discoverTotalLoaded < DISCOVER_TOTAL_TARGET) {
                   // Auto-load disabled - manual only
               }
           });
       }, observerOptions);

       updateMyListCount();
       if (continueWatching.length > 0) {
           document.getElementById('continueWatchingSection').style.display = 'block';
           renderContinueWatching();
       }
       
       loadCategory('/trending/all/day', 'trendingRow', 'movie', null, CARD_SIZES.TRENDING);
       loadCategory('/discover/movie', 'actionRow', 'movie', GENRES.ACTION, CARD_SIZES.ACTION);
       loadCategory('/discover/movie', 'comedyRow', 'movie', GENRES.COMEDY, CARD_SIZES.COMEDY);
       loadCategory('/discover/movie', 'horrorRow', 'movie', GENRES.HORROR, CARD_SIZES.HORROR);
       loadCategory('/discover/movie', 'scifiRow', 'movie', GENRES.SCIFI, CARD_SIZES.SCIFI);
       loadCategory('/discover/movie', 'romanceRow', 'movie', GENRES.ROMANCE, CARD_SIZES.ROMANCE);
       loadCategory('/discover/movie', 'thrillerRow', 'movie', GENRES.THRILLER, CARD_SIZES.THRILLER);
       loadCategory('/discover/movie', 'dramaRow', 'movie', GENRES.DRAMA, CARD_SIZES.DRAMA);
       loadCategory('/discover/movie', 'animationRow', 'movie', GENRES.ANIMATION, CARD_SIZES.ANIMATION);
       loadCategory('/discover/movie', 'documentaryRow', 'movie', GENRES.DOCUMENTARY, CARD_SIZES.DOCUMENTARY);
       loadCategory('/discover/movie', 'crimeRow', 'movie', GENRES.CRIME, CARD_SIZES.CRIME);
       loadCategory('/discover/movie', 'mysteryRow', 'movie', GENRES.MYSTERY, CARD_SIZES.MYSTERY);
       loadCategory('/discover/movie', 'fantasyRow', 'movie', GENRES.FANTASY, CARD_SIZES.FANTASY);
       loadCategory('/discover/movie', 'familyRow', 'movie', GENRES.FAMILY, CARD_SIZES.FAMILY);
       loadCategory('/discover/movie', 'adventureRow', 'movie', GENRES.ADVENTURE, CARD_SIZES.ADVENTURE);
       loadCategory('/movie/popular', 'popularMoviesRow', 'movie', null, CARD_SIZES.MOVIES);
       loadCategory('/tv/popular', 'popularTvRow', 'tv', null, CARD_SIZES.TV);
       
       loadDiscoverMore();
       loadDiscoverMore();
       
       discoverObserver.observe(document.getElementById('loadMoreBtn'));
   </script>

<script src="./script.js"></script></body></html>