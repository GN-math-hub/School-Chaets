<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<title>GN-Stream</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap');
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --primary:#e50914;--primary-dark:#b20710;--primary-glow:rgba(229,9,20,0.35);
  --bg:#050505;--surface:#111;--surface-light:#1a1a1a;--surface-lighter:#252525;
  --text:#fff;--text-secondary:#a3a3a3;--text-muted:#5a5a5a;
  --border:rgba(255,255,255,0.08);--glass:rgba(8,8,8,0.96);
  --card-radius:8px;--ease:cubic-bezier(0.4,0,0.2,1);--spring:cubic-bezier(0.175,0.885,0.32,1.275);
}
[data-theme="light"]{
  --bg:#f0f0f0;--surface:#fff;--surface-light:#f5f5f5;--surface-lighter:#e8e8e8;
  --text:#111;--text-secondary:#555;--text-muted:#999;
  --border:rgba(0,0,0,0.08);--glass:rgba(255,255,255,0.98);
}
html{overflow-x:hidden;scroll-behavior:smooth}
body{font-family:'Outfit',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;line-height:1.6;-webkit-font-smoothing:antialiased;transition:background .4s,color .4s}
body.modal-open{overflow:hidden}
.noise{position:fixed;inset:0;pointer-events:none;z-index:9999;opacity:.018;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;height:68px;background:linear-gradient(to bottom,rgba(0,0,0,.92),transparent);backdrop-filter:blur(20px) saturate(180%);z-index:1000;display:flex;align-items:center;justify-content:space-between;padding:0 4%;transition:background .4s,box-shadow .3s}
[data-theme="light"] header{background:linear-gradient(to bottom,rgba(255,255,255,.94),transparent)}
header.scrolled{background:rgba(5,5,5,.97);box-shadow:0 1px 0 rgba(255,255,255,.06)}
[data-theme="light"] header.scrolled{background:rgba(255,255,255,.98);box-shadow:0 1px 0 rgba(0,0,0,.08)}
.logo{font-size:26px;font-weight:900;background:linear-gradient(135deg,#ff1a24,#e50914);-webkit-background-clip:text;-webkit-text-fill-color:transparent;letter-spacing:-.5px;text-transform:uppercase;cursor:pointer;transition:filter .2s;flex-shrink:0}
.logo:hover{filter:drop-shadow(0 0 14px rgba(229,9,20,.6))}
.nav-links{display:flex;gap:18px;align-items:center;flex-wrap:nowrap}
.nav-links a{color:var(--text-secondary);text-decoration:none;font-size:12.5px;font-weight:600;cursor:pointer;position:relative;padding:6px 0;text-transform:uppercase;letter-spacing:.5px;transition:color .2s;white-space:nowrap}
.nav-links a::after{content:'';position:absolute;bottom:0;left:0;width:100%;height:2px;background:var(--primary);border-radius:1px;transform:scaleX(0);transform-origin:right;transition:transform .3s}
.nav-links a:hover,.nav-links a.active{color:var(--text)}
.nav-links a:hover::after,.nav-links a.active::after{transform:scaleX(1);transform-origin:left}
.my-list-badge{background:var(--primary);color:#fff;padding:1px 7px;border-radius:10px;font-size:10px;margin-left:4px;font-weight:800}
.mobile-menu-btn{display:none;background:none;border:none;color:var(--text);font-size:22px;cursor:pointer;padding:8px;border-radius:8px}
.mobile-nav{display:none;position:fixed;top:68px;left:0;right:0;background:var(--glass);backdrop-filter:blur(24px);padding:16px;z-index:999;border-bottom:1px solid var(--border)}
.mobile-nav.active{display:block;animation:slideDown .25s}
@keyframes slideDown{from{opacity:0;transform:translateY(-8px)}to{opacity:1;transform:translateY(0)}}
.mobile-nav a{display:block;color:var(--text);text-decoration:none;padding:14px 12px;font-size:15px;font-weight:500;border-radius:10px;margin-bottom:2px;transition:background .15s;cursor:pointer}
.mobile-nav a:hover{background:var(--surface-light)}
.icon-btn{background:var(--surface-light);border:1px solid var(--border);color:var(--text);width:36px;height:36px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:15px;transition:all .2s;margin-left:4px;flex-shrink:0}
.icon-btn:hover{transform:scale(1.1);border-color:var(--primary);box-shadow:0 0 14px var(--primary-glow)}
.premium-header-btn{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000;border:none;padding:7px 13px;border-radius:18px;font-size:11px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:5px;transition:all .2s;margin-left:4px;text-transform:uppercase;letter-spacing:.5px;box-shadow:0 0 14px rgba(255,215,0,.2);font-family:'Outfit',sans-serif;flex-shrink:0}
.premium-header-btn:hover{transform:scale(1.05);box-shadow:0 0 24px rgba(255,215,0,.5)}
.premium-active-badge{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000;padding:3px 10px;border-radius:10px;font-size:11px;font-weight:800;display:none;margin-left:6px}
.premium-active-badge.show{display:inline-block}
.server-selector{display:flex;align-items:center;gap:6px;margin-left:12px;padding-left:12px;border-left:1px solid var(--border)}
.server-label{color:var(--text-muted);font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}
.server-select{background:var(--surface);color:var(--text);border:1px solid var(--border);border-radius:6px;padding:5px 24px 5px 9px;font-size:11px;font-weight:500;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%236b6b6b' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 7px center;transition:border-color .2s;min-width:110px;font-family:'Outfit',sans-serif}
.server-select:hover,.server-select:focus{border-color:var(--primary);outline:none}

/* PROFILE AVATAR in header */
.profile-avatar{width:34px;height:34px;border-radius:50%;cursor:pointer;border:2px solid var(--border);transition:all .2s;object-fit:cover;display:flex;align-items:center;justify-content:center;font-size:16px;background:var(--surface-light);flex-shrink:0;margin-left:6px;overflow:hidden;user-select:none}
.profile-avatar:hover{border-color:var(--primary);transform:scale(1.06)}
.profile-avatar img{width:100%;height:100%;object-fit:cover;border-radius:50%}

/* HERO */
#heroFeatured{position:relative;width:100%;height:100vh;min-height:600px;display:flex;align-items:flex-end;overflow:hidden}
.hero-backdrop{position:absolute;inset:0;background-size:cover;background-position:center top;transition:opacity .8s}
.hero-backdrop::after{content:'';position:absolute;inset:0;background:linear-gradient(to top,#050505 0%,rgba(5,5,5,.65) 40%,rgba(5,5,5,.1) 75%,transparent 100%),linear-gradient(to right,rgba(5,5,5,.88) 0%,rgba(5,5,5,.3) 50%,transparent 100%)}
[data-theme="light"] .hero-backdrop::after{background:linear-gradient(to top,#f0f0f0 0%,rgba(240,240,240,.7) 40%,rgba(240,240,240,.1) 75%,transparent 100%),linear-gradient(to right,rgba(240,240,240,.9) 0%,rgba(240,240,240,.4) 50%,transparent 100%)}
.hero-content-wrap{position:relative;z-index:2;padding:0 4% 80px;max-width:700px}
.hero-badge{display:inline-flex;align-items:center;gap:6px;background:var(--primary);color:#fff;padding:4px 12px;border-radius:4px;font-size:11px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:14px}
.hero-title{font-size:62px;font-weight:900;line-height:1.02;letter-spacing:-2.5px;color:#fff;margin-bottom:14px;text-shadow:0 2px 20px rgba(0,0,0,.4)}
[data-theme="light"] .hero-title{color:#111}
.hero-meta{display:flex;align-items:center;gap:12px;margin-bottom:14px;font-size:14px;color:var(--text-secondary);flex-wrap:wrap}
.hero-meta-rating{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.2);padding:2px 8px;border-radius:4px;font-weight:700;font-size:12px}
.hero-match{color:#22c55e;font-weight:700}
.hero-overview{font-size:15px;color:var(--text-secondary);line-height:1.65;max-width:500px;margin-bottom:26px;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
.hero-actions{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.hero-play-btn{background:#fff;color:#000;border:none;padding:13px 28px;border-radius:6px;font-size:16px;font-weight:800;cursor:pointer;display:flex;align-items:center;gap:9px;transition:all .2s;font-family:'Outfit',sans-serif}
.hero-play-btn:hover{background:rgba(255,255,255,.85);transform:scale(1.04)}
[data-theme="light"] .hero-play-btn{background:#111;color:#fff}
[data-theme="light"] .hero-play-btn:hover{background:#333}
.hero-info-btn{background:rgba(109,109,110,.7);color:#fff;border:none;padding:13px 24px;border-radius:6px;font-size:16px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all .2s;backdrop-filter:blur(8px);font-family:'Outfit',sans-serif}
.hero-info-btn:hover{background:rgba(109,109,110,.5);transform:scale(1.04)}
.hero-watchlist-btn{background:rgba(255,255,255,.08);color:#fff;border:2px solid rgba(255,255,255,.4);padding:12px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .25s;backdrop-filter:blur(8px);width:48px;height:48px;font-size:20px}
.hero-watchlist-btn:hover{border-color:#fff;background:rgba(255,255,255,.18);transform:scale(1.08)}
.hero-watchlist-btn.in-list{background:var(--primary);border-color:var(--primary)}
.hero-trailer-btn{background:rgba(255,255,255,.08);color:#fff;border:2px solid rgba(255,255,255,.3);padding:10px 18px;border-radius:6px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:7px;transition:all .2s;backdrop-filter:blur(8px);font-family:'Outfit',sans-serif}
.hero-trailer-btn:hover{background:rgba(255,255,255,.15);border-color:rgba(255,255,255,.6)}
.hero-scroll-indicator{position:absolute;bottom:24px;right:4%;z-index:2;display:flex;gap:8px}
.hero-dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.3);cursor:pointer;transition:all .3s}
.hero-dot.active{background:#fff;width:24px;border-radius:4px}

/* GENRE QUICK FILTERS */
.genre-filter-section{padding:24px 4% 0;overflow:hidden}
.genre-filter-row{display:flex;gap:8px;overflow-x:auto;padding-bottom:4px;scrollbar-width:none}
.genre-filter-row::-webkit-scrollbar{display:none}
.genre-pill{background:var(--surface-light);border:1px solid var(--border);color:var(--text-secondary);padding:7px 16px;border-radius:20px;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;white-space:nowrap;font-family:'Outfit',sans-serif;text-transform:uppercase;letter-spacing:.4px}
.genre-pill:hover{border-color:var(--primary);color:var(--text);transform:translateY(-1px)}
.genre-pill.active{background:var(--primary);border-color:var(--primary);color:#fff;box-shadow:0 4px 12px var(--primary-glow)}

/* MOOD BAR */
.mood-bar{padding:20px 4% 0}
.mood-bar-title{font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px;display:flex;align-items:center;gap:8px}
.mood-bar-title::before{content:'';width:3px;height:16px;background:linear-gradient(to bottom,#ffd700,#ff8c00);border-radius:2px}
.mood-pills{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;padding-bottom:4px}
.mood-pills::-webkit-scrollbar{display:none}
.mood-pill{background:var(--surface-light);border:1px solid var(--border);padding:9px 18px;border-radius:22px;font-size:12px;font-weight:700;cursor:pointer;transition:all .25s;white-space:nowrap;font-family:'Outfit',sans-serif;display:flex;align-items:center;gap:6px;color:var(--text-secondary)}
.mood-pill:hover{transform:translateY(-2px);color:var(--text)}
.mood-pill.active{color:#000;transform:translateY(-2px);box-shadow:0 6px 18px rgba(0,0,0,.3)}
.mood-happy{background:linear-gradient(135deg,#ffd700,#ff8c00)!important;border-color:#ffd700!important}
.mood-scary{background:linear-gradient(135deg,#1a0a1e,#6b21a8)!important;border-color:#6b21a8!important;color:#e9d5ff!important}
.mood-romantic{background:linear-gradient(135deg,#be185d,#e11d48)!important;border-color:#e11d48!important;color:#fce7f3!important}
.mood-tense{background:linear-gradient(135deg,#0f172a,#1e3a5f)!important;border-color:#1e40af!important;color:#bfdbfe!important}
.mood-funny{background:linear-gradient(135deg,#15803d,#16a34a)!important;border-color:#16a34a!important;color:#dcfce7!important}
.mood-chill{background:linear-gradient(135deg,#0e7490,#0891b2)!important;border-color:#0891b2!important;color:#cffafe!important}
.mood-inspire{background:linear-gradient(135deg,#7c3aed,#6d28d9)!important;border-color:#7c3aed!important;color:#ede9fe!important}

/* CATEGORIES */
.category-section{margin:36px 0;padding:0 4%;opacity:0;transform:translateY(18px);transition:opacity .5s var(--ease),transform .5s var(--ease)}
.category-section.visible{opacity:1;transform:translateY(0)}
.category-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
.category-title{font-size:15px;font-weight:800;display:flex;align-items:center;gap:10px;text-transform:uppercase;letter-spacing:1px}
.category-title::before{content:'';width:3px;height:18px;background:var(--primary);border-radius:2px;flex-shrink:0}
.view-all{color:var(--text-muted);font-size:12px;font-weight:600;cursor:pointer;transition:color .2s;text-transform:uppercase;letter-spacing:.5px}
.view-all:hover{color:var(--primary)}
.movie-row{display:flex;gap:12px;overflow-x:auto;scroll-behavior:smooth;padding:10px 0 14px;scrollbar-width:thin;scrollbar-color:var(--primary) transparent;scroll-snap-type:x mandatory}
.movie-row::-webkit-scrollbar{height:3px}
.movie-row::-webkit-scrollbar-thumb{background:var(--primary);border-radius:2px}

/* CARDS */
.card{flex:0 0 auto;border-radius:var(--card-radius);overflow:hidden;cursor:pointer;position:relative;background:var(--surface);scroll-snap-align:start;width:155px;height:230px;transition:transform .3s var(--spring),box-shadow .3s;will-change:transform}
.card-medium{width:195px;height:290px}
.card-large{width:270px;height:400px}
.card-wide{width:260px;height:146px}
.card:hover{transform:scale(1.06) translateY(-3px);z-index:10;box-shadow:0 20px 50px rgba(0,0,0,.8),0 0 0 1px rgba(255,255,255,.08)}
.card img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .4s}
.card:hover img{transform:scale(1.04)}
.card-wide img{object-fit:cover}
.card-overlay{position:absolute;bottom:0;left:0;right:0;padding:50px 10px 10px;background:linear-gradient(to top,rgba(0,0,0,.95) 0%,rgba(0,0,0,.5) 55%,transparent 100%);opacity:0;transition:opacity .25s;z-index:2}
.card:hover .card-overlay{opacity:1}
.card-title{font-size:12px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px}
.card-rating{font-size:11px;color:var(--primary);font-weight:600}
.card-actions{position:absolute;bottom:10px;right:8px;display:flex;gap:6px;opacity:0;transition:opacity .25s;z-index:20}
.card:hover .card-actions{opacity:1}
.card-action-btn{width:28px;height:28px;background:rgba(0,0,0,.75);border:1.5px solid rgba(255,255,255,.25);border-radius:50%;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;transition:all .2s;backdrop-filter:blur(4px)}
.card-action-btn:hover{background:var(--primary);border-color:var(--primary);transform:scale(1.1)}
.card-action-btn.in-list{background:var(--primary);border-color:var(--primary)}

/* TRAILER PREVIEW on card hover */
.card-trailer-preview{position:absolute;inset:0;background:#000;z-index:3;opacity:0;transition:opacity .4s;overflow:hidden;border-radius:var(--card-radius)}
.card:hover .card-trailer-preview{opacity:1}
.trailer-badge{position:absolute;top:8px;left:8px;background:rgba(229,9,20,.9);color:#fff;font-size:9px;font-weight:800;padding:2px 6px;border-radius:4px;z-index:6;text-transform:uppercase;letter-spacing:.5px;backdrop-filter:blur(4px)}
.card-trailer-preview video{width:100%;height:100%;object-fit:cover}
.card-trailer-preview .preview-info{position:absolute;bottom:0;left:0;right:0;padding:28px 10px 10px;background:linear-gradient(to top,rgba(0,0,0,.95),transparent);z-index:5}
.card-trailer-preview .preview-title{font-size:11px;font-weight:700;color:#fff;margin-bottom:2px}
.card-trailer-preview .preview-meta{font-size:10px;color:rgba(255,255,255,.7)}

.bookmark-badge{position:absolute;top:0;left:10px;padding:5px 8px;font-size:9px;font-weight:800;text-transform:uppercase;border-radius:0 0 5px 5px;z-index:5;letter-spacing:.5px}
.badge-new{background:var(--primary);color:#fff}
.badge-hot{background:#ff6b00;color:#fff}
.badge-top{background:#ffd700;color:#000}
.badge-trending{background:#e50914;color:#fff}
.badge-4k{background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff}
.progress-bar{position:absolute;bottom:0;left:0;right:0;height:3px;background:rgba(255,255,255,.15);z-index:3}
.progress-fill{height:100%;background:var(--primary);transition:width .3s}
.premium-lock-overlay{position:absolute;inset:0;background:rgba(0,0,0,.8);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10;border-radius:var(--card-radius);backdrop-filter:blur(3px);cursor:pointer}
.lock-icon{font-size:24px;margin-bottom:5px;filter:drop-shadow(0 0 10px rgba(255,215,0,.7))}
.lock-text{font-size:9px;font-weight:800;text-align:center;background:linear-gradient(135deg,#ffd700,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-transform:uppercase;letter-spacing:.5px;line-height:1.4;padding:0 6px}

/* TOP 10 */
.top10-card{flex:0 0 auto;position:relative;cursor:pointer;scroll-snap-align:start;width:200px;display:flex;align-items:flex-end;gap:0}
.top10-number{font-size:130px;font-weight:900;line-height:1;color:transparent;-webkit-text-stroke:3px rgba(255,255,255,.18);letter-spacing:-8px;flex-shrink:0;transition:all .3s;user-select:none;margin-right:-14px;z-index:2}
.top10-card:hover .top10-number{-webkit-text-stroke-color:rgba(229,9,20,.5)}
.top10-poster{width:120px;height:175px;border-radius:6px;overflow:hidden;flex-shrink:0;box-shadow:0 8px 30px rgba(0,0,0,.7);transition:transform .3s var(--spring);z-index:3}
.top10-poster img{width:100%;height:100%;object-fit:cover;display:block}
.top10-card:hover .top10-poster{transform:scale(1.05) translateY(-4px)}

/* SKELETON */
.skeleton{background:linear-gradient(90deg,var(--surface-light) 25%,var(--surface-lighter) 50%,var(--surface-light) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:var(--card-radius)}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.skeleton-card{flex:0 0 155px;height:230px;border-radius:var(--card-radius)}

/* WIDE CARDS */
.wide-card{flex:0 0 auto;width:280px;background:var(--surface-light);border-radius:10px;overflow:hidden;cursor:pointer;border:1px solid var(--border);transition:all .25s;scroll-snap-align:start;position:relative}
.wide-card:hover{border-color:rgba(229,9,20,.35);transform:translateY(-3px);box-shadow:0 12px 30px rgba(0,0,0,.5)}
.wide-card-thumb{width:100%;height:158px;position:relative;overflow:hidden;background:#000}
.wide-card-thumb img{width:100%;height:100%;object-fit:cover;transition:transform .3s}
.wide-card:hover .wide-card-thumb img{transform:scale(1.05)}
.wide-card-play{position:absolute;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s}
.wide-card:hover .wide-card-play{opacity:1}
.wide-play-circle{width:44px;height:44px;background:rgba(255,255,255,.9);border-radius:50%;display:flex;align-items:center;justify-content:center}
.wide-play-circle svg{width:18px;height:18px;fill:#000;margin-left:3px}
.wide-card-info{padding:10px 12px 12px}
.wide-card-title{font-size:13px;font-weight:700;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.wide-card-meta{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:8px}
.wide-progress{height:3px;background:rgba(255,255,255,.12);border-radius:2px;margin-top:8px}
.wide-progress-fill{height:100%;background:var(--primary);border-radius:2px}
.wide-card-time{font-size:10px;color:var(--text-muted);margin-top:4px}

/* DETAILS MODAL */
#detailsModal{position:fixed;inset:0;background:rgba(0,0,0,.92);display:none;align-items:flex-start;justify-content:center;z-index:10000;padding:40px 20px;overflow-y:auto;opacity:0;transition:opacity .3s}
#detailsModal.active{display:flex;opacity:1}
#detailsContent{width:100%;max-width:920px;background:var(--surface);border-radius:14px;overflow:hidden;border:1px solid var(--border);transform:scale(.96) translateY(14px);opacity:0;transition:all .35s var(--spring);box-shadow:0 40px 80px rgba(0,0,0,.8)}
#detailsModal.active #detailsContent{transform:scale(1) translateY(0);opacity:1}
#posterContainer{position:relative;width:100%;padding-bottom:56.25%;background:#000;overflow:hidden}
#posterImage{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transition:transform .4s}
#posterContainer:hover #posterImage{transform:scale(1.02)}
.poster-gradient{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(to top,var(--surface),transparent);z-index:1}
/* Trailer preview in modal */
.trailer-play-btn{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:60px;height:60px;background:rgba(255,255,255,.15);border:2px solid rgba(255,255,255,.6);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:3;transition:all .25s;backdrop-filter:blur(8px)}
.trailer-play-btn:hover{background:var(--primary);border-color:var(--primary);transform:translate(-50%,-50%) scale(1.08)}
.trailer-play-btn svg{width:22px;height:22px;fill:#fff;margin-left:3px}
.modal-close-btn{position:fixed;top:18px;right:18px;width:42px;height:42px;background:rgba(0,0,0,.75);border:1px solid rgba(255,255,255,.15);color:var(--text);border-radius:50%;font-size:18px;cursor:pointer;z-index:10001;display:flex;align-items:center;justify-content:center;transition:all .2s}
.modal-close-btn:hover{background:var(--primary);color:#fff;transform:rotate(90deg) scale(1.05)}
.details-info{padding:28px 28px 0;margin-top:-48px;position:relative;z-index:2}
.details-title{font-size:30px;font-weight:800;margin-bottom:10px;line-height:1.2}
.details-meta{display:flex;gap:10px;align-items:center;margin-bottom:16px;flex-wrap:wrap;color:var(--text-secondary);font-size:13px}
.details-rating{background:var(--primary);color:#fff;padding:3px 9px;border-radius:4px;font-weight:800;font-size:11px}
.match-score{color:#22c55e;font-weight:700}
.details-actions{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.btn-primary,.btn-secondary,.btn-download{padding:11px 20px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;border:none;display:flex;align-items:center;gap:7px;transition:all .2s;text-transform:uppercase;letter-spacing:.5px;font-family:'Outfit',sans-serif}
.btn-primary{background:var(--text);color:var(--bg)}
.btn-primary:hover{background:rgba(255,255,255,.88);transform:translateY(-1px)}
.btn-secondary{background:rgba(255,255,255,.08);color:var(--text);border:1px solid var(--border)}
.btn-secondary:hover{background:rgba(255,255,255,.14);transform:translateY(-1px)}
.btn-download{background:var(--primary);color:#fff}
.btn-download:hover{background:var(--primary-dark);transform:translateY(-1px)}
.btn-red{background:var(--primary)!important;color:#fff!important}
.skip-buttons{display:flex;gap:8px;margin-left:auto}
.skip-btn{background:rgba(255,255,255,.08);border:1px solid var(--border);color:var(--text);padding:7px 13px;border-radius:18px;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;display:flex;align-items:center;gap:5px;font-family:'Outfit',sans-serif}
.skip-btn:hover{background:var(--primary);border-color:var(--primary)}
#detailsBody{padding:0 28px 28px}
.details-section{margin-bottom:20px}
.details-section h3{font-size:11px;text-transform:uppercase;color:var(--text-muted);margin-bottom:10px;letter-spacing:1.5px;font-weight:700}
.details-section p{color:var(--text-secondary);line-height:1.7;font-size:14px}
.cast-list{display:flex;gap:7px;flex-wrap:wrap}
.cast-member{background:var(--surface-light);padding:6px 13px;border-radius:18px;font-size:12px;border:1px solid var(--border);font-weight:500;transition:border-color .2s;cursor:default}
.cast-member:hover{border-color:var(--primary)}
.details-tags{display:flex;gap:6px;flex-wrap:wrap}
.detail-tag{background:var(--surface-lighter);padding:4px 10px;border-radius:6px;font-size:11px;font-weight:600;color:var(--text-secondary);border:1px solid var(--border)}

/* EPISODE SECTION */
.episode-section{padding:0 28px 28px;border-top:1px solid var(--border);margin-top:4px}
.episode-header{display:flex;align-items:center;gap:14px;padding-top:20px;margin-bottom:18px;flex-wrap:wrap}
.episode-header-title{font-size:15px;font-weight:800;text-transform:uppercase;letter-spacing:1px}
.season-select-wrap{display:flex;align-items:center;gap:10px;margin-left:auto}
.season-select-wrap label{font-size:12px;color:var(--text-muted);font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.season-dropdown{background:var(--surface-light);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px 30px 8px 12px;font-size:13px;font-weight:600;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23a3a3a3' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 10px center;transition:border-color .2s;font-family:'Outfit',sans-serif}
.season-dropdown:focus{outline:none;border-color:var(--primary)}
.episodes-grid{display:flex;flex-direction:column;gap:12px}
.episode-card{display:flex;gap:14px;background:var(--surface-light);border-radius:10px;overflow:hidden;cursor:pointer;border:1px solid var(--border);transition:all .2s;align-items:stretch}
.episode-card:hover{border-color:rgba(229,9,20,.35);background:var(--surface-lighter);box-shadow:0 4px 20px rgba(0,0,0,.4)}
.episode-thumb-wrap{flex:0 0 160px;width:160px;height:90px;position:relative;background:#000;overflow:hidden;flex-shrink:0}
.episode-thumb{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;display:block;transition:transform .3s}
.episode-card:hover .episode-thumb{transform:scale(1.06)}
.episode-play-overlay{position:absolute;inset:0;background:rgba(0,0,0,.45);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity .2s}
.episode-card:hover .episode-play-overlay{opacity:1}
.ep-play-icon{width:40px;height:40px;background:rgba(255,255,255,.92);border-radius:50%;display:flex;align-items:center;justify-content:center}
.ep-play-icon svg{width:16px;height:16px;fill:#000;margin-left:3px}
.episode-num-badge{position:absolute;top:7px;left:7px;background:rgba(0,0,0,.75);color:#fff;font-size:10px;font-weight:800;padding:2px 7px;border-radius:4px;backdrop-filter:blur(4px)}
.episode-info{flex:1;padding:12px 14px;display:flex;flex-direction:column;justify-content:center;min-width:0}
.episode-title{font-size:14px;font-weight:700;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.episode-meta-row{display:flex;align-items:center;gap:10px;margin-bottom:6px;flex-wrap:wrap}
.episode-runtime{font-size:11px;color:var(--text-muted);font-weight:600}
.episode-air-date{font-size:11px;color:var(--text-muted)}
.episode-rating{font-size:11px;color:var(--primary);font-weight:700}
.episode-overview{font-size:12px;color:var(--text-secondary);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}

/* RECOMMENDATIONS */
.recommendations-section{padding:0 28px 28px;border-top:1px solid var(--border)}
.recommendations-title{font-size:13px;font-weight:800;margin-bottom:12px;padding-top:16px;text-transform:uppercase;letter-spacing:1px}
.recommendations-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;scrollbar-width:thin;scrollbar-color:var(--primary) transparent}
.recommendation-card{flex:0 0 auto;width:185px;height:104px;border-radius:8px;overflow:hidden;cursor:pointer;position:relative;transition:all .25s;background:var(--surface-light)}
.recommendation-card:hover{transform:scale(1.04) translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.5)}
.recommendation-card img{width:100%;height:100%;object-fit:cover;transition:transform .3s}
.recommendation-card:hover img{transform:scale(1.05)}
.recommendation-overlay{position:absolute;bottom:0;left:0;right:0;padding:26px 10px 7px;background:linear-gradient(to top,rgba(0,0,0,.92),transparent)}
.recommendation-title{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:#fff}
.recommendation-rating{font-size:10px;color:var(--primary);font-weight:600;margin-top:1px}

/* =========== FEATURE 2: PROFILES MODAL =========== */
#profilesModal{position:fixed;inset:0;background:rgba(0,0,0,.95);display:none;align-items:center;justify-content:center;z-index:50000;opacity:0;transition:opacity .3s}
#profilesModal.active{display:flex;opacity:1}
.profiles-content{text-align:center;width:90%;max-width:680px;transform:scale(.95) translateY(20px);transition:transform .3s var(--spring)}
#profilesModal.active .profiles-content{transform:scale(1) translateY(0)}
.profiles-title{font-size:36px;font-weight:900;margin-bottom:8px;letter-spacing:-1px}
.profiles-subtitle{color:var(--text-secondary);font-size:15px;margin-bottom:44px}
.profiles-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:20px;max-width:600px;margin:0 auto 40px}
.profile-item{cursor:pointer;transition:transform .25s}
.profile-item:hover{transform:scale(1.06)}
.profile-avatar-wrap{width:100px;height:100px;border-radius:10px;margin:0 auto 12px;border:3px solid transparent;transition:border-color .2s;overflow:hidden;position:relative}
.profile-item:hover .profile-avatar-wrap,.profile-avatar-wrap.active-profile{border-color:var(--text)}
.profile-avatar-wrap.active-profile{border-color:var(--primary)!important}
.profile-avatar-bg{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:40px}
.profile-name{font-size:14px;font-weight:600;color:var(--text-secondary);transition:color .2s}
.profile-item:hover .profile-name{color:var(--text)}
.profile-badge{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-top:3px;padding:2px 7px;border-radius:10px;display:inline-block}
.profile-badge-kids{background:linear-gradient(135deg,#22c55e,#16a34a);color:#fff}
.profile-badge-premium{background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000}
.profile-add{cursor:pointer;transition:transform .25s}
.profile-add:hover{transform:scale(1.04)}
.profile-add-circle{width:100px;height:100px;border-radius:10px;border:2px dashed var(--border);display:flex;align-items:center;justify-content:center;font-size:36px;color:var(--text-muted);margin:0 auto 12px;transition:all .2s;background:var(--surface-light)}
.profile-add:hover .profile-add-circle{border-color:var(--text);color:var(--text)}
.profiles-manage-btn{background:transparent;border:2px solid var(--border);color:var(--text-secondary);padding:10px 28px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .2s;text-transform:uppercase;letter-spacing:1px}
.profiles-manage-btn:hover{border-color:var(--text);color:var(--text)}

/* =========== FEATURE 3: PLAYER CONTROLS MODAL =========== */
#playerControlsModal{position:fixed;bottom:0;left:0;right:0;background:var(--glass);border-top:1px solid var(--border);backdrop-filter:blur(24px);z-index:20001;padding:20px 4%;display:none;animation:slideUpModal .3s var(--spring)}
#playerControlsModal.active{display:block}
@keyframes slideUpModal{from{transform:translateY(100%);opacity:0}to{transform:translateY(0);opacity:1}}
.pc-title{font-size:13px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:16px;display:flex;align-items:center;justify-content:space-between}
.pc-close{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:18px;padding:4px}
.pc-close:hover{color:var(--text)}
.pc-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px;max-width:800px}
.pc-section h4{font-size:11px;font-weight:700;text-transform:uppercase;color:var(--text-muted);letter-spacing:1px;margin-bottom:10px}
.pc-options{display:flex;flex-direction:column;gap:6px}
.pc-opt{display:flex;align-items:center;justify-content:space-between;padding:8px 12px;background:var(--surface-light);border-radius:8px;border:1px solid var(--border);cursor:pointer;transition:all .2s;font-size:13px}
.pc-opt:hover{border-color:rgba(255,255,255,.2)}
.pc-opt.selected{border-color:var(--primary);background:rgba(229,9,20,.08)}
.pc-opt-check{color:var(--primary);font-size:16px;opacity:0}
.pc-opt.selected .pc-opt-check{opacity:1}
.subtitle-track{display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--surface-light);border-radius:8px;border:1px solid var(--border);cursor:pointer;transition:all .2s;font-size:13px;margin-bottom:6px}
.subtitle-track:hover{border-color:rgba(255,255,255,.2)}
.subtitle-track.selected{border-color:#4ade80;background:rgba(74,222,128,.06)}
.subtitle-flag{font-size:18px;flex-shrink:0}
.subtitle-name{flex:1}
.subtitle-check{color:#4ade80;font-size:16px;opacity:0}
.subtitle-track.selected .subtitle-check{opacity:1}
.quality-badge{font-size:9px;font-weight:800;padding:2px 6px;border-radius:4px;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;margin-left:6px}

/* =========== FEATURE 4: MOOD RESULTS =========== */
#moodResultsSection{display:none;padding:0 4% 40px}
.mood-results-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
.mood-results-title{font-size:20px;font-weight:800}
.mood-results-close{background:var(--surface-light);border:1px solid var(--border);color:var(--text);padding:7px 14px;border-radius:18px;font-size:12px;font-weight:600;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .2s}
.mood-results-close:hover{border-color:var(--primary);color:var(--primary)}
.mood-results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:14px}

/* PLAYER */
#playerModal{position:fixed;inset:0;background:rgba(0,0,0,.97);display:none;align-items:center;justify-content:center;z-index:20000;padding:20px;opacity:0;transition:opacity .3s}
#playerModal.active{display:flex;opacity:1}
#playerContent{width:100%;max-width:1180px;aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden;position:relative;transform:scale(.95);transition:transform .3s var(--spring);box-shadow:0 0 80px rgba(0,0,0,.9)}
#playerModal.active #playerContent{transform:scale(1)}
#playerIframe{width:100%;height:100%;border:none}
.player-btn-row{position:absolute;top:-52px;right:0;display:flex;gap:8px;align-items:center}
.player-top-btn{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.18);color:var(--text);padding:8px 16px;border-radius:18px;cursor:pointer;font-size:13px;font-weight:600;transition:all .2s;display:flex;align-items:center;gap:7px;font-family:'Outfit',sans-serif}
.player-top-btn:hover{background:var(--primary);border-color:var(--primary);color:#fff}

/* MINI PLAYER */
#miniPlayer{position:fixed;bottom:88px;right:18px;width:300px;height:169px;background:#000;border-radius:12px;overflow:hidden;z-index:25000;display:none;box-shadow:0 20px 60px rgba(0,0,0,.9),0 0 0 1px rgba(255,255,255,.08)}
#miniPlayer.active{display:block;animation:miniIn .35s var(--spring) both}
@keyframes miniIn{from{transform:scale(.6) translateY(60px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
#miniPlayerIframe{width:100%;height:100%;border:none}
.mini-player-controls{position:absolute;inset:0;background:rgba(0,0,0,0);transition:background .2s;display:flex;align-items:center;justify-content:center;gap:8px;opacity:0}
#miniPlayer:hover .mini-player-controls{background:rgba(0,0,0,.6);opacity:1}
.mini-ctrl-btn{width:34px;height:34px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);border-radius:50%;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:14px;transition:all .2s;backdrop-filter:blur(4px)}
.mini-ctrl-btn:hover{background:var(--primary);border-color:var(--primary);transform:scale(1.08)}
.mini-player-title{position:absolute;bottom:0;left:0;right:0;padding:18px 10px 7px;background:linear-gradient(to top,rgba(0,0,0,.9),transparent);font-size:10px;font-weight:600;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.mini-drag{position:absolute;top:7px;left:7px;width:18px;height:18px;cursor:grab;display:flex;flex-direction:column;justify-content:space-between;padding:3px;opacity:.4}
.mini-drag:hover{opacity:1}
.mini-drag span{display:block;height:1.5px;background:#fff;border-radius:1px}

/* SEARCH */
.search-section{padding:28px 4% 0}
.search-container{display:flex;gap:10px;max-width:780px;align-items:stretch}
.search-wrapper{flex:1;position:relative}
.search-box{display:flex;align-items:center;background:rgba(255,255,255,.06);border:1.5px solid transparent;border-radius:8px;padding:4px 4px 4px 42px;transition:all .25s;backdrop-filter:blur(12px)}
.search-box:focus-within{background:rgba(255,255,255,.08);border-color:var(--primary);box-shadow:0 0 0 3px rgba(229,9,20,.15)}
.search-icon{position:absolute;left:13px;top:50%;transform:translateY(-50%);color:var(--text-muted);font-size:15px;pointer-events:none;transition:color .2s}
.search-box:focus-within .search-icon{color:var(--primary)}
#searchInput{flex:1;background:transparent;border:none;color:var(--text);font-size:15px;font-weight:500;padding:11px 8px;outline:none;font-family:'Outfit',sans-serif}
#searchInput::placeholder{color:var(--text-muted)}
.search-clear{width:26px;height:26px;border-radius:50%;background:rgba(255,255,255,.08);border:none;color:var(--text-muted);cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:13px;opacity:0;transition:all .2s;margin-right:4px}
.search-clear.visible{opacity:1}
.search-clear:hover{background:rgba(229,9,20,.2);color:var(--primary)}
.search-btn{background:var(--primary);color:#fff;border:none;padding:0 20px;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:7px;transition:all .2s;white-space:nowrap;text-transform:uppercase;letter-spacing:.5px;font-family:'Outfit',sans-serif}
.search-btn:hover{background:var(--primary-dark);transform:translateY(-1px);box-shadow:0 4px 16px var(--primary-glow)}
.filter-wrapper{position:relative;min-width:120px}
#ratingSelect{width:100%;padding:12px 30px 12px 12px;border-radius:8px;font-size:12px;font-weight:600;background:rgba(255,255,255,.06);color:var(--text);border:1.5px solid transparent;cursor:pointer;appearance:none;transition:border-color .2s;text-transform:uppercase;letter-spacing:.5px;font-family:'Outfit',sans-serif;backdrop-filter:blur(12px)}
#ratingSelect:hover,#ratingSelect:focus{border-color:rgba(255,255,255,.15);outline:none}

/* SEARCH RESULTS */
#searchResults{display:none;padding:24px 4% 40px;min-height:50vh}
#searchResults.active{display:block;animation:fadeIn .3s}
.search-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:16px}

/* SECTIONS */
#upcomingSection{display:none;padding-top:90px}
.upcoming-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin-top:16px}
.upcoming-card{background:var(--surface);border-radius:12px;overflow:hidden;border:1px solid var(--border);transition:all .3s;cursor:pointer}
.upcoming-card:hover{transform:translateY(-5px);box-shadow:0 16px 40px rgba(0,0,0,.5);border-color:rgba(229,9,20,.25)}
.upcoming-poster{width:100%;height:120px;object-fit:cover}
.upcoming-info{padding:12px}
.upcoming-title{font-size:13px;font-weight:700;margin-bottom:4px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.upcoming-date{font-size:11px;color:var(--primary);font-weight:700;margin-bottom:4px}
.upcoming-overview{font-size:11px;color:var(--text-muted);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.upcoming-countdown{background:var(--surface-light);border-radius:6px;padding:4px 8px;font-size:11px;font-weight:700;color:var(--text-secondary);display:inline-flex;align-items:center;gap:5px;margin-top:7px}
.upcoming-countdown .days{color:var(--primary);font-size:13px;font-weight:900}
#nowPlayingSection{display:none;padding:90px 4% 40px}
#continueWatchingSection{display:none;padding:90px 4% 40px}
#myListSection{display:none;padding:90px 4% 40px}
#historySection{display:none;padding:90px 4% 40px}

/* DISCOVER */
#discoverMoreSection{padding:64px 4%;border-top:1px solid var(--border)}
.discover-header{text-align:center;margin-bottom:44px}
.discover-title{font-size:36px;font-weight:900;margin-bottom:12px;text-transform:uppercase;letter-spacing:-1px}
.discover-subtitle{color:var(--text-secondary);font-size:16px;max-width:540px;margin:0 auto;line-height:1.6}
.discover-stats{display:flex;justify-content:center;gap:52px;margin-top:26px;flex-wrap:wrap}
.stat-item{text-align:center}
.stat-number{font-size:32px;font-weight:900;color:var(--primary);display:block;margin-bottom:3px}
.stat-label{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:2px;font-weight:700}
.discover-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(135px,1fr));gap:16px;margin-bottom:44px}
.load-more-container{text-align:center;padding:28px 0}
.load-more-btn{background:transparent;color:var(--text);border:2px solid var(--text-muted);padding:13px 40px;border-radius:28px;font-size:13px;font-weight:700;cursor:pointer;transition:all .3s;display:inline-flex;align-items:center;gap:10px;text-transform:uppercase;letter-spacing:1px;font-family:'Outfit',sans-serif}
.load-more-btn:hover{background:var(--primary);border-color:var(--primary);color:#fff;transform:translateY(-2px);box-shadow:0 8px 24px var(--primary-glow)}

/* RATINGS */
.ratings-section{padding:0 28px 24px;border-top:1px solid var(--border)}
.ratings-title{font-size:13px;font-weight:800;padding-top:16px;margin-bottom:16px;text-transform:uppercase;letter-spacing:1px}
.rating-widget{background:var(--surface-light);border-radius:12px;padding:18px;border:1px solid var(--border);margin-bottom:18px}
.rating-widget-label{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-bottom:10px}
.star-row{display:flex;gap:5px;margin-bottom:14px}
.star-btn{font-size:26px;cursor:pointer;background:none;border:none;color:var(--text-muted);transition:all .15s;line-height:1;padding:2px;filter:grayscale(1)}
.star-btn:hover,.star-btn.active{color:#ffd700;filter:grayscale(0) drop-shadow(0 0 6px rgba(255,215,0,.5));transform:scale(1.15)}
.star-btn.hovered{color:#ffd700;filter:grayscale(0);transform:scale(1.1)}
.review-textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:13px;font-family:'Outfit',sans-serif;padding:10px 13px;resize:vertical;min-height:78px;outline:none;transition:border-color .2s;line-height:1.6}
.review-textarea:focus{border-color:var(--primary)}
.review-textarea::placeholder{color:var(--text-muted)}
.review-submit-row{display:flex;justify-content:space-between;align-items:center;margin-top:10px;gap:12px}
.review-char-count{font-size:11px;color:var(--text-muted)}
.review-submit-btn{background:var(--primary);color:#fff;border:none;padding:8px 18px;border-radius:8px;font-size:12px;font-weight:700;cursor:pointer;transition:all .2s;font-family:'Outfit',sans-serif;text-transform:uppercase;letter-spacing:.5px}
.review-submit-btn:hover{background:var(--primary-dark);transform:translateY(-1px)}
.review-submit-btn:disabled{opacity:.4;cursor:not-allowed;transform:none}
.your-rating-display{display:none;align-items:center;gap:10px;padding:10px 14px;background:rgba(255,215,0,.08);border:1px solid rgba(255,215,0,.2);border-radius:8px;margin-bottom:10px}
.your-rating-display.show{display:flex}
.your-rating-stars{color:#ffd700;font-size:15px;letter-spacing:1px}
.your-rating-text{font-size:12px;color:var(--text-secondary)}
.edit-rating-btn{margin-left:auto;background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:12px;text-decoration:underline;font-family:'Outfit',sans-serif}
.edit-rating-btn:hover{color:var(--primary)}
.reviews-list{display:flex;flex-direction:column;gap:10px}
.review-item{background:var(--surface-light);border-radius:10px;padding:12px 14px;border:1px solid var(--border)}
.review-item-header{display:flex;align-items:center;gap:8px;margin-bottom:7px;flex-wrap:wrap}
.review-item-user{font-size:13px;font-weight:700}
.review-item-stars{color:#ffd700;font-size:12px}
.review-item-date{font-size:11px;color:var(--text-muted);margin-left:auto}
.review-item-text{font-size:13px;color:var(--text-secondary);line-height:1.6}
.review-item-delete{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:11px;margin-left:8px;font-family:'Outfit',sans-serif}
.review-item-delete:hover{color:var(--primary)}
.no-reviews{color:var(--text-muted);font-size:13px;text-align:center;padding:14px}
.avg-rating-bar{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.avg-rating-num{font-size:34px;font-weight:900;line-height:1}
.avg-rating-right{display:flex;flex-direction:column;gap:3px}
.avg-stars{color:#ffd700;font-size:16px}
.avg-count{font-size:12px;color:var(--text-muted)}

/* HISTORY */
.history-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:12px;margin-top:18px}
.history-item{display:flex;gap:12px;align-items:center;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:10px;cursor:pointer;transition:all .25s}
.history-item:hover{border-color:rgba(229,9,20,.3);transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.4)}
.history-poster{width:48px;height:72px;border-radius:6px;object-fit:cover;flex-shrink:0;background:var(--surface-light)}
.history-info{flex:1;min-width:0}
.history-title{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px}
.history-meta{font-size:11px;color:var(--text-muted);display:flex;align-items:center;gap:6px;flex-wrap:wrap;margin-bottom:4px}
.history-timestamp{font-size:11px;color:var(--text-secondary)}
.history-badge{background:var(--surface-lighter);padding:2px 7px;border-radius:10px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--primary)}
.history-delete-btn{background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:16px;padding:4px;border-radius:6px;transition:all .15s;flex-shrink:0}
.history-delete-btn:hover{background:rgba(229,9,20,.1);color:var(--primary)}
.history-filter-row{display:flex;gap:8px;margin-top:14px;flex-wrap:wrap;align-items:center}
.history-filter-btn{background:var(--surface-light);border:1px solid var(--border);color:var(--text-secondary);padding:7px 15px;border-radius:18px;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Outfit',sans-serif}
.history-filter-btn.active,.history-filter-btn:hover{background:var(--primary);border-color:var(--primary);color:#fff}
.history-clear-btn{margin-left:auto;background:none;border:1px solid var(--border);color:var(--text-muted);padding:7px 13px;border-radius:18px;font-size:12px;font-weight:600;cursor:pointer;transition:all .2s;font-family:'Outfit',sans-serif}
.history-clear-btn:hover{border-color:var(--primary);color:var(--primary)}

/* MODALS */
.modal-base{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:50000;backdrop-filter:blur(6px);opacity:0;transition:opacity .25s}
.modal-base.active{display:flex;opacity:1}
.shortcuts-content{background:var(--surface);border-radius:16px;padding:32px;max-width:540px;width:90%;border:1px solid var(--border);transform:scale(.95);transition:transform .25s var(--spring);box-shadow:0 40px 80px rgba(0,0,0,.8)}
.modal-base.active .shortcuts-content{transform:scale(1)}
.shortcuts-title{font-size:20px;font-weight:800;margin-bottom:22px;text-align:center}
.shortcut-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)}
.shortcut-row:last-child{border-bottom:none}
.shortcut-key{background:var(--surface-light);padding:3px 9px;border-radius:5px;font-family:monospace;font-weight:700;font-size:12px;border:1px solid var(--border)}
.shortcut-desc{color:var(--text-secondary);font-size:13px}
.premium-modal-content{background:var(--surface);border-radius:20px;padding:0;max-width:460px;width:90%;border:1px solid rgba(255,215,0,.2);overflow:hidden;box-shadow:0 0 60px rgba(255,215,0,.12),0 40px 80px rgba(0,0,0,.8);transform:scale(.92) translateY(16px);transition:transform .3s var(--spring)}
.modal-base.active .premium-modal-content{transform:scale(1) translateY(0)}
.premium-header{background:linear-gradient(135deg,#140f00,#2a1f00);padding:30px;text-align:center;border-bottom:1px solid rgba(255,215,0,.15);position:relative}
.premium-crown{font-size:50px;display:block;margin-bottom:8px;filter:drop-shadow(0 0 20px rgba(255,215,0,.7));animation:crownPulse 2.5s ease-in-out infinite}
@keyframes crownPulse{0%,100%{transform:scale(1) rotate(-3deg)}50%{transform:scale(1.08) rotate(3deg)}}
.premium-title{font-size:24px;font-weight:900;background:linear-gradient(135deg,#ffd700,#ff8c00);-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-transform:uppercase;letter-spacing:2px;margin-bottom:4px}
.premium-subtitle{color:var(--text-secondary);font-size:13px}
.premium-body{padding:24px}
.premium-features{display:flex;flex-direction:column;gap:9px;margin-bottom:20px}
.premium-feature{display:flex;align-items:center;gap:11px;font-size:13px;color:var(--text-secondary)}
.premium-feature .feature-icon{width:29px;height:29px;background:rgba(255,215,0,.08);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;flex-shrink:0;border:1px solid rgba(255,215,0,.15)}
.discord-cta{background:#5865F2;color:#fff;border:none;width:100%;padding:12px;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:all .2s;margin-bottom:10px;text-decoration:none;font-family:'Outfit',sans-serif}
.discord-cta:hover{background:#4752c4;transform:translateY(-1px)}
.premium-divider{display:flex;align-items:center;gap:12px;margin:12px 0;color:var(--text-muted);font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px}
.premium-divider::before,.premium-divider::after{content:'';flex:1;height:1px;background:var(--border)}
.login-section{background:var(--surface-light);border-radius:10px;padding:16px;border:1px solid var(--border)}
.login-title{font-size:12px;font-weight:700;margin-bottom:12px;text-align:center;text-transform:uppercase;letter-spacing:.5px}
.login-input{width:100%;padding:10px 13px;background:var(--surface);border:1px solid var(--border);border-radius:8px;color:var(--text);font-size:14px;margin-bottom:9px;outline:none;transition:border-color .2s,box-shadow .2s;font-family:'Outfit',sans-serif}
.login-input:focus{border-color:#ffd700;box-shadow:0 0 0 3px rgba(255,215,0,.1)}
.login-btn{width:100%;padding:10px;background:linear-gradient(135deg,#ffd700,#ff8c00);border:none;border-radius:8px;color:#000;font-size:13px;font-weight:800;cursor:pointer;transition:all .2s;text-transform:uppercase;letter-spacing:.5px;font-family:'Outfit',sans-serif}
.login-btn:hover{transform:translateY(-1px);box-shadow:0 5px 16px rgba(255,215,0,.35)}
.login-error{color:#ff4444;font-size:12px;text-align:center;margin-top:7px;display:none}
.login-success{color:#22c55e;font-size:12px;text-align:center;margin-top:7px;display:none;font-weight:600}
.premium-close{position:absolute;top:13px;right:13px;width:28px;height:28px;background:rgba(255,255,255,.08);border:none;color:#fff;border-radius:50%;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;transition:all .2s}
.premium-close:hover{background:rgba(255,255,255,.18);transform:rotate(90deg)}
.premium-logged-in{text-align:center;padding:10px 0}
.premium-user-badge{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(135deg,rgba(255,215,0,.12),rgba(255,140,0,.08));border:1px solid rgba(255,215,0,.25);border-radius:18px;padding:6px 13px;margin-bottom:10px;font-size:13px;font-weight:700;color:#ffd700}
.logout-btn{background:transparent;border:1px solid var(--border);color:var(--text-secondary);padding:6px 16px;border-radius:8px;cursor:pointer;font-size:12px;transition:all .2s;font-family:'Outfit',sans-serif}
.logout-btn:hover{border-color:var(--primary);color:var(--primary)}

/* TOAST */
.toast{position:fixed;bottom:28px;left:50%;transform:translateX(-50%) translateY(80px);background:var(--surface-lighter);color:var(--text);padding:12px 22px;border-radius:8px;border:1px solid var(--border);z-index:30000;opacity:0;transition:all .3s var(--spring);font-weight:600;font-size:13px;box-shadow:0 8px 32px rgba(0,0,0,.5);pointer-events:none;white-space:nowrap}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
.toast.success{border-color:#22c55e}
.toast.error{border-color:var(--primary)}

/* FABs */
.discord-btn{position:fixed;bottom:28px;left:28px;width:52px;height:52px;background:#5865F2;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1000;box-shadow:0 4px 16px rgba(88,101,242,.35);transition:all .25s;border:none;text-decoration:none}
.discord-btn:hover{transform:scale(1.1) rotate(-8deg);box-shadow:0 6px 24px rgba(88,101,242,.55)}
.discord-btn svg{width:26px;height:26px;fill:white}
.tiktok-btn{position:fixed;bottom:28px;left:90px;width:52px;height:52px;background:#010101;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1000;box-shadow:0 4px 16px rgba(0,0,0,.5);transition:all .25s;border:none;text-decoration:none}
.tiktok-btn:hover{transform:scale(1.1) rotate(8deg)}
.tiktok-btn svg{width:26px;height:26px}
.premium-fab{position:fixed;bottom:92px;left:28px;width:52px;height:52px;background:linear-gradient(135deg,#ffd700,#ff8c00);border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1000;box-shadow:0 4px 16px rgba(255,215,0,.3);transition:all .25s;border:none;font-size:22px}
.premium-fab:hover{transform:scale(1.1);box-shadow:0 6px 24px rgba(255,215,0,.6)}

/* MISC */
.loading-container{display:flex;justify-content:center;padding:52px}
.spinner{width:34px;height:34px;border:2.5px solid rgba(255,255,255,.08);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.empty-state{color:var(--text-muted);padding:52px 40px;text-align:center;font-size:14px;width:100%}
@keyframes fadeInUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* WHAT'S HOT TODAY */
.hot-today-section{padding:24px 4% 0}
.hot-today-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(230px,1fr));gap:12px;margin-top:14px}
.hot-item{display:flex;align-items:center;gap:14px;background:var(--surface-light);border-radius:12px;padding:10px;border:1px solid var(--border);cursor:pointer;transition:all .2s;position:relative;overflow:hidden}
.hot-item::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--primary);border-radius:0 2px 2px 0;transform:scaleY(0);transition:transform .2s;transform-origin:bottom}
.hot-item:hover{border-color:rgba(229,9,20,.3);transform:translateX(4px)}
.hot-item:hover::before{transform:scaleY(1)}
.hot-rank{font-size:28px;font-weight:900;color:var(--primary);min-width:36px;text-align:center;line-height:1;flex-shrink:0}
.hot-poster{width:46px;height:68px;border-radius:6px;object-fit:cover;flex-shrink:0;background:var(--surface-lighter)}
.hot-info{flex:1;min-width:0}
.hot-title{font-size:13px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px}
.hot-meta{font-size:11px;color:var(--text-muted);display:flex;gap:8px;align-items:center}
.hot-score{background:var(--primary);color:#fff;font-size:9px;font-weight:800;padding:2px 6px;border-radius:4px;margin-left:auto;flex-shrink:0}

/* PEOPLE ALSO WATCHED */
.paw-section{padding:0 28px 20px;border-top:1px solid var(--border)}
.paw-title{font-size:13px;font-weight:800;padding-top:16px;margin-bottom:12px;text-transform:uppercase;letter-spacing:1px}
.paw-row{display:flex;gap:10px;overflow-x:auto;padding-bottom:4px;scrollbar-width:thin;scrollbar-color:var(--primary) transparent}
.paw-card{flex:0 0 100px;background:var(--surface-light);border-radius:8px;overflow:hidden;cursor:pointer;border:1px solid var(--border);transition:all .2s}
.paw-card:hover{transform:scale(1.05);border-color:rgba(229,9,20,.35)}
.paw-card img{width:100%;height:60px;object-fit:cover}
.paw-card-title{padding:5px 7px;font-size:10px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;color:var(--text-secondary)}

/* =========== SETTINGS MODAL =========== */
#settingsModal{position:fixed;inset:0;background:rgba(0,0,0,.88);display:none;align-items:center;justify-content:center;z-index:50000;backdrop-filter:blur(10px);opacity:0;transition:opacity .3s}
#settingsModal.active{display:flex;opacity:1}
.settings-wrap{background:var(--surface);border-radius:20px;width:90%;max-width:680px;max-height:88vh;overflow-y:auto;border:1px solid var(--border);box-shadow:0 40px 80px rgba(0,0,0,.8);transform:scale(.95) translateY(18px);transition:transform .35s var(--spring);scrollbar-width:thin;scrollbar-color:var(--primary) transparent}
#settingsModal.active .settings-wrap{transform:scale(1) translateY(0)}
.settings-head{position:sticky;top:0;background:var(--surface);padding:22px 26px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;z-index:2}
.settings-head-left{display:flex;align-items:center;gap:12px}
.settings-icon-big{font-size:28px}
.settings-head-title{font-size:20px;font-weight:900;letter-spacing:-.5px}
.settings-head-subtitle{font-size:12px;color:var(--text-muted);margin-top:1px}
.settings-close{background:var(--surface-light);border:1px solid var(--border);color:var(--text);width:34px;height:34px;border-radius:50%;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:all .2s}
.settings-close:hover{background:var(--primary);border-color:var(--primary);transform:rotate(90deg)}
.settings-body{padding:22px 26px 30px;display:flex;flex-direction:column;gap:28px}
.settings-section{border-bottom:1px solid var(--border);padding-bottom:24px}
.settings-section:last-child{border-bottom:none;padding-bottom:0}
.settings-section-title{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:2px;color:var(--text-muted);margin-bottom:14px;display:flex;align-items:center;gap:7px}
.settings-section-title::before{content:'';width:20px;height:2px;background:var(--primary);border-radius:1px}
.settings-row{display:flex;align-items:center;justify-content:space-between;padding:11px 0;gap:16px}
.settings-row-label{display:flex;flex-direction:column;gap:2px;flex:1}
.settings-row-name{font-size:14px;font-weight:600}
.settings-row-desc{font-size:11px;color:var(--text-muted);line-height:1.4}
/* Toggle switch */
.toggle{position:relative;width:46px;height:26px;flex-shrink:0}
.toggle input{opacity:0;width:0;height:0;position:absolute}
.toggle-track{position:absolute;inset:0;background:var(--surface-lighter);border-radius:13px;cursor:pointer;transition:background .2s;border:1px solid var(--border)}
.toggle input:checked + .toggle-track{background:var(--primary);border-color:var(--primary)}
.toggle-track::after{content:'';position:absolute;left:3px;top:3px;width:18px;height:18px;background:#fff;border-radius:50%;transition:transform .2s;box-shadow:0 1px 4px rgba(0,0,0,.3)}
.toggle input:checked + .toggle-track::after{transform:translateX(20px)}
/* Slider */
.settings-slider-wrap{display:flex;align-items:center;gap:12px;flex:1;max-width:260px}
.settings-slider{-webkit-appearance:none;appearance:none;width:100%;height:4px;border-radius:2px;background:var(--surface-lighter);outline:none;cursor:pointer}
.settings-slider::-webkit-slider-thumb{-webkit-appearance:none;width:16px;height:16px;border-radius:50%;background:var(--primary);cursor:pointer;box-shadow:0 0 6px var(--primary-glow);transition:transform .15s}
.settings-slider::-webkit-slider-thumb:hover{transform:scale(1.2)}
.settings-slider::-moz-range-thumb{width:16px;height:16px;border-radius:50%;background:var(--primary);cursor:pointer;border:none}
.settings-slider-val{font-size:12px;font-weight:700;color:var(--text-secondary);min-width:34px;text-align:right}
/* Color swatches */
.color-swatches{display:flex;gap:8px;flex-wrap:wrap}
.color-swatch{width:28px;height:28px;border-radius:50%;cursor:pointer;transition:all .2s;border:2px solid transparent;position:relative}
.color-swatch:hover{transform:scale(1.15)}
.color-swatch.active{border-color:#fff;transform:scale(1.1)}
.color-swatch.active::after{content:'';position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:12px;color:#fff;font-weight:900}
/* Select dropdown */
.settings-select{background:var(--surface-light);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:8px 28px 8px 11px;font-size:13px;font-weight:600;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 12 12'%3E%3Cpath fill='%23a3a3a3' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 8px center;outline:none;font-family:'Outfit',sans-serif;transition:border-color .2s}
.settings-select:focus{border-color:var(--primary)}
/* About section / devs */
.dev-cards{display:flex;gap:12px;flex-wrap:wrap}
.dev-card{display:flex;align-items:center;gap:12px;background:var(--surface-light);border:1px solid var(--border);border-radius:12px;padding:12px 16px;flex:1;min-width:200px;transition:border-color .2s}
.dev-card:hover{border-color:rgba(229,9,20,.35)}
.dev-avatar{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;border:2px solid var(--border)}
.dev-info{flex:1}
.dev-name{font-size:14px;font-weight:800}
.dev-role{font-size:11px;color:var(--text-muted);margin-top:1px}
.dev-badge{font-size:9px;font-weight:800;padding:2px 7px;border-radius:10px;background:var(--primary);color:#fff;margin-top:4px;display:inline-block;text-transform:uppercase;letter-spacing:.5px}
.app-version-row{display:flex;align-items:center;justify-content:space-between;background:var(--surface-light);border-radius:10px;padding:12px 16px;border:1px solid var(--border)}
.app-version-label{font-size:12px;color:var(--text-muted);font-weight:600;text-transform:uppercase;letter-spacing:.5px}
.app-version-val{font-size:13px;font-weight:700;color:var(--primary)}
/* Reset button */
.settings-reset-btn{width:100%;background:transparent;border:1px solid rgba(229,9,20,.3);color:var(--primary);padding:10px;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .2s;text-transform:uppercase;letter-spacing:.5px}
.settings-reset-btn:hover{background:rgba(229,9,20,.1);border-color:var(--primary)}

/* MOBILE */
@media(max-width:768px){
  #heroFeatured{height:75vh;min-height:480px}
  .hero-content-wrap{padding:0 5% 60px}
  .hero-title{font-size:30px;letter-spacing:-1px;margin-bottom:10px}
  .hero-overview{font-size:13px;-webkit-line-clamp:2;margin-bottom:18px}
  .hero-play-btn,.hero-info-btn{padding:10px 16px;font-size:14px}
  .mobile-menu-btn{display:flex}
  .nav-links{display:none}
  .card{width:108px;height:162px}
  .card-medium{width:128px;height:192px}
  .card-large{width:170px;height:255px}
  .wide-card{width:240px}
  .wide-card-thumb{height:135px}
  .category-section{margin:22px 0;padding:0 3%}
  .movie-row{gap:9px}
  .search-section{padding:18px 3% 0}
  .search-container{flex-direction:column;gap:8px}
  .search-btn{padding:12px;justify-content:center}
  #detailsModal{padding:0;align-items:flex-end}
  #detailsContent{border-radius:20px 20px 0 0;max-height:94vh;overflow-y:auto}
  .modal-close-btn{top:10px;right:10px;width:36px;height:36px}
  .details-info{padding:16px 16px 0;margin-top:-32px}
  .details-title{font-size:20px}
  .details-actions{flex-direction:column;gap:8px}
  .btn-primary,.btn-secondary,.btn-download{width:100%;justify-content:center}
  .skip-buttons{width:100%;margin-left:0}
  .skip-btn{flex:1;justify-content:center;font-size:11px}
  #detailsBody{padding:0 14px 14px}
  .episode-section{padding:0 14px 18px}
  .episode-header{flex-direction:column;align-items:flex-start}
  .season-select-wrap{margin-left:0;width:100%}
  .season-dropdown{width:100%}
  .episode-card{flex-direction:column}
  .episode-thumb-wrap{flex:none;width:100%;height:0;padding-bottom:56.25%;position:relative}
  .episode-thumb{position:absolute;inset:0;width:100%;height:100%}
  .recommendations-section{padding:0 14px 18px}
  .paw-section{padding:0 14px 16px}
  .ratings-section{padding:0 14px 18px}
  .server-selector{margin-left:5px;padding-left:5px}
  .server-label{display:none}
  .server-select{min-width:78px;font-size:11px}
  #miniPlayer{width:210px;height:118px;bottom:68px;right:8px}
  .discord-btn,.tiktok-btn{width:44px;height:44px;bottom:14px}
  .discord-btn{left:14px}
  .tiktok-btn{left:68px}
  .premium-fab{width:44px;height:44px;left:14px;bottom:68px;font-size:18px}
  #discoverMoreSection{padding:36px 3%}
  .discover-title{font-size:24px}
  .discover-stats{gap:24px}
  .discover-grid{grid-template-columns:repeat(auto-fill,minmax(108px,1fr));gap:10px}
  .upcoming-grid{grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px}
  .history-grid{grid-template-columns:1fr}
  #playerModal{padding:10px}
  .player-btn-row{top:-46px}
  .pc-grid{grid-template-columns:1fr}
  .profiles-grid{grid-template-columns:repeat(3,1fr)}
  }
</style>
</head>
<body>

<a href="https://www.tiktok.com/@gnstream0" target="_blank" class="tiktok-btn" title="Follow on TikTok">
<svg viewBox="0 0 24 24"><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.88 2.5 2.89 2.89 0 0 1-2.89-2.89 2.89 2.89 0 0 1 2.89-2.89c.28 0 .54.04.79.1V9.01a6.34 6.34 0 0 0-.79-.05 6.34 6.34 0 0 0-6.34 6.34 6.34 6.34 0 0 0 6.34 6.34 6.34 6.34 0 0 0 6.33-6.34V8.69a8.18 8.18 0 0 0 4.78 1.52V6.75a4.85 4.85 0 0 1-1.01-.06z" fill="white"/><path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-2.5 2.5 2.89 2.89 0 0 1-2.89-2.89 2.89 2.89 0 0 1 2.89-2.89c.28 0 .54.04.79.1V9.01a6.34 6.34 0 0 0-.79-.05 6.34 6.34 0 0 0-6.34 6.34 6.34 6.34 0 0 0 6.34 6.34 6.34 6.34 0 0 0 6.33-6.34V8.69a8.18 8.18 0 0 0 4.78 1.52V6.75a4.85 4.85 0 0 1-1.01-.06z" fill="url(#tg)" opacity=".5"/><defs><linearGradient id="tg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#69C9D0"/><stop offset="100%" stop-color="#EE1D52"/></linearGradient></defs></svg>
</a>
<a href="https://discord.gg/WhAJBMDUc" target="_blank" class="discord-btn" title="Join Discord">
<svg viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
</a>
<button class="premium-fab" onclick="openPremiumModal()" title="Premium"></button>

<!-- FEATURE 2: PROFILES MODAL -->
<div id="profilesModal" onclick="if(event.target===this)closeProfiles()">
  <div class="profiles-content">
    <div class="profiles-title">Who's watching?</div>
    <div class="profiles-subtitle">Choose your profile to personalize recommendations</div>
    <div class="profiles-grid" id="profilesGrid"></div>
    <button class="profiles-manage-btn" onclick="manageProfiles()"> Manage Profiles</button>
  </div>
</div>

<!-- FEATURE 3: PLAYER CONTROLS PANEL -->
<div id="playerControlsModal">
  <div class="pc-title"> Playback Settings <button class="pc-close" onclick="closePlayerControls()"></button></div>
  <div class="pc-grid">
    <div>
      <h4> Playback Speed</h4>
      <div class="pc-options" id="speedOptions">
        <div class="pc-opt" onclick="setSpeed(0.5,this)"><span>0.5 Slow</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setSpeed(0.75,this)"><span>0.75</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt selected" onclick="setSpeed(1,this)"><span>1 Normal</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setSpeed(1.25,this)"><span>1.25</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setSpeed(1.5,this)"><span>1.5 Fast</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setSpeed(2,this)"><span>2 Faster</span><span class="pc-opt-check"></span></div>
      </div>
    </div>
    <div>
      <h4> Subtitles / CC</h4>
      <div id="subtitleOptions">
        <div class="subtitle-track selected" onclick="setSubtitle('off',this)"><span class="subtitle-flag"></span><span class="subtitle-name">Off</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('en',this)"><span class="subtitle-flag"></span><span class="subtitle-name">English</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('es',this)"><span class="subtitle-flag"></span><span class="subtitle-name">Spanish</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('fr',this)"><span class="subtitle-flag"></span><span class="subtitle-name">French</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('de',this)"><span class="subtitle-flag"></span><span class="subtitle-name">German</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('ja',this)"><span class="subtitle-flag"></span><span class="subtitle-name">Japanese</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('pt',this)"><span class="subtitle-flag"></span><span class="subtitle-name">Portuguese</span><span class="subtitle-check"></span></div>
        <div class="subtitle-track" onclick="setSubtitle('ko',this)"><span class="subtitle-flag"></span><span class="subtitle-name">Korean</span><span class="subtitle-check"></span></div>
      </div>
    </div>
    <div>
      <h4> Video Quality</h4>
      <div class="pc-options" id="qualityOptions">
        <div class="pc-opt" onclick="setQuality('4k',this)"><span>4K Ultra HD <span class="quality-badge"></span></span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setQuality('1080',this)"><span>1080p Full HD</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt selected" onclick="setQuality('720',this)"><span>720p HD</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setQuality('480',this)"><span>480p SD</span><span class="pc-opt-check"></span></div>
        <div class="pc-opt" onclick="setQuality('auto',this)"><span>Auto</span><span class="pc-opt-check"></span></div>
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" onclick="if(event.target===this)closeSettings()">
  <div class="settings-wrap" onclick="event.stopPropagation()">
    <div class="settings-head">
      <div class="settings-head-left">
        <span class="settings-icon-big"></span>
        <div>
          <div class="settings-head-title">Settings</div>
          <div class="settings-head-subtitle">Customize your GN-Stream experience</div>
        </div>
      </div>
      <button class="settings-close" onclick="closeSettings()"></button>
    </div>
    <div class="settings-body">

      <!-- APPEARANCE -->
      <div class="settings-section">
        <div class="settings-section-title"> Appearance</div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Theme</div>
            <div class="settings-row-desc">Choose between dark and light mode</div>
          </div>
          <select class="settings-select" id="themeSelect" onchange="applyThemeSetting(this.value)">
            <option value="dark"> Dark</option>
            <option value="light"> Light</option>
          </select>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Accent Color</div>
            <div class="settings-row-desc">Pick a highlight color for buttons & icons</div>
          </div>
          <div class="color-swatches" id="accentSwatches">
            <div class="color-swatch active" style="background:#e50914" data-color="#e50914" data-glow="rgba(229,9,20,0.35)" onclick="setAccentColor('#e50914','rgba(229,9,20,0.35)',this)" title="Red"></div>
            <div class="color-swatch" style="background:#1d9bf0" data-color="#1d9bf0" data-glow="rgba(29,155,240,0.35)" onclick="setAccentColor('#1d9bf0','rgba(29,155,240,0.35)',this)" title="Blue"></div>
            <div class="color-swatch" style="background:#22c55e" data-color="#22c55e" data-glow="rgba(34,197,94,0.35)" onclick="setAccentColor('#22c55e','rgba(34,197,94,0.35)',this)" title="Green"></div>
            <div class="color-swatch" style="background:#a855f7" data-color="#a855f7" data-glow="rgba(168,85,247,0.35)" onclick="setAccentColor('#a855f7','rgba(168,85,247,0.35)',this)" title="Purple"></div>
            <div class="color-swatch" style="background:#f97316" data-color="#f97316" data-glow="rgba(249,115,22,0.35)" onclick="setAccentColor('#f97316','rgba(249,115,22,0.35)',this)" title="Orange"></div>
            <div class="color-swatch" style="background:#ec4899" data-color="#ec4899" data-glow="rgba(236,72,153,0.35)" onclick="setAccentColor('#ec4899','rgba(236,72,153,0.35)',this)" title="Pink"></div>
            <div class="color-swatch" style="background:#fbbf24" data-color="#fbbf24" data-glow="rgba(251,191,36,0.35)" onclick="setAccentColor('#fbbf24','rgba(251,191,36,0.35)',this)" title="Yellow"></div>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Brightness</div>
            <div class="settings-row-desc">Adjust overall page brightness</div>
          </div>
          <div class="settings-slider-wrap">
            <span style="font-size:13px"></span>
            <input type="range" class="settings-slider" id="brightnessSlider" min="40" max="110" value="100" oninput="applyBrightness(this.value)">
            <span style="font-size:13px"></span>
            <span class="settings-slider-val" id="brightnessVal">100%</span>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Saturation</div>
            <div class="settings-row-desc">Boost or mute color intensity</div>
          </div>
          <div class="settings-slider-wrap">
            <span style="font-size:13px"></span>
            <input type="range" class="settings-slider" id="saturationSlider" min="0" max="200" value="100" oninput="applySaturation(this.value)">
            <span style="font-size:13px"></span>
            <span class="settings-slider-val" id="saturationVal">100%</span>
          </div>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Card Size</div>
            <div class="settings-row-desc">Change how big movie poster cards appear</div>
          </div>
          <select class="settings-select" id="cardSizeSelect" onchange="applyCardSize(this.value)">
            <option value="small">Small</option>
            <option value="normal" selected>Normal</option>
            <option value="large">Large</option>
          </select>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Film Grain Effect</div>
            <div class="settings-row-desc">Cinematic noise overlay on background</div>
          </div>
          <label class="toggle"><input type="checkbox" id="grainToggle" checked onchange="applyGrain(this.checked)"><span class="toggle-track"></span></label>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Blur / Glassmorphism</div>
            <div class="settings-row-desc">Frosted glass effect on header and overlays</div>
          </div>
          <label class="toggle"><input type="checkbox" id="blurToggle" checked onchange="applyBlur(this.checked)"><span class="toggle-track"></span></label>
        </div>
      </div>

      <!-- PLAYBACK -->
      <div class="settings-section">
        <div class="settings-section-title"> Playback</div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Default Server</div>
            <div class="settings-row-desc">Which streaming server to use by default</div>
          </div>
          <select class="settings-select" id="defaultServerSelect" onchange="changeServer(this.value)">
            <option value="1">AutoEmbed Test</option>
            <option value="2">AutoEmbed Player</option>
            <option value="3">GN-stream FLixy</option>
            <option value="4">VidSrc.to</option>
            <option value="5">2Embed</option>
            <option value="6">MultiEmbed</option>
            <option value="7">Embed.su</option>
            <option value="8">VidSrc.xyz</option>
            <option value="9">VidSrc.me</option>
            <option value="10">VidSrc.in</option>
          </select>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Autoplay Next Episode</div>
            <div class="settings-row-desc">Automatically start the next episode</div>
          </div>
          <label class="toggle"><input type="checkbox" id="autoplayToggle" checked onchange="saveSetting('autoplay',this.checked)"><span class="toggle-track"></span></label>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Skip Intros Automatically</div>
            <div class="settings-row-desc">Auto-skip intro sequences when detected</div>
          </div>
          <label class="toggle"><input type="checkbox" id="autoSkipToggle" onchange="saveSetting('autoSkip',this.checked)"><span class="toggle-track"></span></label>
        </div>
      </div>

      <!-- CONTENT -->
      <div class="settings-section">
        <div class="settings-section-title"> Content</div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Show Ratings on Cards</div>
            <div class="settings-row-desc">Display star ratings on poster thumbnails</div>
          </div>
          <label class="toggle"><input type="checkbox" id="ratingsOnCardsToggle" checked onchange="toggleRatingsOnCards(this.checked)"><span class="toggle-track"></span></label>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Mature Content Filter</div>
            <div class="settings-row-desc">Hide R-rated and NC-17 titles</div>
          </div>
          <label class="toggle"><input type="checkbox" id="matureFilterToggle" onchange="saveSetting('matureFilter',this.checked)"><span class="toggle-track"></span></label>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">Content Language</div>
            <div class="settings-row-desc">Preferred language for content</div>
          </div>
          <select class="settings-select" id="contentLangSelect" onchange="saveSetting('contentLang',this.value)">
            <option value="en-US"> English</option>
            <option value="es-ES"> Spanish</option>
            <option value="fr-FR"> French</option>
            <option value="de-DE"> German</option>
            <option value="ja-JP"> Japanese</option>
            <option value="ko-KR"> Korean</option>
            <option value="pt-BR"> Portuguese</option>
          </select>
        </div>
      </div>

      <!-- NOTIFICATIONS -->
      <div class="settings-section">
        <div class="settings-section-title"> Notifications</div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">New Release Alerts</div>
            <div class="settings-row-desc">Get notified when new titles drop</div>
          </div>
          <label class="toggle"><input type="checkbox" id="newReleaseNotifToggle" onchange="saveSetting('newReleaseNotif',this.checked)"><span class="toggle-track"></span></label>
        </div>

        <div class="settings-row">
          <div class="settings-row-label">
            <div class="settings-row-name">System Toasts</div>
            <div class="settings-row-desc">Show pop-up notifications for actions</div>
          </div>
          <label class="toggle"><input type="checkbox" id="toastsToggle" checked onchange="saveSetting('toasts',this.checked)"><span class="toggle-track"></span></label>
        </div>
      </div>

      <!-- ABOUT / DEVS -->
      <div class="settings-section">
        <div class="settings-section-title"> Development Team</div>
        <div class="dev-cards">
          <div class="dev-card">
            <div class="dev-avatar" style="background:linear-gradient(135deg,rgba(229,9,20,.15),rgba(229,9,20,.05));border-color:rgba(229,9,20,.25)"></div>
            <div class="dev-info">
              <div class="dev-name">Corbini</div>
              <div class="dev-role">Lead Developer  UI/UX</div>
              <div class="dev-badge">Founder</div>
            </div>
          </div>
          <div class="dev-card">
            <div class="dev-avatar" style="background:linear-gradient(135deg,rgba(99,102,241,.15),rgba(99,102,241,.05));border-color:rgba(99,102,241,.25)"></div>
            <div class="dev-info">
              <div class="dev-name">Dummy</div>
              <div class="dev-role">Backend  Systems Dev</div>
              <div class="dev-badge" style="background:#6366f1">Co-Dev</div>
            </div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="app-version-row">
            <span class="app-version-label">App Version</span>
            <span class="app-version-val">GN-Stream v3.0.0</span>
          </div>
          <div class="app-version-row" style="margin-top:8px">
            <span class="app-version-label">Build Date</span>
            <span class="app-version-val" id="buildDate"></span>
          </div>
          <div class="app-version-row" style="margin-top:8px">
            <span class="app-version-label">Data Source</span>
            <span class="app-version-val">TMDB API</span>
          </div>
        </div>
      </div>

      <!-- DANGER ZONE -->
      <div class="settings-section">
        <div class="settings-section-title"> Reset</div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="settings-reset-btn" onclick="resetAppearance()"> Reset Appearance to Default</button>
          <button class="settings-reset-btn" style="border-color:rgba(229,9,20,.6)" onclick="clearAllData()"> Clear All Local Data</button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Shortcuts -->
<div class="modal-base" id="shortcutsModal" onclick="if(event.target===this)closeShortcuts()">
  <div class="shortcuts-content">
    <div class="shortcuts-title"> Keyboard Shortcuts</div>
    <div>
      <div class="shortcut-row"><span class="shortcut-desc">Search</span><span class="shortcut-key">/</span></div>
      <div class="shortcut-row"><span class="shortcut-desc">Close</span><span class="shortcut-key">Esc</span></div>
      <div class="shortcut-row"><span class="shortcut-desc">Mini Player</span><span class="shortcut-key">Ctrl+M</span></div>
      <div class="shortcut-row"><span class="shortcut-desc">Skip Intro</span><span class="shortcut-key">S</span></div>
      <div class="shortcut-row"><span class="shortcut-desc">Toggle Theme</span><span class="shortcut-key">T</span></div>
      <div class="shortcut-row"><span class="shortcut-desc">Playback Settings</span><span class="shortcut-key">P</span></div>
      <div class="shortcut-row"><span class="shortcut-desc">Shortcuts</span><span class="shortcut-key">?</span></div>
    </div>
    <div style="text-align:center;margin-top:20px"><button class="btn-secondary" onclick="closeShortcuts()" style="padding:9px 26px">Close</button></div>
  </div>
</div>

<!-- Premium -->
<div class="modal-base" id="premiumModal" onclick="if(event.target===this)closePremiumModal()">
  <div class="premium-modal-content">
    <div class="premium-header">
      <button class="premium-close" onclick="closePremiumModal()"></button>
      <span class="premium-crown"></span>
      <div class="premium-title">GN-Stream Premium</div>
      <div class="premium-subtitle">Unlock exclusive content & features</div>
    </div>
    <div class="premium-body">
      <div id="premiumLoggedInState" style="display:none">
        <div class="premium-logged-in">
          <div class="premium-user-badge"> <span id="premiumUserName"></span>  Premium Active</div>
          <p style="color:var(--text-secondary);font-size:13px;margin-bottom:12px">Full access granted!</p>
          <button class="logout-btn" onclick="logoutPremium()">Sign Out</button>
        </div>
      </div>
      <div id="premiumGuestState">
        <div class="premium-features">
          <div class="premium-feature"><div class="feature-icon"></div><span>All locked content unlocked</span></div>
          <div class="premium-feature"><div class="feature-icon"></div><span>4K Ultra HD quality</span></div>
          <div class="premium-feature"><div class="feature-icon"></div><span>Unlimited downloads</span></div>
          <div class="premium-feature"><div class="feature-icon"></div><span>New Releases unlocked</span></div>
          <div class="premium-feature"><div class="feature-icon"></div><span>Up to 5 profiles</span></div>
        </div>
        <a href="https://discord.gg/WhAJBMDUc" target="_blank" class="discord-cta">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="white"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
          Join Discord for Premium
        </a>
        <div class="premium-divider">or sign in</div>
        <div class="login-section">
          <div class="login-title"> Premium Sign In</div>
          <input class="login-input" id="premiumUser" type="text" placeholder="Username" autocomplete="off"/>
          <input class="login-input" id="premiumPass" type="password" placeholder="Password" autocomplete="off"/>
          <button class="login-btn" onclick="loginPremium()">Sign In</button>
          <div class="login-error" id="loginError"> Invalid credentials</div>
          <div class="login-success" id="loginSuccess"> Welcome! Premium unlocked.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Header -->
<header id="mainHeader">
  <div class="logo" onclick="showHome()">GN-STREAM</div>
  <nav class="nav-links">
    <a onclick="showHome()" class="active" id="nav-home">Home</a>
    <a onclick="showUpcoming()" id="nav-upcoming">Upcoming</a>
    <a onclick="showNowPlaying()" id="nav-nowplaying">Now Playing</a>
    <a onclick="showContinueWatching()" id="nav-continue">Continue</a>
    <a onclick="showMyList()" id="nav-mylist">My List <span id="myListCount" class="my-list-badge" style="display:none">0</span></a>
    <a onclick="showHistory()" id="nav-history">History</a>
    <a onclick="scrollToSection('movies')" id="nav-movies">Movies</a>
    <a onclick="scrollToSection('tv')" id="nav-tv">TV Shows</a>
    <span class="premium-active-badge" id="premiumActiveBadge"> Premium</span>
    <div class="server-selector">
      <span class="server-label">Server</span>
      <select id="serverSelect" class="server-select" onchange="changeServer(this.value)">
        <option value="1">AutoEmbed Test</option><option value="2">AutoEmbed Player</option>
        <option value="3">GN-stream FLixy</option><option value="4">VidSrc.to</option>
        <option value="5">2Embed</option><option value="6">MultiEmbed</option>
        <option value="7">Embed.su</option><option value="8">VidSrc.xyz</option>
        <option value="9">VidSrc.me</option><option value="10">VidSrc.in</option>
      </select>
    </div>
    <button class="icon-btn" onclick="toggleShortcuts()" title="Shortcuts"></button>
    <button class="icon-btn" onclick="openSettings()" title="Settings"></button>
    <button class="icon-btn" onclick="toggleTheme()" id="themeToggleBtn"></button>
    <div class="profile-avatar" onclick="openProfiles()" title="Switch Profile" id="headerProfile"></div>
    <button class="premium-header-btn" onclick="openPremiumModal()"> Premium</button>
  </nav>
  <button class="mobile-menu-btn" onclick="toggleMobileMenu()"></button>
</header>

<!-- Mobile Nav -->
<div class="mobile-nav" id="mobileNav">
  <a onclick="showHome();toggleMobileMenu()"> Home</a>
  <a onclick="showUpcoming();toggleMobileMenu()"> Upcoming</a>
  <a onclick="showNowPlaying();toggleMobileMenu()"> Now Playing</a>
  <a onclick="showContinueWatching();toggleMobileMenu()"> Continue</a>
  <a onclick="showMyList();toggleMobileMenu()"> My List</a>
  <a onclick="showHistory();toggleMobileMenu()"> History</a>
  <a onclick="openSettings();toggleMobileMenu()"> Settings</a>
  <a onclick="openProfiles();toggleMobileMenu()"> Profiles</a>
  <a onclick="openPremiumModal();toggleMobileMenu()"> Premium</a>
  <div style="padding:12px;border-top:1px solid var(--border);margin-top:6px;display:flex;align-items:center;gap:10px">
    <span style="color:var(--text-muted);font-size:11px;font-weight:700;text-transform:uppercase">Server</span>
    <select id="mobileServerSelect" class="server-select" onchange="changeServer(this.value)" style="flex:1">
      <option value="1">AutoEmbed Test</option><option value="2">AutoEmbed Player</option>
      <option value="3">GN-stream FLixy</option><option value="4">VidSrc.to</option>
      <option value="5">2Embed</option><option value="6">MultiEmbed</option>
      <option value="7">Embed.su</option><option value="8">VidSrc.xyz</option>
      <option value="9">VidSrc.me</option><option value="10">VidSrc.in</option>
    </select>
  </div>
</div>

<!-- HERO -->
<div id="heroFeatured">
  <div class="hero-backdrop" id="heroBackdrop"></div>
  <div class="hero-content-wrap" style="animation:fadeInUp .8s both">
    <div class="hero-badge" id="heroBadge"> #1 Trending</div>
    <div class="hero-title" id="heroTitle">Loading</div>
    <div class="hero-meta" id="heroMeta"></div>
    <div class="hero-overview" id="heroOverview"></div>
    <div class="hero-actions">
      <button class="hero-play-btn" onclick="heroPlay()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>Play
      </button>
      <button class="hero-info-btn" onclick="heroMoreInfo()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="8" stroke-linecap="round"/><line x1="12" y1="12" x2="12" y2="16" stroke-linecap="round"/></svg>More Info
      </button>
      <button class="hero-trailer-btn" onclick="heroPlayTrailer()"> Trailer</button>
      <button class="hero-watchlist-btn" id="heroWatchlistBtn" onclick="heroToggleList()" title="Add to My List"></button>
    </div>
  </div>
  <div class="hero-scroll-indicator" id="heroScrollDots"></div>
</div>

<!-- FEATURE: MOOD BAR -->
<div class="mood-bar" id="homeMoodBar">
  <div class="mood-bar-title"> What's Your Mood?</div>
  <div class="mood-pills">
    <button class="mood-pill" onclick="filterByMood('happy',this)"> Feel-Good</button>
    <button class="mood-pill" onclick="filterByMood('scary',this)"> Scary</button>
    <button class="mood-pill" onclick="filterByMood('romantic',this)"> Romantic</button>
    <button class="mood-pill" onclick="filterByMood('tense',this)"> Edge-of-Seat</button>
    <button class="mood-pill" onclick="filterByMood('funny',this)"> Make Me Laugh</button>
    <button class="mood-pill" onclick="filterByMood('chill',this)"> Chill</button>
    <button class="mood-pill" onclick="filterByMood('inspire',this)"> Inspire Me</button>
  </div>
</div>

<!-- MOOD RESULTS -->
<div id="moodResultsSection" style="display:none;padding:24px 4% 0">
  <div class="mood-results-header">
    <div class="mood-results-title" id="moodResultsTitle"></div>
    <button class="mood-results-close" onclick="closeMoodResults()"> Clear</button>
  </div>
  <div class="mood-results-grid" id="moodResultsGrid"><div class="loading-container"><div class="spinner"></div></div></div>
</div>

<!-- GENRE FILTER -->
<div class="genre-filter-section" id="homeGenreSection">
  <div class="genre-filter-row" id="genreFilterRow">
    <button class="genre-pill active" onclick="filterGenre(null,this)">All</button>
    <button class="genre-pill" onclick="filterGenre(28,this)"> Action</button>
    <button class="genre-pill" onclick="filterGenre(35,this)"> Comedy</button>
    <button class="genre-pill" onclick="filterGenre(27,this)"> Horror</button>
    <button class="genre-pill" onclick="filterGenre(878,this)"> Sci-Fi</button>
    <button class="genre-pill" onclick="filterGenre(10749,this)"> Romance</button>
    <button class="genre-pill" onclick="filterGenre(53,this)"> Thriller</button>
    <button class="genre-pill" onclick="filterGenre(18,this)"> Drama</button>
    <button class="genre-pill" onclick="filterGenre(16,this)"> Animation</button>
    <button class="genre-pill" onclick="filterGenre(80,this)"> Crime</button>
    <button class="genre-pill" onclick="filterGenre(14,this)"> Fantasy</button>
    <button class="genre-pill" onclick="filterGenre(12,this)"> Adventure</button>
    <button class="genre-pill" onclick="filterGenre(10751,this)"> Family</button>
  </div>
</div>

<!-- SEARCH -->
<div class="search-section" id="homeSearchSection">
  <div class="search-container">
    <div class="search-wrapper">
      <div class="search-box">
        <span class="search-icon"></span>
        <input id="searchInput" placeholder="Search movies, shows" autocomplete="off"/>
        <button class="search-clear" id="searchClear" onclick="clearSearchInput()"></button>
      </div>
    </div>
    <button class="search-btn" onclick="executeSearch()">Search</button>
    <div class="filter-wrapper">
      <select id="ratingSelect">
        <option value="all">All Ratings</option>
        <option value="gpg">G / PG</option>
        <option value="pg13">PG-13</option>
        <option value="r">R</option>
        <option value="nc17">NC-17</option>
      </select>
    </div>
  </div>
</div>

<!-- SECTION PAGES -->
<div id="upcomingSection" style="display:none">
  <div class="category-section" style="opacity:1;transform:none;padding-top:90px">
    <div class="category-header"><div class="category-title"> Upcoming Releases</div><button class="btn-secondary" onclick="showHome()" style="padding:7px 13px;font-size:12px"> Back</button></div>
    <div class="upcoming-grid" id="upcomingGrid"><div class="loading-container"><div class="spinner"></div></div></div>
  </div>
</div>
<div id="nowPlayingSection" style="display:none;padding:90px 4% 40px">
  <div class="category-header"><div class="category-title"> Now Playing</div><button class="btn-secondary" onclick="showHome()" style="padding:7px 13px;font-size:12px"> Back</button></div>
  <div class="movie-row" id="nowPlayingRow"></div>
</div>
<div id="continueWatchingSection" style="display:none;padding:90px 4% 40px">
  <div class="category-header"><div class="category-title"> Continue Watching</div><div class="view-all" onclick="clearContinueWatching()">Clear All</div></div>
  <div class="movie-row" id="continueWatchingRow"></div>
</div>
<div id="myListSection" style="display:none;padding:90px 4% 40px">
  <div class="category-header"><div class="category-title"> My List</div></div>
  <div class="movie-row" id="myListRow"></div>
</div>
<div id="historySection" style="display:none;padding:90px 4% 40px">
  <div class="category-header"><div class="category-title"> Watch History</div><button class="btn-secondary" onclick="showHome()" style="padding:7px 13px;font-size:12px"> Back</button></div>
  <div class="history-filter-row">
    <button class="history-filter-btn active" onclick="filterHistory('all',this)">All</button>
    <button class="history-filter-btn" onclick="filterHistory('movie',this)">Movies</button>
    <button class="history-filter-btn" onclick="filterHistory('tv',this)">TV Shows</button>
    <button class="history-clear-btn" onclick="clearFullHistory()"> Clear All</button>
  </div>
  <div class="history-grid" id="historyGrid"></div>
</div>

<!-- HOME CATEGORIES -->
<div id="categoriesContainer">
  <div style="padding:28px 4% 0;display:none" id="continueWatchingInlineSection">
    <div class="category-header"><div class="category-title"> Continue Watching</div><div class="view-all" onclick="clearContinueWatching()">Clear</div></div>
    <div style="display:flex;gap:12px;overflow-x:auto;padding:10px 0 14px;scroll-snap-type:x mandatory;scrollbar-width:thin;scrollbar-color:var(--primary) transparent" id="continueWatchingInlineRow"></div>
  </div>

  <div class="category-section" id="section-hot">
    <div class="category-header"><div class="category-title"> What's Hot Today</div><div class="view-all" onclick="scrollToSection('trending')">See Trending </div></div>
    <div class="hot-today-grid" id="hotTodayGrid"><div class="loading-container" style="padding:20px"><div class="spinner"></div></div></div>
  </div>

  <div class="category-section" id="section-trending"><div class="category-header"><div class="category-title"> Trending Now</div></div><div class="movie-row" id="trendingRow"></div></div>
  <div class="category-section" id="section-top10">
    <div class="category-header"><div class="category-title"> Top 10 This Week</div></div>
    <div class="movie-row" id="top10Row" style="padding-bottom:20px"></div>
  </div>
  <div class="category-section" id="section-newrelease"><div class="category-header"><div class="category-title"> New Releases <span style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000;padding:2px 7px;border-radius:7px;font-size:10px;margin-left:6px;font-weight:800"> Premium</span></div></div><div class="movie-row" id="newReleaseRow"></div></div>
  <div class="category-section" id="section-action"><div class="category-header"><div class="category-title"> Action</div></div><div class="movie-row" id="actionRow"></div></div>
  <div class="category-section" id="section-comedy"><div class="category-header"><div class="category-title"> Comedy</div></div><div class="movie-row" id="comedyRow"></div></div>
  <div class="category-section" id="section-horror"><div class="category-header"><div class="category-title"> Horror</div></div><div class="movie-row" id="horrorRow"></div></div>
  <div class="category-section" id="section-scifi"><div class="category-header"><div class="category-title"> Sci-Fi</div></div><div class="movie-row" id="scifiRow"></div></div>
  <div class="category-section" id="section-romance"><div class="category-header"><div class="category-title"> Romance</div></div><div class="movie-row" id="romanceRow"></div></div>
  <div class="category-section" id="section-thriller"><div class="category-header"><div class="category-title"> Thriller</div></div><div class="movie-row" id="thrillerRow"></div></div>
  <div class="category-section" id="section-drama"><div class="category-header"><div class="category-title"> Drama</div></div><div class="movie-row" id="dramaRow"></div></div>
  <div class="category-section" id="section-animation"><div class="category-header"><div class="category-title"> Animation</div></div><div class="movie-row" id="animationRow"></div></div>
  <div class="category-section" id="section-documentary"><div class="category-header"><div class="category-title"> Documentary</div></div><div class="movie-row" id="documentaryRow"></div></div>
  <div class="category-section" id="section-crime"><div class="category-header"><div class="category-title"> Crime</div></div><div class="movie-row" id="crimeRow"></div></div>
  <div class="category-section" id="section-mystery"><div class="category-header"><div class="category-title"> Mystery</div></div><div class="movie-row" id="mysteryRow"></div></div>
  <div class="category-section" id="section-fantasy"><div class="category-header"><div class="category-title"> Fantasy</div></div><div class="movie-row" id="fantasyRow"></div></div>
  <div class="category-section" id="section-family"><div class="category-header"><div class="category-title"> Family</div></div><div class="movie-row" id="familyRow"></div></div>
  <div class="category-section" id="section-adventure"><div class="category-header"><div class="category-title"> Adventure</div></div><div class="movie-row" id="adventureRow"></div></div>
  <div class="category-section" id="section-movies"><div class="category-header"><div class="category-title"> Popular Movies</div></div><div class="movie-row" id="popularMoviesRow"></div></div>
  <div class="category-section" id="section-tv"><div class="category-header"><div class="category-title"> TV Shows</div></div><div class="movie-row" id="popularTvRow"></div></div>
  <div class="category-section" id="section-korean"><div class="category-header"><div class="category-title"> K-Drama</div></div><div class="movie-row" id="koreanRow"></div></div>
  <div class="category-section" id="section-anime"><div class="category-header"><div class="category-title"> Anime</div></div><div class="movie-row" id="animeRow"></div></div>
  <div class="category-section" id="section-award"><div class="category-header"><div class="category-title"> Award Winners</div></div><div class="movie-row" id="awardRow"></div></div>
</div>

<!-- DISCOVER -->
<div id="discoverMoreSection">
  <div class="discover-header">
    <div class="discover-title">Discover More</div>
    <div class="discover-subtitle">Explore our massive library  updated daily</div>
    <div class="discover-stats">
      <div class="stat-item"><span class="stat-number" id="totalMovies">2,200,000+</span><span class="stat-label">Titles</span></div>
      <div class="stat-item"><span class="stat-number">25+</span><span class="stat-label">Genres</span></div>
      <div class="stat-item"><span class="stat-number">Daily</span><span class="stat-label">Updated</span></div>
    </div>
  </div>
  <div class="discover-grid" id="discoverGrid"></div>
  <div class="load-more-container"><button class="load-more-btn" id="loadMoreBtn" onclick="loadDiscoverMore()">Load More</button></div>
</div>

<!-- SEARCH RESULTS -->
<div id="searchResults" style="display:none;padding:24px 4% 40px;min-height:50vh">
  <div class="category-header"><div class="category-title"> Search Results</div><button class="btn-secondary" onclick="clearSearch()" style="padding:7px 13px;font-size:12px">Back</button></div>
  <div class="search-grid" id="searchResultsGrid"></div>
</div>

<!-- DETAILS MODAL -->
<div id="detailsModal" onclick="closeDetailsOnBackdrop(event)">
  <button class="modal-close-btn" onclick="closeDetails()"></button>
  <div id="detailsContent" onclick="event.stopPropagation()">
    <div id="posterContainer">
      <img id="posterImage" src="" alt="Poster">
      <div class="poster-gradient"></div>
      <button class="trailer-play-btn" onclick="playModalTrailer()" title="Watch Trailer">
        <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      </button>
    </div>
    <div class="details-info">
      <div class="details-title" id="detailsTitle"></div>
      <div class="details-meta">
        <span class="match-score" id="matchScore">98% Match</span>
        <span id="detailsYear"></span>
        <span id="detailsRuntime"></span>
        <span class="details-rating" id="detailsRating">NR</span>
        <span id="detailsGenre"></span>
      </div>
      <div class="details-actions">
        <button class="btn-primary" onclick="playContent()"> Play</button>
        <button class="btn-secondary" id="detailsAddToList" onclick="toggleListFromDetails()">+ My List</button>
        <button class="btn-download" onclick="downloadContent()"> Download</button>
        <div class="skip-buttons">
          <button class="skip-btn" onclick="skipIntro()"> Skip Intro</button>
          <button class="skip-btn" onclick="skipRecap()"> Skip Recap</button>
        </div>
      </div>
    </div>
    <div id="detailsBody">
      <div class="details-section"><h3>About</h3><p id="detailsOverview"></p></div>
      <div class="details-section"><h3>Cast</h3><div class="cast-list" id="detailsCast"></div></div>
      <div class="details-section" id="tagsSection" style="display:none"><h3>Tags</h3><div class="details-tags" id="detailsTags"></div></div>
    </div>

    <div class="episode-section" id="episodeSectionWrap" style="display:none">
      <div class="episode-header">
        <div class="episode-header-title">Episodes</div>
        <div class="season-select-wrap">
          <label>Season</label>
          <select id="seasonDropdown" class="season-dropdown" onchange="onSeasonChange()"></select>
        </div>
      </div>
      <div class="episodes-grid" id="episodesGrid"><div class="loading-container"><div class="spinner"></div></div></div>
    </div>

    <div class="paw-section" id="pawSection" style="display:none">
      <div class="paw-title"> People Also Watched</div>
      <div class="paw-row" id="pawRow"></div>
    </div>

    <div class="recommendations-section">
      <div class="recommendations-title"> More Like This</div>
      <div class="recommendations-row" id="recommendationsRow"><div class="loading-container" style="padding:18px"><div class="spinner"></div></div></div>
    </div>

    <div class="ratings-section" id="ratingsSection">
      <div class="ratings-title"> Ratings & Reviews</div>
      <div class="avg-rating-bar" id="avgRatingBar" style="display:none">
        <div class="avg-rating-num" id="avgRatingNum">0.0</div>
        <div class="avg-rating-right">
          <div class="avg-stars" id="avgStarsDisplay"></div>
          <div class="avg-count" id="avgRatingCount">0 reviews</div>
        </div>
      </div>
      <div class="your-rating-display" id="yourRatingDisplay">
        <span class="your-rating-stars" id="yourRatingStars"></span>
        <span class="your-rating-text">Your rating</span>
        <button class="edit-rating-btn" onclick="editRating()">Edit</button>
      </div>
      <div class="rating-widget" id="ratingInputWidget">
        <div class="rating-widget-label">Rate this title</div>
        <div class="star-row" id="starRow">
          <button class="star-btn" data-val="1" onclick="setRating(1)"></button>
          <button class="star-btn" data-val="2" onclick="setRating(2)"></button>
          <button class="star-btn" data-val="3" onclick="setRating(3)"></button>
          <button class="star-btn" data-val="4" onclick="setRating(4)"></button>
          <button class="star-btn" data-val="5" onclick="setRating(5)"></button>
        </div>
        <textarea class="review-textarea" id="reviewTextarea" placeholder="Write a review (optional)" maxlength="500" oninput="updateCharCount()"></textarea>
        <div class="review-submit-row">
          <span class="review-char-count" id="charCount">0 / 500</span>
          <button class="review-submit-btn" id="submitReviewBtn" onclick="submitReview()" disabled>Submit</button>
        </div>
      </div>
      <div class="reviews-list" id="reviewsList"></div>
    </div>
  </div>
</div>

<!-- PLAYER -->
<div id="playerModal" onclick="closePlayerOnBackdrop(event)">
  <div id="playerContent" onclick="event.stopPropagation()">
    <div class="player-btn-row">
      <button class="player-top-btn" onclick="openPlayerControls()"> Settings</button>
      <button class="player-top-btn" onclick="launchMiniPlayer()"> Mini</button>
      <button class="player-top-btn" onclick="closePlayer()"> Close</button>
    </div>
    <iframe id="playerIframe" allowfullscreen></iframe>
  </div>
</div>

<!-- MINI PLAYER -->
<div id="miniPlayer">
  <iframe id="miniPlayerIframe" allowfullscreen></iframe>
  <div class="mini-player-controls">
    <button class="mini-ctrl-btn" onclick="expandMiniPlayer()"></button>
    <button class="mini-ctrl-btn" onclick="closeMiniPlayer()"></button>
  </div>
  <div class="mini-player-title" id="miniPlayerTitle">Now Playing</div>
  <div class="mini-drag" id="miniDrag"><span></span><span></span><span></span></div>
</div>

<div class="noise"></div>
<div class="toast" id="toast"></div>

<script>
const API_KEY='3a73619bbb8fc6d47742d1b5b2b707b5';
const BASE='https://api.themoviedb.org/3';
const IMG='https://image.tmdb.org/t/p/';
const FB_POSTER='https://via.placeholder.com/300x450/111/444?text=No+Poster';
const FB_BACK='https://via.placeholder.com/1280x720/111/444?text=No+Backdrop';
const PREMIUM_USERS={'lebron':'67'};
const GENRES={ACTION:28,COMEDY:35,HORROR:27,SCIFI:878,ROMANCE:10749,THRILLER:53,DRAMA:18,ANIMATION:16,DOCUMENTARY:99,CRIME:80,MYSTERY:9648,FANTASY:14,FAMILY:10751,ADVENTURE:12};
const MOOD_MAP={
  happy:{name:'Feel-Good Picks ',genres:[35,10751,12],emoji:'',class:'mood-happy'},
  scary:{name:'Scary Stuff ',genres:[27,9648,53],emoji:'',class:'mood-scary'},
  romantic:{name:'Romantic Picks ',genres:[10749,35,18],emoji:'',class:'mood-romantic'},
  tense:{name:'Edge-of-Seat ',genres:[53,28,80],emoji:'',class:'mood-tense'},
  funny:{name:'Comedy Night ',genres:[35,16,10751],emoji:'',class:'mood-funny'},
  chill:{name:'Chill Vibes ',genres:[99,18,12],emoji:'',class:'mood-chill'},
  inspire:{name:'Inspiring Stories ',genres:[18,36,10752],emoji:'',class:'mood-inspire'}
};
const SERVERS={
  '1':{name:'AutoEmbed Test',url:(id,tv,s,e)=>tv?`https://test.autoembed.cc/embed/tv/${id}/${s}/${e}?autoplay=true`:`https://test.autoembed.cc/embed/movie/${id}?autoplay=true`},
  '2':{name:'AutoEmbed Player',url:(id,tv,s,e)=>tv?`https://player.autoembed.cc/embed/tv/${id}/${s}/${e}`:`https://player.autoembed.cc/embed/movie/${id}`},
  '3':{name:'GN-stream FLixy',url:(id,tv,s,e)=>tv?`https://player.vidify.top/embed/tv/${id}/${s}/${e}?poster=true&autoPlay=true`:`https://player.vidify.top/embed/movie/${id}?poster=true&autoPlay=true`},
  '4':{name:'VidSrc.to',url:(id,tv,s,e)=>tv?`https://vidsrc.to/embed/tv/${id}/${s}/${e}`:`https://vidsrc.to/embed/movie/${id}`},
  '5':{name:'2Embed',url:(id,tv,s,e)=>tv?`https://www.2embed.cc/embedtv/${id}&s=${s}&e=${e}`:`https://www.2embed.cc/embed/${id}`},
  '6':{name:'MultiEmbed',url:(id,tv,s,e)=>tv?`https://multiembed.mov/?video_id=${id}&tmdb=1&s=${s}&e=${e}`:`https://multiembed.mov/?video_id=${id}&tmdb=1`},
  '7':{name:'Embed.su',url:(id,tv,s,e)=>tv?`https://embed.su/embed/tv/${id}/${s}/${e}`:`https://embed.su/embed/movie/${id}`},
  '8':{name:'VidSrc.xyz',url:(id,tv,s,e)=>tv?`https://vidsrc.xyz/embed/tv?tmdb=${id}&season=${s}&episode=${e}`:`https://vidsrc.xyz/embed/movie?tmdb=${id}`},
  '9':{name:'VidSrc.me',url:(id,tv,s,e)=>tv?`https://vidsrc.me/embed/tv?tmdb=${id}&season=${s}&episode=${e}`:`https://vidsrc.me/embed/movie?tmdb=${id}`},
  '10':{name:'VidSrc.in',url:(id,tv,s,e)=>tv?`https://vidsrc.in/embed/tv?tmdb=${id}&season=${s}&episode=${e}`:`https://vidsrc.in/embed/movie?tmdb=${id}`}
};

// PROFILES DATA
const DEFAULT_PROFILES=[
  {id:1,name:'Main',emoji:'',badge:'premium',color:'#e50914'},
  {id:2,name:'Kids',emoji:'',badge:'kids',color:'#22c55e'},
  {id:3,name:'Guest',emoji:'',badge:null,color:'#6366f1'},
];
let profiles=JSON.parse(localStorage.getItem('gnStreamProfiles')||JSON.stringify(DEFAULT_PROFILES));
let activeProfile=JSON.parse(localStorage.getItem('gnStreamActiveProfile')||JSON.stringify(profiles[0]));

let myList=JSON.parse(localStorage.getItem('gnStreamMyList')||'[]');
let continueWatching=JSON.parse(localStorage.getItem('gnStreamContinue')||'[]');
let watchHistory=JSON.parse(localStorage.getItem('gnStreamHistory')||'[]');
let userReviews=JSON.parse(localStorage.getItem('gnStreamReviews')||'{}');
let currentDetailsItem=null;
let selectedRating=0;
let historyFilter='all';
let scrollPos=0;
let currentServer=localStorage.getItem('gnStreamServer')||'1';
let discoverPage=1;
let discoverLoaded=0;
let isLoadingDiscover=false;
let isPremiumUser=localStorage.getItem('gnStreamPremium')==='true';
let premiumUsername=localStorage.getItem('gnStreamPremiumUser')||'';
let miniPlayerActive=false;
let heroItems=[];
let heroIdx=0;
let heroTimer=null;
let currentEpisodeSeason=1;
let currentEpisodeNum=1;
let activeGenreFilter=null;
let currentSpeed=1;
let currentSubtitle='off';
let currentQuality='720';
const apiCache=new Map();
const CACHE_DUR=5*60*1000;

document.getElementById('serverSelect').value=currentServer;
document.getElementById('mobileServerSelect').value=currentServer;

// CACHE
async function fetchWithCache(url){
  const c=apiCache.get(url);
  if(c&&Date.now()-c.t<CACHE_DUR)return c.d;
  try{const r=await fetch(url);const d=await r.json();apiCache.set(url,{d,t:Date.now()});return d;}
  catch{return null;}
}

// THEME
function initTheme(){
  const t=localStorage.getItem('gnStreamTheme')||'dark';
  document.documentElement.setAttribute('data-theme',t);
  document.getElementById('themeToggleBtn').textContent=t==='dark'?'':'';
}
function toggleTheme(){
  const cur=document.documentElement.getAttribute('data-theme');
  const next=cur==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('gnStreamTheme',next);
  document.getElementById('themeToggleBtn').textContent=next==='dark'?'':'';
  showToast(`${next==='dark'?'':''} ${next.charAt(0).toUpperCase()+next.slice(1)} mode`,'success');
}

// SCROLL ANIMATIONS
const observer=new IntersectionObserver((entries)=>{
  entries.forEach(e=>{if(e.isIntersecting){e.target.classList.add('visible');observer.unobserve(e.target);}});
},{threshold:0.1,rootMargin:'0px 0px -40px 0px'});
function observeSections(){document.querySelectorAll('.category-section').forEach(s=>observer.observe(s));}

// HERO
async function loadHero(){
  const d=await fetchWithCache(`${BASE}/trending/all/day?api_key=${API_KEY}&language=en-US`);
  if(!d?.results?.length)return;
  heroItems=d.results.filter(i=>i.backdrop_path).slice(0,6);
  buildHeroDots();setHero(0);
  heroTimer=setInterval(()=>setHero((heroIdx+1)%heroItems.length),7500);
}
function buildHeroDots(){
  const w=document.getElementById('heroScrollDots');w.innerHTML='';
  heroItems.forEach((_,i)=>{
    const d=document.createElement('div');d.className='hero-dot'+(i===0?' active':'');
    d.onclick=()=>{clearInterval(heroTimer);setHero(i);heroTimer=setInterval(()=>setHero((heroIdx+1)%heroItems.length),7500);};
    w.appendChild(d);
  });
}
function setHero(idx){
  heroIdx=idx;const item=heroItems[idx];if(!item)return;
  const isTv=!!item.first_air_date;const title=item.title||item.name;
  const year=(item.release_date||item.first_air_date||'').substring(0,4);
  const rating=item.vote_average?item.vote_average.toFixed(1):'';
  const backdrop=document.getElementById('heroBackdrop');
  backdrop.style.opacity='0';
  setTimeout(()=>{backdrop.style.backgroundImage=`url(${IMG}original${item.backdrop_path})`;backdrop.style.opacity='1';},150);
  document.getElementById('heroTitle').textContent=title;
  document.getElementById('heroOverview').textContent=item.overview||'';
  document.getElementById('heroBadge').innerHTML=` #${idx+1} ${isTv?'TV Show':'Movie'}`;
  document.getElementById('heroMeta').innerHTML=`<span class="hero-match">${Math.floor(Math.random()*15+83)}% Match</span><span>${year}</span>${rating?`<span> ${rating}</span>`:''}<span class="hero-meta-rating" id="heroRatingBadge">NR</span><span>${isTv?'Series':'Movie'}</span>`;
  getCert(item).then(c=>{const el=document.getElementById('heroRatingBadge');if(el)el.textContent=c;});
  document.querySelectorAll('.hero-dot').forEach((d,i)=>d.classList.toggle('active',i===idx));
  item.media_type=isTv?'tv':'movie';window._heroItem=item;
  const inList=myList.some(i=>i.id===item.id);
  const btn=document.getElementById('heroWatchlistBtn');
  btn.textContent=inList?'':'';btn.classList.toggle('in-list',inList);
}
function heroPlay(){const item=window._heroItem;if(!item)return;addToHistory(item);addToContinue(item,0,7200);openPlayer(item.id,item.media_type==='tv',1,1);}
function heroMoreInfo(){if(window._heroItem)openDetails(window._heroItem);}
function heroToggleList(){
  const item=window._heroItem;if(!item)return;
  toggleMyList(item);
  const inList=myList.some(i=>i.id===item.id);
  const btn=document.getElementById('heroWatchlistBtn');btn.textContent=inList?'':'';btn.classList.toggle('in-list',inList);
}
async function heroPlayTrailer(){
  const item=window._heroItem;if(!item)return;
  const type=item.media_type==='tv'?'tv':'movie';
  const d=await fetchWithCache(`${BASE}/${type}/${item.id}/videos?api_key=${API_KEY}`);
  const trailer=d?.results?.find(v=>v.type==='Trailer'&&v.site==='YouTube')||d?.results?.[0];
  if(trailer?.key){window.open(`https://www.youtube.com/watch?v=${trailer.key}`,'_blank');showToast(' Opening trailer','success');}
  else showToast('No trailer available','error');
}

// UTIL
function showToast(msg,type='info'){
  const t=document.getElementById('toast');t.textContent=msg;t.className=`toast ${type} show`;
  clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),3000);
}
function toggleMobileMenu(){document.getElementById('mobileNav').classList.toggle('active');}
window.addEventListener('scroll',()=>document.getElementById('mainHeader').classList.toggle('scrolled',window.scrollY>50));
const searchInput=document.getElementById('searchInput');
const searchClear=document.getElementById('searchClear');
searchInput.addEventListener('input',()=>searchClear.classList.toggle('visible',searchInput.value.length>0));
searchInput.addEventListener('keydown',e=>{if(e.key==='Enter')executeSearch();});
function clearSearchInput(){searchInput.value='';searchInput.focus();searchClear.classList.remove('visible');}
function executeSearch(){const q=searchInput.value.trim();if(q)performSearch(q);}
function changeServer(v){
  currentServer=v;localStorage.setItem('gnStreamServer',v);
  document.getElementById('serverSelect').value=v;document.getElementById('mobileServerSelect').value=v;
  showToast(`Switched to ${SERVERS[v]?.name||'Server '+v}`,'success');
}

// NAV
function setActiveNav(id){document.querySelectorAll('.nav-links a').forEach(a=>a.classList.remove('active'));document.getElementById(id)?.classList.add('active');}
function hideAllSections(){
  ['nowPlayingSection','continueWatchingSection','myListSection','categoriesContainer',
   'searchResults','discoverMoreSection','upcomingSection','historySection',
   'homeSearchSection','heroFeatured','homeGenreSection','moodResultsSection',
   'homeMoodBar'].forEach(id=>{const el=document.getElementById(id);if(el)el.style.display='none';});
}
function showHome(){
  hideAllSections();
  document.getElementById('heroFeatured').style.display='flex';
  document.getElementById('homeMoodBar').style.display='block';
  document.getElementById('homeGenreSection').style.display='block';
  document.getElementById('homeSearchSection').style.display='block';
  document.getElementById('categoriesContainer').style.display='block';
  document.getElementById('discoverMoreSection').style.display='block';
  setActiveNav('nav-home');
  searchInput.value='';searchClear.classList.remove('visible');
  document.querySelectorAll('.mood-pill').forEach(p=>p.classList.remove('active','mood-happy','mood-scary','mood-romantic','mood-tense','mood-funny','mood-chill','mood-inspire'));
  if(continueWatching.length>0){document.getElementById('continueWatchingInlineSection').style.display='block';renderContinueWatchingInline();}
  observeSections();
}
function showNowPlaying(){hideAllSections();document.getElementById('nowPlayingSection').style.display='block';setActiveNav('nav-nowplaying');renderNowPlaying();}
function showContinueWatching(){hideAllSections();document.getElementById('continueWatchingSection').style.display='block';setActiveNav('nav-continue');renderContinueWatching();}
function showMyList(){hideAllSections();document.getElementById('myListSection').style.display='block';setActiveNav('nav-mylist');renderMyList();}
async function showUpcoming(){hideAllSections();document.getElementById('upcomingSection').style.display='block';setActiveNav('nav-upcoming');await loadUpcoming();}
function showHistory(){
  hideAllSections();document.getElementById('historySection').style.display='block';setActiveNav('nav-history');
  historyFilter='all';document.querySelectorAll('.history-filter-btn').forEach((b,i)=>b.classList.toggle('active',i===0));
  renderHistory();
}
function scrollToSection(s){showHome();setTimeout(()=>document.getElementById(`section-${s}`)?.scrollIntoView({behavior:'smooth'}),120);}
function clearSearch(){showHome();}

// ========================== FEATURE 2: PROFILES ==========================
function openProfiles(){
  document.getElementById('profilesModal').classList.add('active');
  document.body.classList.add('modal-open');
  renderProfiles();
}
function closeProfiles(){document.getElementById('profilesModal').classList.remove('active');document.body.classList.remove('modal-open');}
function renderProfiles(){
  const grid=document.getElementById('profilesGrid');grid.innerHTML='';
  profiles.forEach(p=>{
    const item=document.createElement('div');item.className='profile-item';
    const isActive=p.id===activeProfile.id;
    item.innerHTML=`
      <div class="profile-avatar-wrap ${isActive?'active-profile':''}" style="background:${p.color}22">
        <div class="profile-avatar-bg">${p.emoji}</div>
      </div>
      <div class="profile-name">${p.name}</div>
      ${p.badge?`<div class="profile-badge ${p.badge==='kids'?'profile-badge-kids':'profile-badge-premium'}">${p.badge==='kids'?'Kids':' Premium'}</div>`:''}
    `;
    item.onclick=()=>selectProfile(p);
    grid.appendChild(item);
  });
  // Add profile button
  if(profiles.length<5){
    const add=document.createElement('div');add.className='profile-add';
    add.innerHTML=`<div class="profile-add-circle">+</div><div class="profile-name">Add Profile</div>`;
    add.onclick=addProfile;grid.appendChild(add);
  }
}
function selectProfile(p){
  activeProfile=p;localStorage.setItem('gnStreamActiveProfile',JSON.stringify(p));
  document.getElementById('headerProfile').textContent=p.emoji;
  closeProfiles();showToast(`Switched to ${p.name} ${p.emoji}`,'success');
  // Reload lists for profile
  myList=JSON.parse(localStorage.getItem(`gnStreamMyList_${p.id}`)||'[]');updateMyListCount();
}
function addProfile(){
  const name=prompt('Profile name:');if(!name)return;
  const emojis=['','','','',''];
  const newP={id:Date.now(),name:name.substring(0,12),emoji:emojis[Math.floor(Math.random()*emojis.length)],badge:null,color:'#'+Math.floor(Math.random()*0xffffff).toString(16).padStart(6,'0')};
  profiles.push(newP);localStorage.setItem('gnStreamProfiles',JSON.stringify(profiles));renderProfiles();showToast(`Profile "${newP.name}" created`,'success');
}
function manageProfiles(){showToast('Profile management coming soon!','info');}

// ========================== FEATURE 3: PLAYER CONTROLS ==========================
function openPlayerControls(){
  document.getElementById('playerControlsModal').classList.add('active');
}
function closePlayerControls(){document.getElementById('playerControlsModal').classList.remove('active');}
function setSpeed(speed,el){
  currentSpeed=speed;
  document.querySelectorAll('#speedOptions .pc-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');showToast(`Speed: ${speed}`,'success');
}
function setSubtitle(lang,el){
  currentSubtitle=lang;
  document.querySelectorAll('#subtitleOptions .subtitle-track').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');
  const names={'off':'Subtitles off','en':'English subtitles','es':'Spanish subtitles','fr':'French subtitles','de':'German subtitles','ja':'Japanese subtitles','pt':'Portuguese subtitles','ko':'Korean subtitles'};
  showToast(` ${names[lang]||lang}`,'success');
}
function setQuality(q,el){
  if(q==='4k'&&!isPremiumUser){showToast('4K requires Premium ','error');openPremiumModal();return;}
  currentQuality=q;
  document.querySelectorAll('#qualityOptions .pc-opt').forEach(o=>o.classList.remove('selected'));
  el.classList.add('selected');showToast(`Quality: ${q==='4k'?'4K Ultra HD':q==='auto'?'Auto':q+'p'}`,'success');
}

// ========================== FEATURE 4: MOOD SMART RECS ==========================
async function filterByMood(mood,btn){
  const config=MOOD_MAP[mood];if(!config)return;
  // Toggle
  const isActive=btn.classList.contains('active');
  document.querySelectorAll('.mood-pill').forEach(p=>{p.classList.remove('active');Object.values(MOOD_MAP).forEach(m=>p.classList.remove(m.class));});
  if(isActive){closeMoodResults();return;}
  btn.classList.add('active',config.class);
  const sec=document.getElementById('moodResultsSection');
  const grid=document.getElementById('moodResultsGrid');
  sec.style.display='block';
  document.getElementById('moodResultsTitle').innerHTML=`${config.emoji} ${config.name}`;
  grid.innerHTML='<div class="loading-container"><div class="spinner"></div></div>';
  // Fetch from multiple genre combos
  const genreStr=config.genres.slice(0,2).join(',');
  const [movies,tv]=await Promise.all([
    fetchWithCache(`${BASE}/discover/movie?api_key=${API_KEY}&with_genres=${genreStr}&sort_by=popularity.desc&vote_count.gte=100`),
    fetchWithCache(`${BASE}/discover/tv?api_key=${API_KEY}&with_genres=${genreStr}&sort_by=popularity.desc&vote_count.gte=50`)
  ]);
  grid.innerHTML='';
  const combined=[...(movies?.results||[]).map(i=>({...i,media_type:'movie'})),...(tv?.results||[]).map(i=>({...i,media_type:'tv'}))];
  combined.sort(()=>Math.random()-.5).slice(0,20).forEach(item=>createCard(item,grid,0,'card'));
  sec.scrollIntoView({behavior:'smooth',block:'start'});
}
function closeMoodResults(){
  document.getElementById('moodResultsSection').style.display='none';
  document.querySelectorAll('.mood-pill').forEach(p=>{p.classList.remove('active');Object.values(MOOD_MAP).forEach(m=>p.classList.remove(m.class));});
}

// ========================== FEATURE 5: TRAILER PREVIEW (in details) ==========================
async function playModalTrailer(){
  if(!currentDetailsItem)return;
  const type=currentDetailsItem.first_air_date?'tv':'movie';
  const d=await fetchWithCache(`${BASE}/${type}/${currentDetailsItem.id}/videos?api_key=${API_KEY}`);
  const trailer=d?.results?.find(v=>v.type==='Trailer'&&v.site==='YouTube')||d?.results?.find(v=>v.site==='YouTube');
  if(trailer?.key){window.open(`https://www.youtube.com/watch?v=${trailer.key}`,'_blank');showToast(' Opening trailer','success');}
  else showToast('No trailer available for this title','error');
}

// CERT
async function getCert(item){
  try{
    const isTv=item.media_type==='tv'||!!item.first_air_date;
    if(isTv){const d=await fetchWithCache(`${BASE}/tv/${item.id}/content_ratings?api_key=${API_KEY}`);return d?.results?.find(r=>r.iso_3166_1==='US')?.rating||'NR';}
    else{const d=await fetchWithCache(`${BASE}/movie/${item.id}/release_dates?api_key=${API_KEY}`);return d?.results?.find(r=>r.iso_3166_1==='US')?.release_dates?.[0]?.certification||'NR';}
  }catch{return 'NR';}
}
function certOk(cert,group){
  if(group==='all')return true;cert=(cert||'').toUpperCase();
  if(group==='gpg')return['G','PG','TV-Y','TV-G','TV-Y7'].includes(cert);
  if(group==='pg13')return cert==='PG-13'||cert==='TV-14';
  if(group==='r')return cert==='R'||cert==='TV-MA';
  if(group==='nc17')return cert==='NC-17';return false;
}

// MY LIST
function toggleMyList(item){
  const idx=myList.findIndex(i=>i.id===item.id);const adding=idx===-1;
  if(adding)myList.push(item);else myList.splice(idx,1);
  const key=`gnStreamMyList_${activeProfile.id}`;
  localStorage.setItem(key,JSON.stringify(myList));localStorage.setItem('gnStreamMyList',JSON.stringify(myList));
  updateMyListCount();
  document.querySelectorAll(`.card-action-btn[data-lid="${item.id}"]`).forEach(b=>{b.classList.toggle('in-list',adding);b.textContent=adding?'':'';});
  showToast(adding?' Added to My List':'Removed from My List',adding?'success':'info');
  if(document.getElementById('myListSection').style.display!=='none')renderMyList();
  if(currentDetailsItem?.id===item.id)updateDetailsListBtn();
}
function updateDetailsListBtn(){
  const btn=document.getElementById('detailsAddToList');if(!btn||!currentDetailsItem)return;
  const inList=myList.some(i=>i.id===currentDetailsItem.id);
  btn.textContent=inList?' In My List':'+ My List';btn.classList.toggle('btn-red',inList);
}
function toggleListFromDetails(){if(currentDetailsItem)toggleMyList(currentDetailsItem);}
function updateMyListCount(){const c=myList.length,b=document.getElementById('myListCount');if(c>0){b.textContent=c>99?'99+':c;b.style.display='inline';}else b.style.display='none';}

// CARDS
function createCard(item,container,index=0,sz='card',locked=false){
  const card=document.createElement('div');card.className=`card ${sz}`;card.dataset.id=item.id;
  const inList=myList.some(i=>i.id===item.id);
  const posterUrl=item.poster_path?`${IMG}w342${item.poster_path}`:FB_POSTER;
  card.innerHTML=`
    <img src="${posterUrl}" alt="${item.title||item.name}" loading="lazy" onerror="this.src='${FB_POSTER}'">
    <div class="card-overlay">
      <div class="card-title">${item.title||item.name}</div>
      <div class="card-rating"> ${(item.vote_average||0).toFixed(1)}  ${item._cert||'NR'}</div>
    </div>
    <div class="card-actions">
      <button class="card-action-btn ${inList?'in-list':''}" data-lid="${item.id}" onclick="event.stopPropagation();toggleMyList(window['item_${item.id}_ref'])" title="My List">${inList?'':''}</button>
    </div>
    ${locked&&!isPremiumUser?`<div class="premium-lock-overlay" onclick="event.stopPropagation();openPremiumModal()"><span class="lock-icon"></span><div class="lock-text">Premium Required</div></div>`:''}
  `;
  window[`item_${item.id}_ref`]=item;
  card.addEventListener('click',e=>{
    if(e.target.closest('.card-action-btn'))return;
    if(e.target.closest('.premium-lock-overlay'))return;
    if(locked&&!isPremiumUser){openPremiumModal();return;}
    openDetails(item);
  });
  container.appendChild(card);
}

// TOP 10
function createTop10Card(item,num,container){
  const wrap=document.createElement('div');wrap.className='top10-card';
  const posterUrl=item.poster_path?`${IMG}w342${item.poster_path}`:FB_POSTER;
  wrap.innerHTML=`<div class="top10-number">${num}</div><div class="top10-poster"><img src="${posterUrl}" alt="${item.title||item.name}" loading="lazy" onerror="this.src='${FB_POSTER}'"></div>`;
  wrap.onclick=()=>openDetails(item);container.appendChild(wrap);
}

// WIDE CARDS
function createWideCard(item,container){
  const card=document.createElement('div');card.className='wide-card';
  const img=item.backdrop_path?`${IMG}w300${item.backdrop_path}`:(item.poster_path?`${IMG}w342${item.poster_path}`:FB_BACK);
  const pct=Math.min(100,Math.round(((item.progress||0)/(item.duration||7200))*100));
  const remain=item.duration?Math.round((item.duration-(item.progress||0))/60)+'m left':'';
  card.innerHTML=`<div class="wide-card-thumb"><img src="${img}" alt="${item.title||item.name}" onerror="this.src='${FB_BACK}'"><div class="wide-card-play"><div class="wide-play-circle"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div></div><div class="wide-card-info"><div class="wide-card-title">${item.title||item.name}</div><div class="wide-card-meta"><span>${item._cert||'NR'}</span><span> ${(item.vote_average||0).toFixed(1)}</span></div><div class="wide-progress"><div class="wide-progress-fill" style="width:${pct}%"></div></div>${remain?`<div class="wide-card-time">${remain}</div>`:''}</div>`;
  card.onclick=()=>openDetails(item);container.appendChild(card);
}

// HOT TODAY
async function loadHotToday(){
  const grid=document.getElementById('hotTodayGrid');
  const d=await fetchWithCache(`${BASE}/trending/all/day?api_key=${API_KEY}&language=en-US`);
  grid.innerHTML='';if(!d?.results)return;
  d.results.slice(0,8).forEach((item,i)=>{
    item.media_type=item.first_air_date?'tv':'movie';
    const poster=item.poster_path?`${IMG}w92${item.poster_path}`:FB_POSTER;
    const score=Math.round(80+Math.random()*19);
    const el=document.createElement('div');el.className='hot-item';
    el.innerHTML=`<div class="hot-rank">${i+1}</div><img class="hot-poster" src="${poster}" alt="${item.title||item.name}" onerror="this.src='${FB_POSTER}'"><div class="hot-info"><div class="hot-title">${item.title||item.name}</div><div class="hot-meta"><span>${item.first_air_date?'TV':'Movie'}</span><span> ${(item.vote_average||0).toFixed(1)}</span><span class="hot-score">${score}</span></div></div>`;
    el.onclick=()=>openDetails(item);grid.appendChild(el);
  });
}

// LOAD CATEGORY
async function loadCategory(endpoint,containerId,type,genreId=null,sz='card',locked=false){
  const c=document.getElementById(containerId);c.innerHTML='';
  for(let i=0;i<6;i++){const s=document.createElement('div');s.className=`skeleton skeleton-card ${sz==='card-large'?'card-large':sz==='card-medium'?'card-medium':''}`;c.appendChild(s);}
  let url=`${BASE}${endpoint}?api_key=${API_KEY}&language=en-US`;if(genreId)url+=`&with_genres=${genreId}`;
  const d=await fetchWithCache(url);c.innerHTML='';if(!d?.results){c.innerHTML='<div class="empty-state">Failed to load</div>';return;}
  for(const item of d.results.slice(0,18)){item.media_type=type;item._cert=await getCert(item);createCard(item,c,0,sz,locked);}
}

// NOW PLAYING
async function renderNowPlaying(){
  const c=document.getElementById('nowPlayingRow');c.innerHTML='<div class="loading-container"><div class="spinner"></div></div>';
  const d=await fetchWithCache(`${BASE}/movie/now_playing?api_key=${API_KEY}&language=en-US&page=1`);
  c.innerHTML='';if(!d?.results){c.innerHTML='<div class="empty-state">Failed to load</div>';return;}
  for(const item of d.results.slice(0,20)){item.media_type='movie';item._cert=await getCert(item);createCard(item,c,0,'card-large',true);}
}
async function refreshNewReleases(){
  const c=document.getElementById('newReleaseRow');c.innerHTML='';
  const d=await fetchWithCache(`${BASE}/movie/now_playing?api_key=${API_KEY}&language=en-US&page=1`);
  if(!d?.results)return;
  for(const item of d.results.slice(0,16)){item.media_type='movie';item._cert=await getCert(item);createCard(item,c,0,'card',true);}
}

// CONTINUE WATCHING
function renderContinueWatchingInline(){const c=document.getElementById('continueWatchingInlineRow');c.innerHTML='';continueWatching.forEach(item=>createWideCard(item,c));}
function renderContinueWatching(){
  const c=document.getElementById('continueWatchingRow');c.innerHTML='';
  if(!continueWatching.length){c.innerHTML='<div class="empty-state">No titles in progress</div>';return;}
  continueWatching.forEach(item=>createWideCard(item,c));
}
function renderMyList(){
  const c=document.getElementById('myListRow');c.innerHTML='';
  if(!myList.length){c.innerHTML='<div class="empty-state">Your list is empty  click  on any poster</div>';return;}
  myList.forEach(item=>createCard(item,c,0,'card'));
}
function clearContinueWatching(){if(confirm('Clear continue watching?')){continueWatching=[];localStorage.setItem('gnStreamContinue','[]');renderContinueWatching();showToast('Cleared','success');}}

// GENRE FILTER
async function filterGenre(genreId,btn){
  activeGenreFilter=genreId;
  document.querySelectorAll('.genre-pill').forEach(p=>p.classList.remove('active'));btn.classList.add('active');
  if(!genreId){document.querySelectorAll('[id^="section-"]').forEach(s=>s.style.display='');document.getElementById('discoverMoreSection').style.display='block';return;}
  document.querySelectorAll('[id^="section-"]').forEach(s=>s.style.display='none');document.getElementById('discoverMoreSection').style.display='none';
  const genreSection=document.getElementById('section-trending');genreSection.style.display='block';
  const row=document.getElementById('trendingRow');row.innerHTML='<div class="loading-container"><div class="spinner"></div></div>';
  const d=await fetchWithCache(`${BASE}/discover/movie?api_key=${API_KEY}&with_genres=${genreId}&sort_by=popularity.desc&language=en-US&page=1`);
  const d2=await fetchWithCache(`${BASE}/discover/tv?api_key=${API_KEY}&with_genres=${genreId}&sort_by=popularity.desc&language=en-US&page=1`);
  row.innerHTML='';
  const items=[...(d?.results||[]).map(i=>({...i,media_type:'movie'})),...(d2?.results||[]).map(i=>({...i,media_type:'tv'}))];
  items.sort((a,b)=>(b.popularity||0)-(a.popularity||0)).slice(0,24).forEach(item=>createCard(item,row,0,'card'));
  document.getElementById('section-trending').querySelector('.category-title').innerHTML=`<span style="color:var(--primary)"></span> Results for ${btn.textContent}`;
}

// SEARCH
async function performSearch(q){
  hideAllSections();document.getElementById('searchResults').style.display='block';
  const grid=document.getElementById('searchResultsGrid');
  grid.innerHTML='<div class="loading-container"><div class="spinner"></div></div>';
  try{
    const d=await fetchWithCache(`${BASE}/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(q)}&language=en-US`);
    grid.innerHTML='';if(!d?.results){grid.innerHTML='<div class="empty-state">Search failed</div>';return;}
    const filtered=d.results.filter(i=>i.media_type==='movie'||i.media_type==='tv');
    if(!filtered.length){grid.innerHTML='<div class="empty-state">No results found</div>';return;}
    const rg=document.getElementById('ratingSelect').value;
    for(const item of filtered.slice(0,24)){item._cert=await getCert(item);if(certOk(item._cert,rg))createCard(item,grid,0,'card');}
  }catch{grid.innerHTML='<div class="empty-state">Error</div>';}
}

// DETAILS
async function openDetails(item){
  currentDetailsItem=item;scrollPos=window.pageYOffset;
  const posterUrl=item.backdrop_path?`${IMG}original${item.backdrop_path}`:(item.poster_path?`${IMG}w780${item.poster_path}`:FB_BACK);
  const pi=document.getElementById('posterImage');pi.src=posterUrl;pi.onerror=()=>pi.src=FB_BACK;
  document.getElementById('detailsTitle').textContent=item.title||item.name;
  document.getElementById('detailsYear').textContent=(item.release_date||item.first_air_date||'').substring(0,4);
  document.getElementById('detailsOverview').textContent=item.overview||'No overview available.';
  document.getElementById('detailsRating').textContent=item._cert||'NR';
  document.getElementById('matchScore').textContent=`${Math.floor(Math.random()*15+83)}% Match`;
  document.getElementById('detailsGenre').textContent=await getGenreNames(item.genre_ids);
  updateDetailsListBtn();
  await Promise.all([loadCast(item),loadRecommendations(item),loadPeopleAlsoWatched(item)]);
  loadRatingsSection(item);
  if(item.genre_ids?.length){
    const genreNames=await getGenreNamesArr(item.genre_ids);
    const tagsDiv=document.getElementById('detailsTags');
    tagsDiv.innerHTML=genreNames.map(g=>`<div class="detail-tag">${g}</div>`).join('');
    document.getElementById('tagsSection').style.display='block';
  }
  const isTv=item.media_type==='tv'||!!item.first_air_date;
  if(isTv){document.getElementById('episodeSectionWrap').style.display='block';await loadTvSeasons(item.id);}
  else document.getElementById('episodeSectionWrap').style.display='none';
  document.body.classList.add('modal-open');document.getElementById('detailsModal').classList.add('active');
}
function closeDetails(){
  document.getElementById('detailsModal').classList.remove('active');document.body.classList.remove('modal-open');
  document.getElementById('posterImage').src='';currentDetailsItem=null;
  setTimeout(()=>window.scrollTo(0,scrollPos),10);
}
function closeDetailsOnBackdrop(e){if(e.target===document.getElementById('detailsModal'))closeDetails();}
async function getGenreNames(ids){if(!ids?.length)return 'Various';const d=await fetchWithCache(`${BASE}/genre/movie/list?api_key=${API_KEY}`);return(ids.map(id=>d?.genres?.find(g=>g.id===id)?.name).filter(Boolean).slice(0,3).join(', '))||'Various';}
async function getGenreNamesArr(ids){if(!ids?.length)return[];const d=await fetchWithCache(`${BASE}/genre/movie/list?api_key=${API_KEY}`);return ids.map(id=>d?.genres?.find(g=>g.id===id)?.name).filter(Boolean).slice(0,5);}
async function loadCast(item){
  const c=document.getElementById('detailsCast');c.innerHTML='';
  const type=item.media_type==='tv'||item.first_air_date?'tv':'movie';
  const d=await fetchWithCache(`${BASE}/${type}/${item.id}/credits?api_key=${API_KEY}`);
  const cast=d?.cast?.slice(0,8)||[];
  if(!cast.length){c.innerHTML='<div class="cast-member">Cast unavailable</div>';return;}
  cast.forEach(a=>{const el=document.createElement('div');el.className='cast-member';el.textContent=a.name;c.appendChild(el);});
}
async function loadRecommendations(item){
  const c=document.getElementById('recommendationsRow');c.innerHTML='<div class="loading-container" style="padding:16px"><div class="spinner"></div></div>';
  try{
    const type=item.first_air_date?'tv':'movie';
    const d=await fetchWithCache(`${BASE}/${type}/${item.id}/recommendations?api_key=${API_KEY}&language=en-US`);
    c.innerHTML='';if(!d?.results?.length){c.innerHTML='<div class="empty-state" style="padding:16px;font-size:13px">No recommendations</div>';return;}
    for(const rec of d.results.filter(r=>r.id!==item.id).slice(0,10)){rec.media_type=type;rec._cert=await getCert(rec);createRecCard(rec,c);}
  }catch{c.innerHTML='<div class="empty-state" style="padding:16px;font-size:13px">Failed</div>';}
}
function createRecCard(item,container){
  const card=document.createElement('div');card.className='recommendation-card';
  const img=item.backdrop_path?`${IMG}w300${item.backdrop_path}`:(item.poster_path?`${IMG}w342${item.poster_path}`:FB_BACK);
  card.innerHTML=`<img src="${img}" alt="${item.title||item.name}" loading="lazy" onerror="this.src='${FB_BACK}'"><div class="recommendation-overlay"><div class="recommendation-title">${item.title||item.name}</div><div class="recommendation-rating"> ${(item.vote_average||0).toFixed(1)}</div></div>`;
  card.onclick=()=>{closeDetails();setTimeout(()=>openDetails(item),300);};container.appendChild(card);
}
async function loadPeopleAlsoWatched(item){
  const sec=document.getElementById('pawSection');const row=document.getElementById('pawRow');row.innerHTML='';sec.style.display='none';
  try{
    const type=item.first_air_date?'tv':'movie';
    const d=await fetchWithCache(`${BASE}/${type}/${item.id}/similar?api_key=${API_KEY}&language=en-US`);
    const results=d?.results?.filter(r=>r.id!==item.id)?.slice(0,8)||[];if(!results.length)return;
    sec.style.display='block';
    results.forEach(rec=>{
      rec.media_type=type;const card=document.createElement('div');card.className='paw-card';
      const img=rec.poster_path?`${IMG}w185${rec.poster_path}`:FB_POSTER;
      card.innerHTML=`<img src="${img}" alt="${rec.title||rec.name}" loading="lazy" onerror="this.src='${FB_POSTER}'"><div class="paw-card-title">${rec.title||rec.name}</div>`;
      card.onclick=()=>{closeDetails();setTimeout(()=>openDetails(rec),300);};row.appendChild(card);
    });
  }catch{}
}

// EPISODES
async function loadTvSeasons(tvId){
  const d=await fetchWithCache(`${BASE}/tv/${tvId}?api_key=${API_KEY}&language=en-US`);
  const seasons=(d?.seasons||[]).filter(s=>s.season_number>0);
  const sel=document.getElementById('seasonDropdown');sel.innerHTML='';
  seasons.forEach(s=>{const o=document.createElement('option');o.value=s.season_number;o.textContent=`Season ${s.season_number}`;sel.appendChild(o);});
  currentEpisodeSeason=seasons.length>0?seasons[0].season_number:1;sel.value=currentEpisodeSeason;
  await loadEpisodes(tvId,currentEpisodeSeason);
}
async function onSeasonChange(){const s=parseInt(document.getElementById('seasonDropdown').value);currentEpisodeSeason=s;if(currentDetailsItem)await loadEpisodes(currentDetailsItem.id,s);}
async function loadEpisodes(tvId,season){
  const grid=document.getElementById('episodesGrid');grid.innerHTML='<div class="loading-container"><div class="spinner"></div></div>';
  try{
    const d=await fetchWithCache(`${BASE}/tv/${tvId}/season/${season}?api_key=${API_KEY}&language=en-US`);
    grid.innerHTML='';const eps=d?.episodes||[];
    if(!eps.length){grid.innerHTML='<div class="empty-state" style="padding:20px">No episodes found</div>';return;}
    eps.forEach(ep=>{
      const card=document.createElement('div');card.className='episode-card';
      const still=ep.still_path?`${IMG}w300${ep.still_path}`:(currentDetailsItem?.backdrop_path?`${IMG}w300${currentDetailsItem.backdrop_path}`:FB_BACK);
      const airDate=ep.air_date?new Date(ep.air_date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}):'';
      const runtime=ep.runtime?`${ep.runtime} min`:'';const rating=ep.vote_average>0?` ${ep.vote_average.toFixed(1)}`:'';
      card.innerHTML=`<div class="episode-thumb-wrap"><img class="episode-thumb" src="${still}" alt="Ep ${ep.episode_number}" loading="lazy" onerror="this.src='${FB_BACK}'"><div class="episode-play-overlay"><div class="ep-play-icon"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div></div><div class="episode-num-badge">E${ep.episode_number}</div></div><div class="episode-info"><div class="episode-title">${ep.name||'Episode '+ep.episode_number}</div><div class="episode-meta-row">${runtime?`<span class="episode-runtime">${runtime}</span>`:''}${airDate?`<span class="episode-air-date">${airDate}</span>`:''}${rating?`<span class="episode-rating">${rating}</span>`:''}</div><div class="episode-overview">${ep.overview||'No description available.'}</div></div>`;
      card.onclick=()=>playEpisode(tvId,season,ep.episode_number,ep.name);grid.appendChild(card);
    });
  }catch{grid.innerHTML='<div class="empty-state" style="padding:20px">Failed to load episodes</div>';}
}
function playEpisode(tvId,season,ep,name){
  document.getElementById('detailsModal').classList.remove('active');
  setTimeout(()=>{openPlayer(tvId,true,season,ep);showToast(`Playing S${season}E${ep}: ${name||''}`, 'success');},280);
  if(currentDetailsItem)addToHistory(currentDetailsItem);
}

// PLAYER
function openPlayer(id,isTv,s=1,e=1){
  const src=SERVERS[currentServer].url(id,isTv,s,e);
  document.getElementById('playerIframe').src=src;document.getElementById('playerModal').classList.add('active');document.body.classList.add('modal-open');
}
function playContent(){
  if(!currentDetailsItem)return;
  addToContinue(currentDetailsItem,0,currentDetailsItem.runtime?currentDetailsItem.runtime*60:7200);addToHistory(currentDetailsItem);
  const isTv=currentDetailsItem.media_type==='tv'||!!currentDetailsItem.first_air_date;
  document.getElementById('detailsModal').classList.remove('active');
  setTimeout(()=>openPlayer(currentDetailsItem.id,isTv,currentEpisodeSeason,currentEpisodeNum),280);
}
function closePlayer(){
  document.getElementById('playerModal').classList.remove('active');
  document.getElementById('playerControlsModal').classList.remove('active');
  document.getElementById('playerIframe').src='';
  if(currentDetailsItem)setTimeout(()=>document.getElementById('detailsModal').classList.add('active'),280);
  else document.body.classList.remove('modal-open');
}
function closePlayerOnBackdrop(e){if(e.target===document.getElementById('playerModal'))closePlayer();}
function downloadContent(){
  if(!currentDetailsItem)return;
  const isTv=currentDetailsItem.media_type==='tv'||!!currentDetailsItem.first_air_date;
  const url=isTv?`https://dl.vidsrc.vip/tv/${currentDetailsItem.id}/${currentEpisodeSeason}/${currentEpisodeNum}`:`https://dl.vidsrc.vip/movie/${currentDetailsItem.id}`;
  window.open(url,'_blank');showToast('Download started ','success');
}
function addToContinue(item,progress,duration){
  const idx=continueWatching.findIndex(i=>i.id===item.id);const data={...item,progress,duration,lastWatched:new Date().toISOString()};
  if(idx!==-1)continueWatching.splice(idx,1);continueWatching.unshift(data);if(continueWatching.length>15)continueWatching=continueWatching.slice(0,15);
  localStorage.setItem('gnStreamContinue',JSON.stringify(continueWatching));
}
function skipIntro(){showToast('Skipping intro','success');}
function skipRecap(){showToast('Skipping recap','success');}
function launchMiniPlayer(){
  const src=document.getElementById('playerIframe').src;if(!src){showToast('Nothing playing','error');return;}
  const title=currentDetailsItem?(currentDetailsItem.title||currentDetailsItem.name):'Now Playing';
  document.getElementById('miniPlayerIframe').src=src;document.getElementById('miniPlayerTitle').textContent=title;
  document.getElementById('miniPlayer').classList.add('active');miniPlayerActive=true;
  closePlayer();showToast('Mini player ','success');initMiniDrag();
}
function closeMiniPlayer(){document.getElementById('miniPlayer').classList.remove('active');document.getElementById('miniPlayerIframe').src='';miniPlayerActive=false;}
function expandMiniPlayer(){const src=document.getElementById('miniPlayerIframe').src;if(!src)return;document.getElementById('playerIframe').src=src;document.getElementById('playerModal').classList.add('active');closeMiniPlayer();}
let isDragging=false,dragStartX,dragStartY,pStartX,pStartY;
function initMiniDrag(){
  const p=document.getElementById('miniPlayer'),drag=document.getElementById('miniDrag');
  const down=e=>{isDragging=true;const cx=e.touches?e.touches[0].clientX:e.clientX,cy=e.touches?e.touches[0].clientY:e.clientY;dragStartX=cx;dragStartY=cy;const r=p.getBoundingClientRect();pStartX=r.left;pStartY=r.top;e.preventDefault();};
  const move=e=>{if(!isDragging)return;const cx=e.touches?e.touches[0].clientX:e.clientX,cy=e.touches?e.touches[0].clientY:e.clientY;p.style.right='auto';p.style.bottom='auto';p.style.left=Math.max(0,Math.min(window.innerWidth-p.offsetWidth,pStartX+(cx-dragStartX)))+'px';p.style.top=Math.max(0,Math.min(window.innerHeight-p.offsetHeight,pStartY+(cy-dragStartY)))+'px';};
  drag.addEventListener('mousedown',down);drag.addEventListener('touchstart',down,{passive:false});
  document.addEventListener('mousemove',move);document.addEventListener('touchmove',move,{passive:false});
  document.addEventListener('mouseup',()=>isDragging=false);document.addEventListener('touchend',()=>isDragging=false);
}

// UPCOMING
async function loadUpcoming(){
  const grid=document.getElementById('upcomingGrid');grid.innerHTML='<div class="loading-container"><div class="spinner"></div></div>';
  const today=new Date().toISOString().split('T')[0];const future=new Date(Date.now()+120*86400000).toISOString().split('T')[0];
  const d=await fetchWithCache(`${BASE}/discover/movie?api_key=${API_KEY}&language=en-US&sort_by=release_date.asc&primary_release_date.gte=${today}&primary_release_date.lte=${future}`);
  grid.innerHTML='';if(!d?.results?.length){grid.innerHTML='<div class="empty-state">No upcoming releases</div>';return;}
  for(const item of d.results.slice(0,24)){
    item.media_type='movie';item._cert=await getCert(item);
    const card=document.createElement('div');card.className='upcoming-card';
    const poster=item.poster_path?`${IMG}w342${item.poster_path}`:FB_POSTER;
    const rel=item.release_date||'';const days=rel?Math.max(0,Math.ceil((new Date(rel)-Date.now())/86400000)):'?';
    const fmtDate=rel?new Date(rel).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}):'TBA';
    card.innerHTML=`<img class="upcoming-poster" src="${poster}" alt="${item.title}" onerror="this.src='${FB_POSTER}'"><div class="upcoming-info"><div class="upcoming-title">${item.title}</div><div class="upcoming-date"> ${fmtDate}</div><div class="upcoming-overview">${item.overview||'No description.'}</div><div class="upcoming-countdown"><span class="days">${days}</span> days away</div></div>`;
    card.onclick=()=>openDetails(item);grid.appendChild(card);
  }
}

// HISTORY
function addToHistory(item){
  const entry={id:item.id,title:item.title||item.name,poster_path:item.poster_path||null,media_type:item.media_type||(item.first_air_date?'tv':'movie'),vote_average:item.vote_average||0,_cert:item._cert||'NR',watchedAt:new Date().toISOString()};
  watchHistory=watchHistory.filter(h=>h.id!==item.id);watchHistory.unshift(entry);
  if(watchHistory.length>100)watchHistory=watchHistory.slice(0,100);localStorage.setItem('gnStreamHistory',JSON.stringify(watchHistory));
}
function renderHistory(){
  const grid=document.getElementById('historyGrid');grid.innerHTML='';
  const filtered=historyFilter==='all'?watchHistory:watchHistory.filter(h=>h.media_type===historyFilter);
  if(!filtered.length){grid.innerHTML='<div class="empty-state" style="grid-column:1/-1">No watch history yet.</div>';return;}
  filtered.forEach(item=>{
    const el=document.createElement('div');el.className='history-item';
    const poster=item.poster_path?`${IMG}w92${item.poster_path}`:FB_POSTER;const ago=timeAgo(new Date(item.watchedAt));
    el.innerHTML=`<img class="history-poster" src="${poster}" alt="${item.title}" onerror="this.src='${FB_POSTER}'"><div class="history-info"><div class="history-title">${item.title}</div><div class="history-meta"><span class="history-badge">${item.media_type==='tv'?'TV':'Movie'}</span><span> ${(item.vote_average||0).toFixed(1)}</span></div><div class="history-timestamp"> ${ago}</div></div><button class="history-delete-btn" onclick="event.stopPropagation();removeFromHistory(${item.id})"></button>`;
    el.addEventListener('click',()=>openDetails(item));grid.appendChild(el);
  });
}
function filterHistory(t,btn){historyFilter=t;document.querySelectorAll('.history-filter-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');renderHistory();}
function removeFromHistory(id){watchHistory=watchHistory.filter(h=>h.id!==id);localStorage.setItem('gnStreamHistory',JSON.stringify(watchHistory));renderHistory();showToast('Removed','info');}
function clearFullHistory(){if(!confirm('Clear all?'))return;watchHistory=[];localStorage.setItem('gnStreamHistory','[]');renderHistory();showToast('Cleared','success');}
function timeAgo(date){
  const diff=Date.now()-date.getTime(),m=Math.floor(diff/60000),h=Math.floor(diff/3600000),d=Math.floor(diff/86400000);
  if(m<1)return'Just now';if(m<60)return`${m}m ago`;if(h<24)return`${h}h ago`;if(d<7)return`${d}d ago`;
  return date.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
}

// RATINGS
function loadRatingsSection(item){
  selectedRating=0;const key=`item_${item.id}`;const all=userReviews[key]||[];const mine=all.find(r=>r.isOwn);
  document.getElementById('reviewTextarea').value='';updateCharCount();document.getElementById('submitReviewBtn').disabled=true;
  const stars=document.querySelectorAll('#starRow .star-btn');
  stars.forEach(s=>{s.classList.remove('active','hovered');s.onmouseenter=()=>{const v=parseInt(s.dataset.val);stars.forEach(b=>b.classList.toggle('hovered',parseInt(b.dataset.val)<=v));};s.onmouseleave=()=>stars.forEach(b=>b.classList.remove('hovered'));});
  if(mine){selectedRating=mine.rating;renderStarSel(selectedRating);document.getElementById('yourRatingStars').textContent=''.repeat(mine.rating)+''.repeat(5-mine.rating);document.getElementById('yourRatingDisplay').classList.add('show');document.getElementById('ratingInputWidget').style.display='none';}
  else{document.getElementById('yourRatingDisplay').classList.remove('show');document.getElementById('ratingInputWidget').style.display='block';}
  renderAvgRating(all);renderReviews(all,key);
}
function setRating(v){selectedRating=v;renderStarSel(v);document.getElementById('submitReviewBtn').disabled=false;}
function renderStarSel(v){document.querySelectorAll('#starRow .star-btn').forEach(b=>b.classList.toggle('active',parseInt(b.dataset.val)<=v));}
function updateCharCount(){const l=document.getElementById('reviewTextarea').value.length;document.getElementById('charCount').textContent=`${l} / 500`;if(selectedRating>0)document.getElementById('submitReviewBtn').disabled=false;}
function editRating(){
  const key=`item_${currentDetailsItem.id}`;const all=userReviews[key]||[];const mi=all.findIndex(r=>r.isOwn);
  if(mi!==-1){document.getElementById('reviewTextarea').value=all[mi].text||'';selectedRating=all[mi].rating;renderStarSel(selectedRating);updateCharCount();all.splice(mi,1);userReviews[key]=all;saveReviews();}
  document.getElementById('yourRatingDisplay').classList.remove('show');document.getElementById('ratingInputWidget').style.display='block';document.getElementById('submitReviewBtn').disabled=false;
  renderAvgRating(all);renderReviews(all,key);
}
function submitReview(){
  if(!selectedRating||!currentDetailsItem)return;
  const key=`item_${currentDetailsItem.id}`;if(!userReviews[key])userReviews[key]=[];
  const review={id:Date.now(),user:isPremiumUser?premiumUsername:'You',rating:selectedRating,text:document.getElementById('reviewTextarea').value.trim(),isOwn:true,date:new Date().toISOString()};
  userReviews[key]=userReviews[key].filter(r=>!r.isOwn);userReviews[key].unshift(review);saveReviews();
  document.getElementById('yourRatingStars').textContent=''.repeat(selectedRating)+''.repeat(5-selectedRating);
  document.getElementById('yourRatingDisplay').classList.add('show');document.getElementById('ratingInputWidget').style.display='none';
  renderAvgRating(userReviews[key]);renderReviews(userReviews[key],key);showToast('Review submitted! ','success');
}
function deleteReview(id){if(!currentDetailsItem)return;const key=`item_${currentDetailsItem.id}`;userReviews[key]=(userReviews[key]||[]).filter(r=>r.id!==id);saveReviews();loadRatingsSection(currentDetailsItem);showToast('Deleted','info');}
function saveReviews(){localStorage.setItem('gnStreamReviews',JSON.stringify(userReviews));}
function renderAvgRating(reviews){
  const bar=document.getElementById('avgRatingBar');if(!reviews.length){bar.style.display='none';return;}
  const avg=reviews.reduce((s,r)=>s+r.rating,0)/reviews.length;bar.style.display='flex';
  document.getElementById('avgRatingNum').textContent=avg.toFixed(1);
  const f=Math.round(avg);document.getElementById('avgStarsDisplay').textContent=''.repeat(f)+''.repeat(5-f);
  document.getElementById('avgRatingCount').textContent=`${reviews.length} review${reviews.length!==1?'s':''}`;
}
function renderReviews(reviews){
  const list=document.getElementById('reviewsList');list.innerHTML='';
  if(!reviews.length){list.innerHTML='<div class="no-reviews">No reviews yet  be the first!</div>';return;}
  reviews.forEach(r=>{
    const el=document.createElement('div');el.className='review-item';
    const date=new Date(r.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
    el.innerHTML=`<div class="review-item-header"><span class="review-item-user">${r.isOwn?' ':''}${r.user}</span><span class="review-item-stars">${''.repeat(r.rating)}${''.repeat(5-r.rating)}</span><span class="review-item-date">${date}</span>${r.isOwn?`<button class="review-item-delete" onclick="deleteReview(${r.id})"></button>`:''}</div>${r.text?`<div class="review-item-text">${r.text}</div>`:''}`;
    list.appendChild(el);
  });
}

// PREMIUM
function openPremiumModal(){document.getElementById('premiumModal').classList.add('active');document.body.classList.add('modal-open');updatePremiumState();document.getElementById('loginError').style.display='none';document.getElementById('loginSuccess').style.display='none';}
function closePremiumModal(){document.getElementById('premiumModal').classList.remove('active');document.body.classList.remove('modal-open');}
function updatePremiumState(){const on=isPremiumUser;document.getElementById('premiumLoggedInState').style.display=on?'block':'none';document.getElementById('premiumGuestState').style.display=on?'none':'block';if(on)document.getElementById('premiumUserName').textContent=premiumUsername;}
function loginPremium(){
  const u=document.getElementById('premiumUser').value.trim().toLowerCase();const p=document.getElementById('premiumPass').value.trim();
  document.getElementById('loginError').style.display='none';document.getElementById('loginSuccess').style.display='none';
  if(PREMIUM_USERS[u]&&PREMIUM_USERS[u]===p){
    isPremiumUser=true;premiumUsername=u;localStorage.setItem('gnStreamPremium','true');localStorage.setItem('gnStreamPremiumUser',u);
    document.getElementById('loginSuccess').style.display='block';updatePremiumUI();setTimeout(()=>{closePremiumModal();refreshNewReleases();},1100);
  }else document.getElementById('loginError').style.display='block';
}
function logoutPremium(){isPremiumUser=false;premiumUsername='';localStorage.removeItem('gnStreamPremium');localStorage.removeItem('gnStreamPremiumUser');updatePremiumUI();updatePremiumState();refreshNewReleases();showToast('Signed out','info');}
function updatePremiumUI(){const b=document.getElementById('premiumActiveBadge');if(isPremiumUser){b.classList.add('show');showToast(`Welcome ${premiumUsername}! `,'success');}else b.classList.remove('show');}

// SHORTCUTS
function toggleShortcuts(){const m=document.getElementById('shortcutsModal');const o=!m.classList.contains('active');m.classList.toggle('active',o);document.body.classList.toggle('modal-open',o);}
function closeShortcuts(){document.getElementById('shortcutsModal').classList.remove('active');document.body.classList.remove('modal-open');}

// DISCOVER
async function loadDiscoverMore(){
  if(isLoadingDiscover||discoverLoaded>=600)return;isLoadingDiscover=true;const btn=document.getElementById('loadMoreBtn');btn.disabled=true;
  const grid=document.getElementById('discoverGrid');
  try{
    const eps=[`/movie/popular?api_key=${API_KEY}&language=en-US&page=${discoverPage}`,`/tv/popular?api_key=${API_KEY}&language=en-US&page=${discoverPage}`,`/movie/top_rated?api_key=${API_KEY}&language=en-US&page=${discoverPage}`,`/tv/top_rated?api_key=${API_KEY}&language=en-US&page=${discoverPage}`];
    const picked=eps.sort(()=>.5-Math.random()).slice(0,2);const results=await Promise.all(picked.map(u=>fetchWithCache(`${BASE}${u}`)));
    const seen=new Set();let items=[];results.forEach(d=>{if(d?.results)items=items.concat(d.results);});
    items=items.filter(i=>{if(seen.has(i.id))return false;seen.add(i.id);return true;});
    for(const item of items.slice(0,20)){if(discoverLoaded>=600)break;if(document.querySelector(`.discover-grid .card[data-id="${item.id}"]`))continue;item.media_type=item.first_air_date?'tv':'movie';item._cert=await getCert(item);createCard(item,grid,0,'card');discoverLoaded++;}
    discoverPage++;document.getElementById('totalMovies').textContent=`${discoverLoaded}+`;
    if(discoverLoaded>=600){btn.textContent='All Loaded ';btn.disabled=true;}else{btn.textContent=`Load More (${discoverLoaded} / 600)`;btn.disabled=false;}
  }catch{showToast('Failed to load more','error');btn.disabled=false;}finally{isLoadingDiscover=false;}
}

// ========================== SETTINGS ==========================
function openSettings(){
  const modal=document.getElementById('settingsModal');
  modal.classList.add('active');document.body.classList.add('modal-open');
  // Sync current state to controls
  const theme=localStorage.getItem('gnStreamTheme')||'dark';
  document.getElementById('themeSelect').value=theme;
  document.getElementById('defaultServerSelect').value=currentServer;
  document.getElementById('buildDate').textContent=new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});
  // Load saved settings
  const s=loadSettings();
  document.getElementById('brightnessSlider').value=s.brightness||100;
  document.getElementById('brightnessVal').textContent=(s.brightness||100)+'%';
  document.getElementById('saturationSlider').value=s.saturation||100;
  document.getElementById('saturationVal').textContent=(s.saturation||100)+'%';
  document.getElementById('grainToggle').checked=s.grain!==false;
  document.getElementById('blurToggle').checked=s.blur!==false;
  document.getElementById('autoplayToggle').checked=s.autoplay!==false;
  document.getElementById('autoSkipToggle').checked=!!s.autoSkip;
  document.getElementById('ratingsOnCardsToggle').checked=s.ratingsOnCards!==false;
  document.getElementById('matureFilterToggle').checked=!!s.matureFilter;
  document.getElementById('toastsToggle').checked=s.toasts!==false;
  document.getElementById('cardSizeSelect').value=s.cardSize||'normal';
  // Sync accent swatch
  const accent=s.accentColor||'#e50914';
  document.querySelectorAll('.color-swatch').forEach(sw=>{sw.classList.toggle('active',sw.dataset.color===accent);});
}
function closeSettings(){document.getElementById('settingsModal').classList.remove('active');document.body.classList.remove('modal-open');}
function loadSettings(){try{return JSON.parse(localStorage.getItem('gnStreamSettings')||'{}');}catch{return{};}}
function saveSettingObj(obj){const s={...loadSettings(),...obj};localStorage.setItem('gnStreamSettings',JSON.stringify(s));}
function saveSetting(key,val){saveSettingObj({[key]:val});}

function applyThemeSetting(v){
  document.documentElement.setAttribute('data-theme',v);localStorage.setItem('gnStreamTheme',v);
  document.getElementById('themeToggleBtn').textContent=v==='dark'?'':'';
  saveSettingObj({theme:v});showToast(`${v==='dark'?'':''} ${v.charAt(0).toUpperCase()+v.slice(1)} mode`,'success');
}

function setAccentColor(color,glow,el){
  document.documentElement.style.setProperty('--primary',color);
  document.documentElement.style.setProperty('--primary-dark',shadeColor(color,-20));
  document.documentElement.style.setProperty('--primary-glow',glow);
  document.querySelectorAll('.color-swatch').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');saveSettingObj({accentColor:color,accentGlow:glow});
  showToast('Accent color updated ','success');
}
function shadeColor(hex,pct){
  const n=parseInt(hex.slice(1),16),r=Math.max(0,Math.min(255,(n>>16)+pct)),g=Math.max(0,Math.min(255,((n>>8)&0xff)+pct)),b=Math.max(0,Math.min(255,(n&0xff)+pct));
  return`#${((r<<16)|(g<<8)|b).toString(16).padStart(6,'0')}`;
}

function applyBrightness(v){
  document.getElementById('brightnessVal').textContent=v+'%';
  document.body.style.filter=`brightness(${v/100}) saturate(${(loadSettings().saturation||100)/100})`;
  saveSettingObj({brightness:parseInt(v)});
}
function applySaturation(v){
  document.getElementById('saturationVal').textContent=v+'%';
  document.body.style.filter=`brightness(${(loadSettings().brightness||100)/100}) saturate(${v/100})`;
  saveSettingObj({saturation:parseInt(v)});
}
function applyGrain(on){document.querySelector('.noise').style.display=on?'block':'none';saveSetting('grain',on);}
function applyBlur(on){
  const hdr=document.getElementById('mainHeader');
  hdr.style.backdropFilter=on?'blur(20px) saturate(180%)':'none';
  saveSetting('blur',on);
}
function applyCardSize(sz){
  const map={small:'108px',normal:'155px',large:'195px'};
  const h={small:'162px',normal:'230px',large:'290px'};
  document.querySelectorAll('.card:not(.card-large):not(.card-wide):not(.card-medium)').forEach(c=>{c.style.width=map[sz];c.style.height=h[sz];});
  saveSetting('cardSize',sz);showToast('Card size updated','success');
}
function toggleRatingsOnCards(on){
  document.querySelectorAll('.card-rating').forEach(r=>r.style.display=on?'':'none');
  saveSetting('ratingsOnCards',on);
}
function resetAppearance(){
  document.documentElement.style.removeProperty('--primary');
  document.documentElement.style.removeProperty('--primary-dark');
  document.documentElement.style.removeProperty('--primary-glow');
  document.body.style.filter='';
  document.querySelector('.noise').style.display='block';
  document.getElementById('mainHeader').style.backdropFilter='';
  document.querySelectorAll('.card').forEach(c=>{c.style.width='';c.style.height='';});
  saveSettingObj({brightness:100,saturation:100,grain:true,blur:true,accentColor:'#e50914',cardSize:'normal'});
  openSettings();showToast('Appearance reset ','success');
}
function clearAllData(){
  if(!confirm(' This will clear your watch history, My List, continue watching, reviews, and settings. This cannot be undone. Continue?'))return;
  ['gnStreamMyList','gnStreamContinue','gnStreamHistory','gnStreamReviews','gnStreamSettings','gnStreamTheme','gnStreamPremium','gnStreamPremiumUser','gnStreamProfiles','gnStreamActiveProfile','gnStreamServer'].forEach(k=>localStorage.removeItem(k));
  showToast('All data cleared. Refreshing','success');setTimeout(()=>location.reload(),1200);
}

// Apply saved settings on load
function initSavedSettings(){
  const s=loadSettings();
  if(s.accentColor)document.documentElement.style.setProperty('--primary',s.accentColor);
  if(s.accentGlow)document.documentElement.style.setProperty('--primary-glow',s.accentGlow);
  if(s.accentColor)document.documentElement.style.setProperty('--primary-dark',shadeColor(s.accentColor,-20));
  if(s.brightness||s.saturation){document.body.style.filter=`brightness(${(s.brightness||100)/100}) saturate(${(s.saturation||100)/100})`;}
  if(s.grain===false)document.querySelector('.noise').style.display='none';
}

// KEYBOARD
document.addEventListener('keydown',e=>{
  if(e.target.tagName==='INPUT'||e.target.tagName==='TEXTAREA'||e.target.tagName==='SELECT'){if(e.key==='Escape')e.target.blur();return;}
  if(e.ctrlKey&&(e.key==='m'||e.key==='M')){e.preventDefault();if(miniPlayerActive)closeMiniPlayer();else if(document.getElementById('playerModal').classList.contains('active'))launchMiniPlayer();return;}
  switch(e.key){
    case'?':e.preventDefault();toggleShortcuts();break;
    case't':case'T':toggleTheme();break;
    case'p':case'P':if(document.getElementById('playerModal').classList.contains('active'))openPlayerControls();break;
    case's':case'S':if(document.getElementById('playerModal').classList.contains('active'))skipIntro();break;
    case'/':e.preventDefault();document.getElementById('searchInput').focus();break;
    case'Escape':
      if(document.getElementById('settingsModal').classList.contains('active'))closeSettings();
      else if(document.getElementById('playerControlsModal').classList.contains('active'))closePlayerControls();
      else if(document.getElementById('profilesModal').classList.contains('active'))closeProfiles();
      else if(document.getElementById('shortcutsModal').classList.contains('active'))closeShortcuts();
      else if(document.getElementById('premiumModal').classList.contains('active'))closePremiumModal();
      else if(document.getElementById('playerModal').classList.contains('active'))closePlayer();
      else if(document.getElementById('detailsModal').classList.contains('active'))closeDetails();
      break;
  }
});

// INIT
initTheme();initSavedSettings();updateMyListCount();if(isPremiumUser)updatePremiumUI();
document.getElementById('headerProfile').textContent=activeProfile.emoji;
if(continueWatching.length>0){document.getElementById('continueWatchingInlineSection').style.display='block';renderContinueWatchingInline();}
loadHero();loadHotToday();
loadCategory('/trending/all/day','trendingRow','movie',null,'card-large');
(async()=>{
  const d=await fetchWithCache(`${BASE}/trending/all/week?api_key=${API_KEY}&language=en-US`);
  const row=document.getElementById('top10Row');row.innerHTML='';
  if(d?.results){d.results.slice(0,10).forEach((item,i)=>{item.media_type=item.first_air_date?'tv':'movie';createTop10Card(item,i+1,row);});}
})();
refreshNewReleases();
loadCategory('/discover/movie','actionRow','movie',GENRES.ACTION);
loadCategory('/discover/movie','comedyRow','movie',GENRES.COMEDY);
loadCategory('/discover/movie','horrorRow','movie',GENRES.HORROR);
loadCategory('/discover/movie','scifiRow','movie',GENRES.SCIFI);
loadCategory('/discover/movie','romanceRow','movie',GENRES.ROMANCE);
loadCategory('/discover/movie','thrillerRow','movie',GENRES.THRILLER);
loadCategory('/discover/movie','dramaRow','movie',GENRES.DRAMA);
loadCategory('/discover/movie','animationRow','movie',GENRES.ANIMATION);
loadCategory('/discover/movie','documentaryRow','movie',GENRES.DOCUMENTARY);
loadCategory('/discover/movie','crimeRow','movie',GENRES.CRIME);
loadCategory('/discover/movie','mysteryRow','movie',GENRES.MYSTERY);
loadCategory('/discover/movie','fantasyRow','movie',GENRES.FANTASY);
loadCategory('/discover/movie','familyRow','movie',GENRES.FAMILY);
loadCategory('/discover/movie','adventureRow','movie',GENRES.ADVENTURE);
loadCategory('/movie/popular','popularMoviesRow','movie');
loadCategory('/tv/popular','popularTvRow','tv');
fetchWithCache(`${BASE}/discover/tv?api_key=${API_KEY}&with_original_language=ko&sort_by=popularity.desc`).then(d=>{const c=document.getElementById('koreanRow');c.innerHTML='';if(d?.results)d.results.slice(0,16).forEach(item=>{item.media_type='tv';createCard(item,c,0,'card');});});
fetchWithCache(`${BASE}/discover/tv?api_key=${API_KEY}&with_keywords=210024&sort_by=popularity.desc`).then(d=>{const c=document.getElementById('animeRow');c.innerHTML='';if(d?.results)d.results.slice(0,16).forEach(item=>{item.media_type='tv';createCard(item,c,0,'card');});});
fetchWithCache(`${BASE}/movie/top_rated?api_key=${API_KEY}&language=en-US&page=1`).then(d=>{const c=document.getElementById('awardRow');c.innerHTML='';if(d?.results)d.results.slice(0,16).forEach(item=>{item.media_type='movie';createCard(item,c,0,'card');});});
loadDiscoverMore();loadDiscoverMore();observeSections();
</script>
</body>
</html>
